<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>é¡¹ç›®ä¼˜åŒ– | å°è¯´ç²¾å“å±‹</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script crossorigin="anonymous" async="true" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7927582798443371"></script>
    <script src="/redirect.js"></script>
    <meta name="description" content="å°è¯´ç²¾å“å±‹é¡¹ç›®å¼€å‘æ–‡æ¡£,JAVAå­¦ä¹ æ•™ç¨‹,JAVAå¼€æºé¡¹ç›®,JAVAé¡¹ç›®å®æˆ˜æ•™ç¨‹,æ‰‹æŠŠæ‰‹æ•™ä½ å¼€å‘ä¸Šçº¿ä¸€ä¸ªç”Ÿäº§çº§åˆ«çš„å°è¯´ç³»ç»Ÿ">
    
    <link rel="preload" href="/assets/css/0.styles.f109e9b6.css" as="style"><link rel="preload" href="/assets/js/app.09e306c7.js" as="script"><link rel="preload" href="/assets/js/2.99247de7.js" as="script"><link rel="preload" href="/assets/js/19.4939c52f.js" as="script"><link rel="prefetch" href="/assets/js/10.0074f0b6.js"><link rel="prefetch" href="/assets/js/11.a30c50a6.js"><link rel="prefetch" href="/assets/js/12.8b56d8ab.js"><link rel="prefetch" href="/assets/js/13.c749534f.js"><link rel="prefetch" href="/assets/js/14.d3b12aa4.js"><link rel="prefetch" href="/assets/js/15.74294d9c.js"><link rel="prefetch" href="/assets/js/16.6da0ac7a.js"><link rel="prefetch" href="/assets/js/17.1ab88373.js"><link rel="prefetch" href="/assets/js/18.8875335c.js"><link rel="prefetch" href="/assets/js/20.34025d9d.js"><link rel="prefetch" href="/assets/js/21.7cce32ee.js"><link rel="prefetch" href="/assets/js/22.11440c86.js"><link rel="prefetch" href="/assets/js/23.e192cd17.js"><link rel="prefetch" href="/assets/js/24.45216f10.js"><link rel="prefetch" href="/assets/js/25.3be12542.js"><link rel="prefetch" href="/assets/js/26.4fbe7fce.js"><link rel="prefetch" href="/assets/js/27.ba19a09d.js"><link rel="prefetch" href="/assets/js/28.8fee7490.js"><link rel="prefetch" href="/assets/js/29.1393ab46.js"><link rel="prefetch" href="/assets/js/3.d1f014c5.js"><link rel="prefetch" href="/assets/js/30.d7fe8f4e.js"><link rel="prefetch" href="/assets/js/31.3e268b35.js"><link rel="prefetch" href="/assets/js/4.c866ff58.js"><link rel="prefetch" href="/assets/js/5.1dabba3b.js"><link rel="prefetch" href="/assets/js/6.2b9e04ea.js"><link rel="prefetch" href="/assets/js/7.da8e9de0.js"><link rel="prefetch" href="/assets/js/8.f14eb728.js"><link rel="prefetch" href="/assets/js/9.89a7523c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f109e9b6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="å°è¯´ç²¾å“å±‹" class="logo"> <span class="site-name can-hide">å°è¯´ç²¾å“å±‹</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="http://47.106.243.172:8888" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åœ¨çº¿æ¼”ç¤º
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://developer.aliyun.com/ebook/read/394" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å¼€å‘è§„çº¦
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.xxyopen.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æŠ€æœ¯åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Project Menu" class="dropdown-title"><span class="title">é¡¹ç›®å®æˆ˜</span> <span class="arrow down"></span></button> <button type="button" aria-label="Project Menu" class="mobile-dropdown-title"><span class="title">é¡¹ç›®å®æˆ˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/course/novel/" class="nav-link router-link-active">
  novel
</a></li><li class="dropdown-item"><!----> <a href="/course/novelcloud.html" class="nav-link">
  novel-cloud
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Log Menu" class="dropdown-title"><span class="title">æ›´æ–°æ—¥å¿—</span> <span class="arrow down"></span></button> <button type="button" aria-label="Log Menu" class="mobile-dropdown-title"><span class="title">æ›´æ–°æ—¥å¿—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/log/novel.html" class="nav-link">
  novel
</a></li><li class="dropdown-item"><!----> <a href="/log/novelcloud.html" class="nav-link">
  novel-cloud
</a></li></ul></div></div><div class="nav-item"><a href="/suport/" class="nav-link">
  ğŸ’–æ”¯æŒ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub Menu" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub Menu" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/201206030/novel" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/201206030/novel-plus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-plus
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/201206030/novel-cloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-cloud
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Gitee Menu" class="dropdown-title"><span class="title">ç äº‘</span> <span class="arrow down"></span></button> <button type="button" aria-label="Gitee Menu" class="mobile-dropdown-title"><span class="title">ç äº‘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/novel_dev_team/novel" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/novel_dev_team/novel-plus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-plus
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/novel_dev_team/novel-cloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-cloud
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="http://47.106.243.172:8888" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åœ¨çº¿æ¼”ç¤º
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://developer.aliyun.com/ebook/read/394" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å¼€å‘è§„çº¦
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.xxyopen.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æŠ€æœ¯åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Project Menu" class="dropdown-title"><span class="title">é¡¹ç›®å®æˆ˜</span> <span class="arrow down"></span></button> <button type="button" aria-label="Project Menu" class="mobile-dropdown-title"><span class="title">é¡¹ç›®å®æˆ˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/course/novel/" class="nav-link router-link-active">
  novel
</a></li><li class="dropdown-item"><!----> <a href="/course/novelcloud.html" class="nav-link">
  novel-cloud
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Log Menu" class="dropdown-title"><span class="title">æ›´æ–°æ—¥å¿—</span> <span class="arrow down"></span></button> <button type="button" aria-label="Log Menu" class="mobile-dropdown-title"><span class="title">æ›´æ–°æ—¥å¿—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/log/novel.html" class="nav-link">
  novel
</a></li><li class="dropdown-item"><!----> <a href="/log/novelcloud.html" class="nav-link">
  novel-cloud
</a></li></ul></div></div><div class="nav-item"><a href="/suport/" class="nav-link">
  ğŸ’–æ”¯æŒ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub Menu" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub Menu" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/201206030/novel" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/201206030/novel-plus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-plus
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/201206030/novel-cloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-cloud
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Gitee Menu" class="dropdown-title"><span class="title">ç äº‘</span> <span class="arrow down"></span></button> <button type="button" aria-label="Gitee Menu" class="mobile-dropdown-title"><span class="title">ç äº‘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/novel_dev_team/novel" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/novel_dev_team/novel-plus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-plus
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/novel_dev_team/novel-cloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-cloud
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/course/novel/" aria-current="page" class="sidebar-link">å¿«é€Ÿå¼€å§‹</a></li><li><a href="/course/novel/11.html" class="sidebar-link">å…¬ä¼—å·</a></li><li><a href="/course/novel/1.html" class="sidebar-link">æŠ€æœ¯æ¶æ„</a></li><li><a href="/course/novel/2.html" class="sidebar-link">æŠ€æœ¯è¦ç‚¹</a></li><li><a href="/course/novel/3.html" class="sidebar-link">æ•°æ®åº“è®¾è®¡</a></li><li><a href="/course/novel/4.html" class="sidebar-link">é¡¹ç›®å¼€å‘</a></li><li><a href="/course/novel/9.html" aria-current="page" class="active sidebar-link">é¡¹ç›®ä¼˜åŒ–</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/course/novel/9.html#ä½¿ç”¨ç­–ç•¥æ¨¡å¼é‡æ„å¤šç³»ç»Ÿç¯å¢ƒä¸‹çš„ç”¨æˆ·è®¤è¯æˆæƒ" class="sidebar-link">ä½¿ç”¨ç­–ç•¥æ¨¡å¼é‡æ„å¤šç³»ç»Ÿç¯å¢ƒä¸‹çš„ç”¨æˆ·è®¤è¯æˆæƒ</a></li><li class="sidebar-sub-header"><a href="/course/novel/9.html#ä½¿ç”¨è£…é¥°è€…æ¨¡å¼è§£å†³è¡¨å•å½¢å¼ä¼ å‚çš„-xss-æ”»å‡»" class="sidebar-link">ä½¿ç”¨è£…é¥°è€…æ¨¡å¼è§£å†³è¡¨å•å½¢å¼ä¼ å‚çš„ XSS æ”»å‡»</a></li><li class="sidebar-sub-header"><a href="/course/novel/9.html#ä¸€è¡Œä»£ç è§£å†³-json-å½¢å¼ä¼ å‚çš„-xss-æ”»å‡»" class="sidebar-link">ä¸€è¡Œä»£ç è§£å†³ JSON å½¢å¼ä¼ å‚çš„ XSS æ”»å‡»</a></li><li class="sidebar-sub-header"><a href="/course/novel/9.html#é›†æˆ-elasticsearch-8-å®ç°æœç´¢å¼•æ“åŠ¨æ€åˆ‡æ¢" class="sidebar-link">é›†æˆ Elasticsearch 8ï¼Œå®ç°æœç´¢å¼•æ“åŠ¨æ€åˆ‡æ¢</a></li><li class="sidebar-sub-header"><a href="/course/novel/9.html#ä½¿ç”¨-rabbitmq-åˆ·æ–°-es-redis-caffeine-ç­‰å°è¯´å‰¯æœ¬æ•°æ®" class="sidebar-link">ä½¿ç”¨ RabbitMQ åˆ·æ–° ES/Redis/Caffeine ç­‰å°è¯´å‰¯æœ¬æ•°æ®</a></li><li class="sidebar-sub-header"><a href="/course/novel/9.html#ä½¿ç”¨-xxl-job-ä¼˜åŒ–-elasticsearch-æ•°æ®åŒæ­¥ä»»åŠ¡" class="sidebar-link">ä½¿ç”¨ XXL-JOB ä¼˜åŒ– Elasticsearch æ•°æ®åŒæ­¥ä»»åŠ¡</a></li><li class="sidebar-sub-header"><a href="/course/novel/9.html#ä½¿ç”¨-sentinel-å®ç°æ¥å£é˜²åˆ·å’Œé™æµ" class="sidebar-link">ä½¿ç”¨ Sentinel å®ç°æ¥å£é˜²åˆ·å’Œé™æµ</a></li><li class="sidebar-sub-header"><a href="/course/novel/9.html#é›†æˆ-shardingsphere-jdbc-ä¼˜åŒ–å°è¯´å†…å®¹å­˜å‚¨" class="sidebar-link">é›†æˆ ShardingSphere-JDBC ä¼˜åŒ–å°è¯´å†…å®¹å­˜å‚¨</a></li><li class="sidebar-sub-header"><a href="/course/novel/9.html#é›†æˆ-spring-boot-admin-å®ç°åº”ç”¨ç®¡ç†å’Œç›‘æ§åŠŸèƒ½" class="sidebar-link">é›†æˆ Spring Boot Admin å®ç°åº”ç”¨ç®¡ç†å’Œç›‘æ§åŠŸèƒ½</a></li></ul></li><li><a href="/course/novel/6.html" class="sidebar-link">é¡¹ç›®éƒ¨ç½²</a></li><li><a href="/course/novel/12.html" class="sidebar-link">æ›´å¤š</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="é¡¹ç›®ä¼˜åŒ–"><a href="#é¡¹ç›®ä¼˜åŒ–" class="header-anchor">#</a> é¡¹ç›®ä¼˜åŒ–</h1> <h2 id="ä½¿ç”¨ç­–ç•¥æ¨¡å¼é‡æ„å¤šç³»ç»Ÿç¯å¢ƒä¸‹çš„ç”¨æˆ·è®¤è¯æˆæƒ"><a href="#ä½¿ç”¨ç­–ç•¥æ¨¡å¼é‡æ„å¤šç³»ç»Ÿç¯å¢ƒä¸‹çš„ç”¨æˆ·è®¤è¯æˆæƒ" class="header-anchor">#</a> ä½¿ç”¨ç­–ç•¥æ¨¡å¼é‡æ„å¤šç³»ç»Ÿç¯å¢ƒä¸‹çš„ç”¨æˆ·è®¤è¯æˆæƒ</h2> <h3 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="header-anchor">#</a> éœ€æ±‚</h3> <p>å°è¯´ç²¾å“å±‹ç”±å‰å°é—¨æˆ·ç³»ç»Ÿã€ä½œå®¶åå°ç®¡ç†ç³»ç»Ÿã€å¹³å°åå°ç®¡ç†ç³»ç»Ÿå’Œçˆ¬è™«ç®¡ç†ç³»ç»Ÿä»¥åŠåé¢å¯èƒ½ä¼šæ‰©å±•çš„æ¼«ç”»ç³»ç»Ÿå’Œè§†é¢‘ç³»ç»Ÿç­‰å¤šä¸ªå­ç³»ç»Ÿæ„æˆï¼Œæ˜¯ä¸€ä¸ªå¤æ‚çš„å¤šç³»ç»Ÿç¯å¢ƒã€‚å¹³å°ç«¯çš„åå°ç®¡ç†ç³»ç»Ÿå’Œçˆ¬è™«ç®¡ç†ç³»ç»Ÿè´¦å·æ˜¯ç‹¬ç«‹çš„ï¼Œç”¨æˆ·ç«¯å…¶å®ƒå­ç³»ç»Ÿè¦æ±‚ç»Ÿä¸€è´¦å·ç™»å½•ã€‚é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¦‚ä½•è®¾è®¡æ‰èƒ½ç»Ÿä¸€å¯¹è¿™äº›ç³»ç»Ÿè¿›è¡Œè®¤è¯æˆæƒå‘¢ ï¼Ÿ</p> <h3 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="header-anchor">#</a> å®ç°æ€è·¯</h3> <p>æˆ‘ä»¬æä¾›å¹³å°ç®¡ç†åå°ã€çˆ¬è™«ç®¡ç†åå°å’Œå•ç‚¹ç™»å½•ä¸‰ä¸ªç™»å½•å…¥å£ï¼Œå‰ç«¯åœ¨æ¯ä¸ªç™»å½•å…¥å£ç™»å½•æˆåŠŸä¹‹åéƒ½ä¼šè·å¾—åç«¯è¿”å›çš„ tokenï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦åˆ†åˆ«ä¿å­˜èµ·æ¥ï¼Œ
åœ¨è¯·æ±‚ç›¸åº”ç³»ç»Ÿçš„åç«¯æ¥å£æ—¶ï¼Œé€šè¿‡è¯·æ±‚å¤´æºå¸¦ä¸Šç›¸åº”çš„ tokenã€‚</p> <p>åç«¯éœ€è¦é…ç½®ä¸€ä¸ªç»Ÿä¸€çš„æ‹¦æˆªå™¨ï¼Œæ ¹æ®è¯·æ±‚çš„ URI è¯†åˆ«å‡ºç›¸åº”ç³»ç»Ÿç±»å‹ï¼Œå¹¶å¯¹è¿™äº› token è¿›è¡Œè§£æå¾—åˆ° userIdã€‚è¿™ä¸ªæ—¶å€™å°±å¯ä»¥æ ¹æ®ç”¨æˆ·æ¥é‰´æƒï¼Œå¦‚æœç”¨æˆ·æœ‰æƒè®¿é—®ï¼Œåˆ™æ”¾è¡Œã€‚å¦åˆ™ï¼Œè¿”å›ä¸€ä¸ªç›¸åº”çš„é”™è¯¯ç ç»™å‰ç«¯ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>public class AuthInterceptor implements HandlerInterceptor {

    private final JwtUtils jwtUtils;

    private final ObjectMapper objectMapper;

    @SuppressWarnings(&quot;NullableProblems&quot;)
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        // æ ¡éªŒç™»å½• token
        String token = request.getHeader(SystemConfigConsts.HTTP_AUTH_HEADER_NAME);
        if (!Objects.isNull(token)) {
            String requestUri = request.getRequestURI();
            if (requestUri.contains(ApiRouterConsts.API_FRONT_URL_PREFIX)) {
                // æ ¡éªŒé—¨æˆ·ç³»ç»Ÿç”¨æˆ·æƒé™
                Long userId = jwtUtils.parseToken(token, SystemConfigConsts.NOVEL_FRONT_KEY);
                if (!Objects.isNull(userId)) {
                    // TODO æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¹¶æ ¡éªŒè´¦å·çŠ¶æ€æ˜¯å¦æ­£å¸¸
                    // TODO å…¶å®ƒæƒé™æ ¡éªŒ
                    // è®¤è¯æˆåŠŸ
                    return HandlerInterceptor.super.preHandle(request, response, handler);
                }
            }else if (requestUri.contains(ApiRouterConsts.API_AUTHOR_URL_PREFIX)){
                // TODO æ ¡éªŒä½œå®¶åå°ç®¡ç†ç³»ç»Ÿç”¨æˆ·æƒé™

            }else if (requestUri.contains(ApiRouterConsts.API_ADMIN_URL_PREFIX)){
                // TODO æ ¡éªŒå¹³å°åå°ç®¡ç†ç³»ç»Ÿç”¨æˆ·æƒé™
            }
            //ã€‚ã€‚ã€‚æ›´å¤šç³»ç»Ÿæƒé™æ ¡éªŒ
            // å®Œæ•´å®ç°å¯èƒ½è‡³å°‘å‡ ç™¾è¡Œçš„ä»£ç 

        }
        response.setCharacterEncoding(StandardCharsets.UTF_8.name());
        response.setContentType(MediaType.APPLICATION_JSON_VALUE);
        response.getWriter().write(objectMapper.writeValueAsString(RestResp.fail(ErrorCodeEnum.USER_LOGIN_EXPIRED)));
        return false;
    }
}
</code></pre></div><p>æ­¤æ—¶ï¼Œå¯ä»¥ç®€å•çš„å®ç°åŸºæœ¬çš„æƒé™æ‹¦æˆªåŠŸèƒ½ã€‚ä½†æ˜¯å› ä¸ºæ‰€æœ‰ç³»ç»Ÿçš„è®¤è¯æˆæƒé€»è¾‘éƒ½åœ¨è¿™ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œä»£ç åŠå…¶è‡ƒè‚¿éš¾ä»¥ç»´æŠ¤ã€‚æ¯å½“æŸä¸€ç³»ç»Ÿæˆæƒé€»è¾‘å‘ç”Ÿå˜åŒ–æˆ–è€…æ–°å¢åŠ äº†ä¸€ä¸ªå­ç³»ç»Ÿï¼Œéƒ½éœ€è¦ä¿®æ”¹æ­¤å¤„çš„ä»£ç ã€‚ä¿®æ”¹ä¹‹å‰ä¸ä½†å¿…é¡»å…ˆå®Œå…¨ç†è§£è¿™ä¸€å¤§æ®µä»£ç ï¼Œæ­£ç¡®å®šä½åˆ°éœ€è¦ä¿®æ”¹çš„ä½ç½®ï¼Œè€Œä¸”æå…¶å®¹æ˜“å½±å“åˆ°ä¸ç›¸å¹²çš„å…¶å®ƒç³»ç»Ÿè®¤è¯æˆæƒåŠŸèƒ½ã€‚ä¹…è€Œä¹…ä¹‹å°±æ²¡æœ‰äººæ„¿æ„ç»´æŠ¤è¿™éƒ¨åˆ†ä»£ç äº†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥é‡æ„è¯¥åŠŸèƒ½ã€‚</p> <h3 id="ç­–ç•¥æ¨¡å¼å®šä¹‰"><a href="#ç­–ç•¥æ¨¡å¼å®šä¹‰" class="header-anchor">#</a> ç­–ç•¥æ¨¡å¼å®šä¹‰</h3> <blockquote><p>ç­–ç•¥æ¨¡å¼å®šä¹‰äº†ç®—æ³•æ—ï¼Œåˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥äº’ç›¸æ›¿æ¢ï¼Œæ­¤æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚</p></blockquote> <p>ç­–ç•¥æ¨¡å¼çš„æ ¸å¿ƒåœ¨äºå°è£…å˜åŒ–ï¼Œåœ¨æˆ‘ä»¬ç³»ç»Ÿä¸­å°±æ˜¯å®šä¹‰å¤šä¸ªä¸åŒç³»ç»Ÿçš„è®¤è¯æˆæƒç­–ç•¥ï¼ˆç®—æ³•æ—ï¼‰ï¼Œåˆ†åˆ«å°è£…æˆç‹¬ç«‹çš„ç±»ã€‚æ‹¦æˆªå™¨ï¼ˆå®¢æˆ·ï¼‰åœ¨è¿è¡Œæ—¶æ ¹æ®å…·ä½“çš„è¯·æ±‚ URI æ¥åŠ¨æ€è°ƒç”¨ç›¸åº”ç³»ç»Ÿçš„è®¤è¯æˆæƒç®—æ³•ã€‚å½“æŸä¸€ç³»ç»Ÿçš„è®¤è¯æˆæƒé€»è¾‘å‘ç”Ÿå˜åŒ–æˆ–å¢åŠ æ–°çš„å­ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹æˆ–å¢åŠ ç›¸åº”çš„ç­–ç•¥ç±»ï¼Œè€Œä¸ä¼šå½±å“åˆ°å…¶å®ƒçš„ç­–ç•¥ç±»ï¼ˆå­ç³»ç»Ÿï¼‰å’Œå®¢æˆ·ï¼ˆæ‹¦æˆªå™¨ï¼‰ã€‚</p> <h3 id="é‡æ„æ­¥éª¤"><a href="#é‡æ„æ­¥éª¤" class="header-anchor">#</a> é‡æ„æ­¥éª¤</h3> <ol><li>åœ¨<code>io.github.xxyopen.novel.core.auth</code>åŒ…ä¸‹åˆ›å»º AuthStrategy æ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰äº†ä¸€ä¸ªé»˜è®¤çš„æ–¹æ³•å®ç°ç”¨æˆ·ç«¯æ‰€æœ‰å­ç³»ç»Ÿéƒ½éœ€è¦çš„ç»Ÿä¸€è´¦å·è®¤è¯é€»è¾‘å’Œä¸€ä¸ªå°è£…å„ä¸ªç³»ç»Ÿç‹¬ç«‹è®¤è¯æˆæƒé€»è¾‘çš„å¾…å®ç°æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼Œä½œå®¶ç®¡ç†ç³»ç»Ÿè¿˜éœ€è¦éªŒè¯ä½œå®¶è´¦å·æ˜¯å¦å­˜åœ¨å’Œä½œå®¶çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼‰ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>/**
 * ç­–ç•¥æ¨¡å¼å®ç°ç”¨æˆ·è®¤è¯æˆæƒåŠŸèƒ½
 *
 * @author xiongxiaoyang
 * @date 2022/5/18
 */
public interface AuthStrategy {

    /**
     * ç”¨æˆ·è®¤è¯æˆæƒ
     *
     * @param token      ç™»å½• token
     * @param requestUri è¯·æ±‚çš„ URI
     * @throws BusinessException è®¤è¯å¤±è´¥åˆ™æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸
     */
    void auth(String token, String requestUri) throws BusinessException;

    /**
     * å‰å°å¤šç³»ç»Ÿå•ç‚¹ç™»å½•ç»Ÿä¸€è´¦å·è®¤è¯ï¼ˆé—¨æˆ·ç³»ç»Ÿã€ä½œå®¶ç³»ç»Ÿä»¥åŠåé¢ä¼šæ‰©å±•çš„æ¼«ç”»ç³»ç»Ÿå’Œè§†é¢‘ç³»ç»Ÿç­‰ï¼‰
     *
     * @param jwtUtils             jwt å·¥å…·
     * @param userInfoCacheManager ç”¨æˆ·ç¼“å­˜ç®¡ç†å¯¹è±¡
     * @param token                token ç™»å½• token
     * @return ç”¨æˆ·ID
     */
    default Long authSSO(JwtUtils jwtUtils, UserInfoCacheManager userInfoCacheManager,
        String token) {
        if (!StringUtils.hasText(token)) {
            // token ä¸ºç©º
            throw new BusinessException(ErrorCodeEnum.USER_LOGIN_EXPIRED);
        }
        Long userId = jwtUtils.parseToken(token, SystemConfigConsts.NOVEL_FRONT_KEY);
        if (Objects.isNull(userId)) {
            // token è§£æå¤±è´¥
            throw new BusinessException(ErrorCodeEnum.USER_LOGIN_EXPIRED);
        }
        UserInfoDto userInfo = userInfoCacheManager.getUser(userId);
        if (Objects.isNull(userInfo)) {
            // ç”¨æˆ·ä¸å­˜åœ¨
            throw new BusinessException(ErrorCodeEnum.USER_ACCOUNT_NOT_EXIST);
        }
        // è®¾ç½® userId åˆ°å½“å‰çº¿ç¨‹
        UserHolder.setUserId(userId);
        // è¿”å› userId
        return userId;
    }

}
</code></pre></div><ol start="2"><li>æ¥ç€åœ¨è¯¥åŒ…ä¸‹åˆ›å»ºå„ä¸ªç³»ç»Ÿçš„è®¤è¯æˆæƒç­–ç•¥ç±»ï¼Œå®ç°ä¸Šè¿°çš„ AuthStrategy æ¥å£ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>/**
 * å‰å°é—¨æˆ·ç³»ç»Ÿ è®¤è¯æˆæƒç­–ç•¥
 *
 * @author xiongxiaoyang
 * @date 2022/5/18
 */
@Component
@RequiredArgsConstructor
public class FrontAuthStrategy implements AuthStrategy {

    private final JwtUtils jwtUtils;

    private final UserInfoCacheManager userInfoCacheManager;

    @Override
    public void auth(String token, String requestUri) throws BusinessException {
        // ç»Ÿä¸€è´¦å·è®¤è¯
        authSSO(jwtUtils, userInfoCacheManager, token);
    }

}
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>/**
 * ä½œå®¶åå°ç®¡ç†ç³»ç»Ÿ è®¤è¯æˆæƒç­–ç•¥
 *
 * @author xiongxiaoyang
 * @date 2022/5/18
 */
@Component
@RequiredArgsConstructor
public class AuthorAuthStrategy implements AuthStrategy {

    private final JwtUtils jwtUtils;

    private final UserInfoCacheManager userInfoCacheManager;

    private final AuthorInfoCacheManager authorInfoCacheManager;

    /**
     * ä¸éœ€è¦è¿›è¡Œä½œå®¶æƒé™è®¤è¯çš„ URI
     */
    private static final List&lt;String&gt; EXCLUDE_URI = List.of(
        ApiRouterConsts.API_AUTHOR_URL_PREFIX + &quot;/register&quot;,
        ApiRouterConsts.API_AUTHOR_URL_PREFIX + &quot;/status&quot;
    );

    @Override
    public void auth(String token, String requestUri) throws BusinessException {
        // ç»Ÿä¸€è´¦å·è®¤è¯
        Long userId = authSSO(jwtUtils, userInfoCacheManager, token);
        if (EXCLUDE_URI.contains(requestUri)) {
            // è¯¥è¯·æ±‚ä¸éœ€è¦è¿›è¡Œä½œå®¶æƒé™è®¤è¯
            return;
        }
        // ä½œå®¶æƒé™æ ¡éªŒ
        AuthorInfoDto authorInfo = authorInfoCacheManager.getAuthor(userId);
        if (Objects.isNull(authorInfo)) {
            // ä½œå®¶è´¦å·ä¸å­˜åœ¨ï¼Œæ— æƒè®¿é—®ä½œå®¶ä¸“åŒº
            throw new BusinessException(ErrorCodeEnum.USER_UN_AUTH);
        }

        // è®¾ç½®ä½œå®¶IDåˆ°å½“å‰çº¿ç¨‹
        UserHolder.setAuthorId(authorInfo.getId());
    }
    
}
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>/**
 * å¹³å°åå°ç®¡ç†ç³»ç»Ÿ è®¤è¯æˆæƒç­–ç•¥
 *
 * @author xiongxiaoyang
 * @date 2022/5/18
 */
@Component
@RequiredArgsConstructor
public class AdminAuthStrategy implements AuthStrategy {

    @Override
    public void auth(String token, String requestUri) throws BusinessException {
        // TODO å¹³å°åå° token æ ¡éªŒ
    }
    
}
</code></pre></div><ol start="3"><li>æœ€ååœ¨æ‹¦æˆªå™¨ä¸­æ ¹æ®è¯·æ±‚ URI åŠ¨æ€è°ƒç”¨ç›¸åº”ç­–ç•¥ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>/**
 * è®¤è¯æˆæƒ æ‹¦æˆªå™¨
 * ä¸ºäº†æ³¨å…¥å…¶å®ƒçš„ Spring beansï¼Œéœ€è¦é€šè¿‡ @Component æ³¨è§£å°†è¯¥æ‹¦æˆªå™¨æ³¨å†Œåˆ° Spring ä¸Šä¸‹æ–‡
 *
 * @author xiongxiaoyang
 * @date 2022/5/18
 */
@Component
@RequiredArgsConstructor
public class AuthInterceptor implements HandlerInterceptor {

    private final Map&lt;String,AuthStrategy&gt; authStrategy;

    private final ObjectMapper objectMapper;

    @SuppressWarnings(&quot;NullableProblems&quot;)
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        // è·å–ç™»å½• JWT
        String token = request.getHeader(SystemConfigConsts.HTTP_AUTH_HEADER_NAME);

        // è·å–è¯·æ±‚çš„ URI
        String requestUri = request.getRequestURI();

        // æ ¹æ®è¯·æ±‚çš„ URI å¾—åˆ°è®¤è¯ç­–ç•¥
        String subUri = requestUri.substring(ApiRouterConsts.API_URL_PREFIX.length() + 1);
        String systemName = subUri.substring(0,subUri.indexOf(&quot;/&quot;));
        String authStrategyName = String.format(&quot;%sAuthStrategy&quot;,systemName);

        // å¼€å§‹è®¤è¯
        try {
            authStrategy.get(authStrategyName).auth(token);
            return HandlerInterceptor.super.preHandle(request, response, handler);
        }catch (BusinessException exception){
            // è®¤è¯å¤±è´¥
            response.setCharacterEncoding(StandardCharsets.UTF_8.name());
            response.setContentType(MediaType.APPLICATION_JSON_VALUE);
            response.getWriter().write(objectMapper.writeValueAsString(RestResp.fail(exception.getErrorCodeEnum())));
            return false;
        }
    }

    @SuppressWarnings(&quot;NullableProblems&quot;)
    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        // æ¸…ç†å½“å‰çº¿ç¨‹ä¿å­˜çš„ç”¨æˆ·æ•°æ®
        UserHolder.clear();
        HandlerInterceptor.super.postHandle(request, response, handler, modelAndView);
    }
}
</code></pre></div><h2 id="ä½¿ç”¨è£…é¥°è€…æ¨¡å¼è§£å†³è¡¨å•å½¢å¼ä¼ å‚çš„-xss-æ”»å‡»"><a href="#ä½¿ç”¨è£…é¥°è€…æ¨¡å¼è§£å†³è¡¨å•å½¢å¼ä¼ å‚çš„-xss-æ”»å‡»" class="header-anchor">#</a> ä½¿ç”¨è£…é¥°è€…æ¨¡å¼è§£å†³è¡¨å•å½¢å¼ä¼ å‚çš„ XSS æ”»å‡»</h2> <h3 id="xss-æ”»å‡»å®šä¹‰"><a href="#xss-æ”»å‡»å®šä¹‰" class="header-anchor">#</a> XSS æ”»å‡»å®šä¹‰</h3> <blockquote><p>è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ï¼Œæ˜¯æœ€æ™®éçš„ Web åº”ç”¨å®‰å…¨æ¼æ´ã€‚èƒ½å¤Ÿä½¿å¾—æ”»å‡»è€…åµŒå…¥æ¶æ„è„šæœ¬ä»£ç åˆ°æ­£å¸¸ç”¨æˆ·ä¼šè®¿é—®åˆ°çš„é¡µé¢ä¸­ï¼Œå½“æ­£å¸¸ç”¨æˆ·è®¿é—®è¯¥é¡µé¢æ—¶ï¼Œåˆ™å¯å¯¼è‡´åµŒå…¥çš„æ¶æ„è„šæœ¬ä»£ç çš„æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚</p></blockquote> <p>ä¾‹å¦‚ï¼Œåœ¨ novel é¡¹ç›®ä¸­ï¼Œå¦‚æœæ²¡æœ‰é¢„é˜² XSS æ”»å‡»çš„è¯ã€‚æ¶æ„ç”¨æˆ·è¿›å…¥åˆ°æˆ‘ä»¬å°è¯´è¯„è®ºåŒºï¼Œå‘è¡¨å¦‚ä¸‹è¯„è®ºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;script&gt;
    // è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„è®¤è¯ token
    token = localStorage.getItem('Authorization');
    // TODO é€šè¿‡ ajax è¯·æ±‚å‘é€è¯¥ token åˆ°æ¶æ„ç”¨æˆ·çš„æŒ‡å®šæœåŠ¡å™¨
&lt;/script&gt;
</code></pre></div><p>å½“å…¶ä»–æ­£å¸¸ç”¨æˆ·ç™»å½•æˆåŠŸè¿›å…¥åˆ°å°è¯´è¯„è®ºåŒºåï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œä¸Šè¿°çš„ javascript è„šæœ¬ï¼Œè‡ªå·±çš„ç™»å½• token ä¼šè¢«å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ä¸Šã€‚æ”»å‡»è€…æ‹¿åˆ°è¯¥ token åå³å¯åˆ©ç”¨è¯¥ token æ¥å†’å……æ­£å¸¸ç”¨æˆ·è¿›è¡Œä¸€ç³»åˆ—ä¾‹å¦‚èµ„é‡‘è½¬è´¦ç­‰å±é™©æ“ä½œã€‚</p> <p>æ”»å‡»è€…è¿˜å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åœ¨æˆ‘ä»¬ç³»ç»Ÿä¸­æ’å…¥æ¶æ„å†…å®¹ï¼ˆä¾‹å¦‚å¹¿å‘Šï¼‰ã€é‡å®šå‘ç”¨æˆ·ï¼ˆé‡å®šå‘åˆ°é»„èµŒæ¯’ç½‘ç«™ï¼‰ç­‰ã€‚</p> <p>æ³¨ï¼šäººä»¬ç»å¸¸å°†è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross Site Scriptingï¼‰ç¼©å†™ä¸º CSSï¼Œä½†è¿™ä¼šä¸å±‚å æ ·å¼è¡¨ï¼ˆCascading Style Sheetsï¼ŒCSSï¼‰çš„ç¼©å†™æ··æ·†ã€‚å› æ­¤ï¼Œæœ‰äººå°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸º XSSã€‚</p> <h3 id="è£…é¥°è€…æ¨¡å¼å®šä¹‰"><a href="#è£…é¥°è€…æ¨¡å¼å®šä¹‰" class="header-anchor">#</a> è£…é¥°è€…æ¨¡å¼å®šä¹‰</h3> <blockquote><p>åŠ¨æ€å°†è´£ä»»é™„åŠ åˆ°å¯¹è±¡ä¸Šã€‚æƒ³è¦æ‰©å±•åŠŸèƒ½ï¼Œè£…é¥°è€…æä¾›æœ‰åˆ«äºç»§æ‰¿çš„å¦ä¸€ç§é€‰æ‹©ã€‚</p></blockquote> <p>è£…é¥°è€…å¯ä»¥åœ¨è¢«è£…é¥°è€…çš„è¡Œä¸ºå‰é¢ä¸/æˆ–åé¢åŠ ä¸Šè‡ªå·±çš„è¡Œä¸ºï¼Œç”šè‡³å°†è¢«è£…é¥°è€…çš„è¡Œä¸ºæ•´ä¸ªå–ä»£æ‰ï¼Œè€Œè¾¾åˆ°ç‰¹å®šçš„ç›®çš„ã€‚</p> <p>Spring MVC æ˜¯é€šè¿‡ HttpServletRequest çš„ getParameterValues æ–¹æ³•æ¥è·å–ç”¨æˆ·ç«¯çš„è¯·æ±‚å‚æ•°å¹¶ç»‘å®šåˆ°æˆ‘ä»¬ @RequestMapping æ–¹æ³•å®šä¹‰çš„å¯¹è±¡ä¸Šã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è£…é¥° HttpServletRequest å¯¹è±¡ï¼Œåœ¨ getParameterValues æ–¹æ³•é‡ŒåŠ ä¸Šè‡ªå·±çš„è¡Œä¸ºï¼ˆå¯¹è¯·æ±‚å‚æ•°å€¼é‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼‰æ¥è§£å†³ XSS æ”»å‡»ã€‚</p> <p>ç”±äº Servlet Api æä¾›äº† HttpServletRequest æ¥å£çš„ä¾¿æ·å®ç° HttpServletRequestWrapper ç±»ï¼Œè¯¥ç±»å·²ç»å®ç°äº†è£…é¥°è€…æ¨¡å¼ï¼Œæˆ‘ä»¬ç›´æ¥ç»§æ‰¿è¯¥ç±»å¹¶é‡å†™é‡Œé¢çš„ getParameterValues æ–¹æ³•å³å¯ã€‚</p> <h3 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="header-anchor">#</a> å®ç°æ­¥éª¤</h3> <ol><li>æ–°å»º XssHttpServletRequestWrapper è£…é¥°è€…ç±»ç»§æ‰¿ HttpServletRequestWrapper ç±»ï¼Œå¹¶é‡å†™ getParameterValues æ–¹æ³•ï¼Œå¯¹é‡Œé¢å­—ç¬¦ä¸²çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>public class XssHttpServletRequestWrapper extends HttpServletRequestWrapper {

    private static final Map&lt;String,String&gt; REPLACE_RULE = new HashMap&lt;&gt;();

    static {
        REPLACE_RULE.put(&quot;&lt;&quot;, &quot;&amp;lt;&quot;);
        REPLACE_RULE.put(&quot;&gt;&quot;, &quot;&amp;gt;&quot;);
    }

    public XssHttpServletRequestWrapper(HttpServletRequest request) {
        super(request);
    }

    @Override
    public String[] getParameterValues(String name) {
        String[] values = super.getParameterValues(name);
        if (values != null) {
            int length = values.length;
            String[] escapeValues = new String[length];
            for (int i = 0; i &lt; length; i++) {
                escapeValues[i] = values[i];
                int index = i;
                REPLACE_RULE.forEach((k, v)-&gt; escapeValues[index] = escapeValues[index].replaceAll(k, v));
            }
            return escapeValues;
        }
        return new String[0];
    }
}
</code></pre></div><ol start="2"><li>æ–°å»º XssFilter è¿‡æ»¤å™¨ï¼Œä½¿ç”¨ XssHttpServletRequestWrapper è£…é¥°è€…å¯¹è±¡æ›¿æ¢æ‰ HttpServletRequest è¢«è£…é¥°è€…å¯¹è±¡ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        XssHttpServletRequestWrapper xssRequest = new XssHttpServletRequestWrapper((HttpServletRequest) servletRequest);
        filterChain.doFilter(xssRequest, servletResponse);
    }
</code></pre></div><h2 id="ä¸€è¡Œä»£ç è§£å†³-json-å½¢å¼ä¼ å‚çš„-xss-æ”»å‡»"><a href="#ä¸€è¡Œä»£ç è§£å†³-json-å½¢å¼ä¼ å‚çš„-xss-æ”»å‡»" class="header-anchor">#</a> ä¸€è¡Œä»£ç è§£å†³ JSON å½¢å¼ä¼ å‚çš„ XSS æ”»å‡»</h2> <h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="header-anchor">#</a> é—®é¢˜</h3> <p>å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œå¯¹äº POST å’Œ PUT ç±»å‹çš„è¯·æ±‚æ–¹æ³•ï¼Œåç«¯åŸºæœ¬éƒ½æ˜¯é€šè¿‡ @RequestBody æ³¨è§£æ¥æ”¶ application/json æ ¼å¼çš„è¯·æ±‚æ•°æ®ï¼Œæ‰€ä»¥ä»¥å‰é€šè¿‡è¿‡æ»¤å™¨ + è£…é¥°å™¨ HttpServletRequestWrapper æ¥è§£å†³ XSS æ”»å‡»çš„æ–¹å¼å¹¶ä¸é€‚ç”¨ã€‚åœ¨ Spring Boot ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®å…¨å±€çš„ Json ååºåˆ—åŒ–å™¨è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦æ¥è§£å†³ XSS æ”»å‡»ã€‚</p> <h3 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="header-anchor">#</a> å®ç°ä»£ç </h3> <div class="language- extra-class"><pre class="language-text"><code>/**
 * JSON å…¨å±€ååºåˆ—åŒ–å™¨
 *
 * @author xiongxiaoyang
 * @date 2022/5/21
 */
@JsonComponent
public class GlobalJsonDeserializer {

    /**
     * å­—ç¬¦ä¸²ååºåˆ—åŒ–å™¨
     * è¿‡æ»¤ç‰¹æ®Šå­—ç¬¦ï¼Œè§£å†³ XSS æ”»å‡»
     */
    public static class StringDeserializer extends JsonDeserializer&lt;String&gt; {

        @Override
        public String deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException, JacksonException {
		// å®é™…ä»£ç å°±è¿™ä¸€è¡Œ
            return jsonParser.getValueAsString()
                    .replace(&quot;&lt;&quot;, &quot;&amp;lt;&quot;)
                    .replace(&quot;&gt;&quot;, &quot;&amp;gt;&quot;);
        }
    }
}
</code></pre></div><h2 id="é›†æˆ-elasticsearch-8-å®ç°æœç´¢å¼•æ“åŠ¨æ€åˆ‡æ¢"><a href="#é›†æˆ-elasticsearch-8-å®ç°æœç´¢å¼•æ“åŠ¨æ€åˆ‡æ¢" class="header-anchor">#</a> é›†æˆ Elasticsearch 8ï¼Œå®ç°æœç´¢å¼•æ“åŠ¨æ€åˆ‡æ¢</h2> <ol><li><p><a href="/course/novel/4.html#æœç´¢å¼•æ“-elasticsearch-é›†æˆä¸é…ç½®">Elasticsearch é›†æˆä¸é…ç½®</a></p></li> <li><p>åœ¨ application.yml ä¸­å¢åŠ  <code>spring.elasticsearch.enable</code> é…ç½®é¡¹ç”¨æ¥æ§åˆ¶ Elasticsearch æœç´¢å¼•æ“åŠŸèƒ½æ˜¯å¦å¼€å¯ï¼š</p></li></ol> <div class="language- extra-class"><pre class="language-text"><code>spring:
  elasticsearch:
    # æ˜¯å¦å¼€å¯ elasticsearch æœç´¢å¼•æ“åŠŸèƒ½ï¼štrue-å¼€å¯ false-ä¸å¼€å¯
    enable: false
</code></pre></div><ol start="3"><li>æ–°å»ºæœç´¢æœåŠ¡ç±»ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>/**
 * æœç´¢ æœåŠ¡ç±»
 *
 * @author xiongxiaoyang
 * @date 2022/5/23
 */
public interface SearchService {

    /**
     * å°è¯´æœç´¢
     *
     * @param condition æœç´¢æ¡ä»¶
     * @return æœç´¢ç»“æœ
     */
    RestResp&lt;PageRespDto&lt;BookInfoRespDto&gt;&gt; searchBooks(BookSearchReqDto condition);

}
</code></pre></div><ol start="4"><li>æ–°å»º<code>æ•°æ®åº“æœç´¢</code>æœåŠ¡å®ç°ç±»ï¼Œå®ç°ä»æ•°æ®åº“ä¸­æ£€ç´¢å°è¯´çš„ä¸šåŠ¡é€»è¾‘ï¼Œç”±é…ç½®é¡¹<code>spring.elasticsearch.enable</code>æ§åˆ¶å½“ elasticsearch å…³é—­æ—¶ç”Ÿæ•ˆï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>/**
 * æ•°æ®åº“æœç´¢ æœåŠ¡å®ç°ç±»
 *
 * @author xiongxiaoyang
 * @date 2022/5/23
 */
@ConditionalOnProperty(prefix = &quot;spring.elasticsearch&quot;, name = &quot;enable&quot;, havingValue = &quot;false&quot;)
@Service
@RequiredArgsConstructor
@Slf4j
public class DbSearchServiceImpl implements SearchService {

    private final BookInfoMapper bookInfoMapper;

    @Override
    public RestResp&lt;PageRespDto&lt;BookInfoRespDto&gt;&gt; searchBooks(BookSearchReqDto condition) {
        Page&lt;BookInfoRespDto&gt; page = new Page&lt;&gt;();
        page.setCurrent(condition.getPageNum());
        page.setSize(condition.getPageSize());
        List&lt;BookInfo&gt; bookInfos = bookInfoMapper.searchBooks(page, condition);
        return RestResp.ok(PageRespDto.of(condition.getPageNum(), condition.getPageSize(), page.getTotal()
                , bookInfos.stream().map(v -&gt; BookInfoRespDto.builder()
                        .id(v.getId())
                        .bookName(v.getBookName())
                        .categoryId(v.getCategoryId())
                        .categoryName(v.getCategoryName())
                        .authorId(v.getAuthorId())
                        .authorName(v.getAuthorName())
                        .wordCount(v.getWordCount())
                        .lastChapterName(v.getLastChapterName())
                        .build()).toList()));
    }

}
</code></pre></div><ol start="5"><li>æ–°å»º<code>Elasticsearch æœç´¢å¼•æ“æœç´¢</code>æœåŠ¡å®ç°ç±»ï¼Œå®ç°ä» Elasticsearch ä¸­æ£€ç´¢å°è¯´çš„ä¸šåŠ¡é€»è¾‘ï¼Œç”±é…ç½®é¡¹<code>spring.elasticsearch.enable</code>æ§åˆ¶å½“ elasticsearch å¼€å¯æ—¶ç”Ÿæ•ˆï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>/**
 * Elasticsearch æœç´¢ æœåŠ¡å®ç°ç±»
 *
 * @author xiongxiaoyang
 * @date 2022/5/23
 */
@ConditionalOnProperty(prefix = &quot;spring.elasticsearch&quot;, name = &quot;enable&quot;, havingValue = &quot;true&quot;)
@Service
@RequiredArgsConstructor
@Slf4j
public class EsSearchServiceImpl implements SearchService {

    private final ElasticsearchClient esClient;

    @SneakyThrows
    @Override
    public RestResp&lt;PageRespDto&lt;BookInfoRespDto&gt;&gt; searchBooks(BookSearchReqDto condition) {

        SearchResponse&lt;EsBookDto&gt; response = esClient.search(s -&gt; {

                    SearchRequest.Builder searchBuilder = s.index(EsConsts.IndexEnum.BOOK.getName());
                    buildSearchCondition(condition, searchBuilder);
                    // æ’åº
                    if (!StringUtils.isBlank(condition.getSort())) {
                        searchBuilder.sort(o -&gt;
                                o.field(f -&gt; f.field(StringUtils
                                                .underlineToCamel(condition.getSort().split(&quot; &quot;)[0]))
                                        .order(SortOrder.Desc))
                        );
                    }
                    // åˆ†é¡µ
                    searchBuilder.from((condition.getPageNum() - 1) * condition.getPageSize())
                            .size(condition.getPageSize());

                    return searchBuilder;
                },
                EsBookDto.class
        );

        TotalHits total = response.hits().total();

        List&lt;BookInfoRespDto&gt; list = new ArrayList&lt;&gt;();
        List&lt;Hit&lt;EsBookDto&gt;&gt; hits = response.hits().hits();
        for (Hit&lt;EsBookDto&gt; hit : hits) {
            EsBookDto book = hit.source();
            assert book != null;
            list.add(BookInfoRespDto.builder()
                    .id(book.getId())
                    .bookName(book.getBookName())
                    .categoryId(book.getCategoryId())
                    .categoryName(book.getCategoryName())
                    .authorId(book.getAuthorId())
                    .authorName(book.getAuthorName())
                    .wordCount(book.getWordCount())
                    .lastChapterName(book.getLastChapterName())
                    .build());
        }
        assert total != null;
        return RestResp.ok(PageRespDto.of(condition.getPageNum(), condition.getPageSize(), total.value(), list));
    
    }

    /**
    * æ„å»ºæŸ¥è¯¢æ¡ä»¶
    */
    private void buildSearchCondition(BookSearchReqDto condition, SearchRequest.Builder searchBuilder) {

        BoolQuery boolQuery = BoolQuery.of(b -&gt; {

            if (!StringUtils.isBlank(condition.getKeyword())) {
                // å…³é”®è¯åŒ¹é…
                b.must((q -&gt; q.multiMatch(t -&gt; t
                        .fields(&quot;bookName^2&quot;,&quot;authorName^1.8&quot;,&quot;bookDesc^0.1&quot;)
                        .query(condition.getKeyword())
                )
                ));
            }

            // ç²¾ç¡®æŸ¥è¯¢
            if (Objects.nonNull(condition.getWorkDirection())) {
                b.must(TermQuery.of(m -&gt; m
                        .field(&quot;workDirection&quot;)
                        .value(condition.getWorkDirection())
                )._toQuery());
            }

            if (Objects.nonNull(condition.getCategoryId())) {
                b.must(TermQuery.of(m -&gt; m
                        .field(&quot;categoryId&quot;)
                        .value(condition.getCategoryId())
                )._toQuery());
            }

            // èŒƒå›´æŸ¥è¯¢
            if (Objects.nonNull(condition.getWordCountMin())) {
                b.must(RangeQuery.of(m -&gt; m
                        .field(&quot;wordCount&quot;)
                        .gte(JsonData.of(condition.getWordCountMin()))
                )._toQuery());
            }

            if (Objects.nonNull(condition.getWordCountMax())) {
                b.must(RangeQuery.of(m -&gt; m
                        .field(&quot;wordCount&quot;)
                        .lt(JsonData.of(condition.getWordCountMax()))
                )._toQuery());
            }

            if (Objects.nonNull(condition.getUpdateTimeMin())) {
                b.must(RangeQuery.of(m -&gt; m
                        .field(&quot;lastChapterUpdateTime&quot;)
                        .gte(JsonData.of(condition.getUpdateTimeMin().getTime()))
                )._toQuery());
            }

            return b;

        });

        searchBuilder.query(q -&gt; q.bool(boolQuery));

    }
}
</code></pre></div><ol start="6"><li><code>BookController</code> ä¸­æ³¨å…¥ <code>SearchService</code> beanï¼Œè°ƒç”¨<code>searchBooks</code>æ–¹æ³•å®ç°æŒ‰é…ç½®åŠ¨æ€åˆ‡æ¢æœç´¢å¼•æ“çš„åŠŸèƒ½ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>public class BookController {

    private final SearchService searchService;

    /**
     * å°è¯´æœç´¢æ¥å£
     */
    @GetMapping(&quot;search_list&quot;)
    public RestResp&lt;PageRespDto&lt;BookInfoRespDto&gt;&gt; searchBooks(BookSearchReqDto condition) {
        return searchService.searchBooks(condition);
    }

}
</code></pre></div><h2 id="ä½¿ç”¨-rabbitmq-åˆ·æ–°-es-redis-caffeine-ç­‰å°è¯´å‰¯æœ¬æ•°æ®"><a href="#ä½¿ç”¨-rabbitmq-åˆ·æ–°-es-redis-caffeine-ç­‰å°è¯´å‰¯æœ¬æ•°æ®" class="header-anchor">#</a> ä½¿ç”¨ RabbitMQ åˆ·æ–° ES/Redis/Caffeine ç­‰å°è¯´å‰¯æœ¬æ•°æ®</h2> <p>åœ¨ novel åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œæ•°æ®åº“ä¸­çš„å°è¯´ä¿¡æ¯å¯èƒ½ä¼šåœ¨å¤šä¸ªåœ°æ–¹ä¿å­˜ä¸€ä»½å‰¯æœ¬æ•°æ®ã€‚ä¾‹å¦‚ï¼Œä¸ºäº†å‡è½»æ•°æ®åº“å‹åŠ›ï¼Œæé«˜å¹¶å‘å’Œç³»ç»Ÿæ€§èƒ½çš„æœ¬åœ°ç¼“å­˜ Caffeine å’Œåˆ†å¸ƒå¼ç¼“å­˜ Redisã€ä¸ºäº†å®ç°å°è¯´å…¨æ–‡é«˜çº§æ£€ç´¢çš„ Elasticsearch æœç´¢å¼•æ“ç­‰ã€‚æœ‰æ—¶ä¸ºäº†åº”å¯¹å°è¯´è¯¦æƒ…é¡µçš„é«˜å¹¶å‘è®¿é—®å’Œ SEO ä¼˜åŒ–ï¼Œæˆ‘ä»¬è¿˜ä¼šé€‰æ‹©ä¸ºæ¯ä¸€æœ¬å°è¯´ç”Ÿæˆé™æ€åŒ–çš„é¡µé¢ï¼Œé€šè¿‡ Nginx æˆ– CDN æ¥è®¿é—®ã€‚</p> <p>æ­¤æ—¶ï¼Œå¦‚æœå°è¯´ä¿¡æ¯å‘ç”Ÿå˜æ›´ï¼Œé‚£ä¹ˆå¦‚ä½•é€šçŸ¥æ‰€æœ‰çš„å‰¯æœ¬æ•°æ®å’Œé™æ€é¡µé¢æ›´æ–°å‘¢ï¼Ÿå¦‚æœéšç€ä¸šåŠ¡çš„å‘å±•å’Œç³»ç»Ÿçš„æ¼”è¿›ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ MongoDB ä¸­å¢åŠ ä¸€ä»½å­˜å‚¨å‰¯æœ¬ï¼Œé‚£ä¹ˆæ€ä¹ˆåœ¨ä¸ä¿®æ”¹è°ƒç”¨æ–¹ï¼ˆæ‰€æœ‰å°è¯´ä¿¡æ¯å‘ç”Ÿå˜æ›´çš„åœ°æ–¹ã€‚ä¾‹å¦‚ï¼Œä½œå®¶æ›´æ–°å°è¯´ä¿¡æ¯ã€ä½œå®¶å‘å¸ƒæ–°çš„ç« èŠ‚æˆ–å¹³å°ä¸‹æ¶è¿è§„å°è¯´ç­‰åœºæ™¯ï¼‰ä»£ç ï¼Œä¸å½±å“åŸå…ˆåŠŸèƒ½ï¼ˆå…¶å®ƒå‰¯æœ¬æ•°æ®çš„åˆ·æ–°ï¼‰çš„åŒæ—¶ï¼Œåˆèƒ½åŠæ—¶åˆ·æ–° MongoDB ä¸­çš„å‰¯æœ¬æ•°æ®ï¼Œå®ç°æ¨¡å—é—´çš„è§£è€¦å‘¢ï¼Ÿ</p> <p>æˆ‘ä»¬é€šè¿‡æ¶ˆæ¯ä¸­é—´ä»¶æ¥è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œå®ç°æ­¥éª¤å¦‚ä¸‹ï¼š</p> <ol><li><p><a href="/course/novel/4.html#spring-amqp-é›†æˆä¸é…ç½®">Spring AMQP é›†æˆä¸é…ç½®</a></p></li> <li><p>åœ¨<code>io.github.xxyopen.novel.core.constant</code>åŒ…ä¸‹åˆ›å»º AMQP ç›¸å…³å¸¸é‡ç±»ï¼š</p></li></ol> <div class="language- extra-class"><pre class="language-text"><code>/**
 * AMQP ç›¸å…³å¸¸é‡
 *
 * @author xiongxiaoyang
 * @date 2022/5/25
 */
public class AmqpConsts {

    /**
     * å°è¯´ä¿¡æ¯æ”¹å˜ MQ
     * */
    public static class BookChangeMq{

        /**
         * å°è¯´ä¿¡æ¯æ”¹å˜äº¤æ¢æœº
         * */
        public static final String EXCHANGE_NAME = &quot;EXCHANGE-BOOK-CHANGE&quot;;

        /**
         * Elasticsearch book ç´¢å¼•æ›´æ–°çš„é˜Ÿåˆ—
         * */
        public static final String QUEUE_ES_UPDATE = &quot;QUEUE-ES-BOOK-UPDATE&quot;;

        /**
         * Redis book ç¼“å­˜æ›´æ–°çš„é˜Ÿåˆ—
         * */
        public static final String QUEUE_REDIS_UPDATE = &quot;QUEUE-REDIS-BOOK-UPDATE&quot;;

        // ... å…¶å®ƒçš„æ›´æ–°é˜Ÿåˆ—

    }

}
</code></pre></div><ol start="3"><li>åœ¨<code>io.github.xxyopen.novel.core.config</code>åŒ…ä¸‹åˆ›å»º AMQP é…ç½®ç±»ï¼Œé…ç½®å„ä¸ªäº¤æ¢æœºã€é˜Ÿåˆ—ä»¥åŠç»‘å®šå…³ç³»ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>/**
 * AMQP é…ç½®ç±»
 *
 * @author xiongxiaoyang
 * @date 2022/5/25
 */
@Configuration
public class AmqpConfig {

    /**
     * å°è¯´ä¿¡æ¯æ”¹å˜äº¤æ¢æœº
     */
    @Bean
    public FanoutExchange bookChangeExchange() {
        return new FanoutExchange(AmqpConsts.BookChangeMq.EXCHANGE_NAME);
    }

    /**
     * Elasticsearch book ç´¢å¼•æ›´æ–°é˜Ÿåˆ—
     */
    @Bean
    public Queue esBookUpdateQueue() {
        return new Queue(AmqpConsts.BookChangeMq.QUEUE_ES_UPDATE);
    }

    /**
     * Elasticsearch book ç´¢å¼•æ›´æ–°é˜Ÿåˆ—ç»‘å®šåˆ°å°è¯´ä¿¡æ¯æ”¹å˜äº¤æ¢æœº
     */
    @Bean
    public Binding esBookUpdateQueueBinding() {
        return BindingBuilder.bind(esBookUpdateQueue()).to(bookChangeExchange());
    }

    // ... å…¶å®ƒçš„æ›´æ–°é˜Ÿåˆ—ä»¥åŠç»‘å®šå…³ç³»

}
</code></pre></div><ol start="4"><li>åœ¨<code>io.github.xxyopen.novel.manager.mq</code>åŒ…ä¸‹åˆ›å»º AMQP æ¶ˆæ¯ç®¡ç†ç±»ï¼Œç”¨æ¥å‘é€å„ç§ AMQP æ¶ˆæ¯ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>/**
 * AMQP æ¶ˆæ¯ç®¡ç†ç±»
 *
 * @author xiongxiaoyang
 * @date 2022/5/25
 */
@Component
@RequiredArgsConstructor
public class AmqpMsgManager {

    private final AmqpTemplate amqpTemplate;

    @Value(&quot;${spring.amqp.enable}&quot;)
    private String enableAmqp;

    /**
     * å‘é€å°è¯´ä¿¡æ¯æ”¹å˜æ¶ˆæ¯
     */
    public void sendBookChangeMsg(Long bookId) {
        if (Objects.equals(enableAmqp, CommonConsts.TRUE)) {
            sendAmqpMessage(amqpTemplate, AmqpConsts.BookChangeMq.EXCHANGE_NAME, null, bookId);
        }
    }

    private void sendAmqpMessage(AmqpTemplate amqpTemplate, String exchange, String routingKey, Object message) {
        // å¦‚æœåœ¨äº‹åŠ¡ä¸­åˆ™åœ¨äº‹åŠ¡æ‰§è¡Œå®Œæˆåå†å‘é€ï¼Œå¦åˆ™å¯ä»¥ç›´æ¥å‘é€
        if (TransactionSynchronizationManager.isActualTransactionActive()) {
            TransactionSynchronizationManager.registerSynchronization(new TransactionSynchronization() {
                @Override
                public void afterCommit() {
                    amqpTemplate.convertAndSend(exchange, routingKey, message);
                }
            });
            return;
        }
        amqpTemplate.convertAndSend(exchange, routingKey, message);
    }

}
</code></pre></div><ol start="5"><li>åœ¨å°è¯´ä¿¡æ¯æ›´æ–°åï¼Œå‘é€ AMQP æ¶ˆæ¯ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>@Transactional(rollbackFor = Exception.class)
@Override
public RestResp&lt;Void&gt; saveBookChapter(ChapterAddReqDto dto) {
    // 1) ä¿å­˜ç« èŠ‚ç›¸å…³ä¿¡æ¯åˆ°å°è¯´ç« èŠ‚è¡¨
    //  a) æŸ¥è¯¢æœ€æ–°ç« èŠ‚å·
    int chapterNum = 0;
    QueryWrapper&lt;BookChapter&gt; chapterQueryWrapper = new QueryWrapper&lt;&gt;();
    chapterQueryWrapper.eq(DatabaseConsts.BookChapterTable.COLUMN_BOOK_ID,dto.getBookId())
            .orderByDesc(DatabaseConsts.BookChapterTable.COLUMN_CHAPTER_NUM)
            .last(DatabaseConsts.SqlEnum.LIMIT_1.getSql());
    BookChapter bookChapter = bookChapterMapper.selectOne(chapterQueryWrapper);
    if(Objects.nonNull(bookChapter)){
        chapterNum = bookChapter.getChapterNum() + 1;
    }
    //  b) è®¾ç½®ç« èŠ‚ç›¸å…³ä¿¡æ¯å¹¶ä¿å­˜
    BookChapter newBookChapter = new BookChapter();
    newBookChapter.setBookId(dto.getBookId());
    newBookChapter.setChapterName(dto.getChapterName());
    newBookChapter.setChapterNum(chapterNum);
    newBookChapter.setWordCount(dto.getChapterContent().length());
    newBookChapter.setIsVip(dto.getIsVip());
    newBookChapter.setCreateTime(LocalDateTime.now());
    newBookChapter.setUpdateTime(LocalDateTime.now());
    bookChapterMapper.insert(newBookChapter);

    // 2) ä¿å­˜ç« èŠ‚å†…å®¹åˆ°å°è¯´å†…å®¹è¡¨
    BookContent bookContent = new BookContent();
    bookContent.setContent(dto.getChapterContent());
    bookContent.setChapterId(newBookChapter.getId());
    bookContent.setCreateTime(LocalDateTime.now());
    bookContent.setUpdateTime(LocalDateTime.now());
    bookContentMapper.insert(bookContent);

    // 3) æ›´æ–°å°è¯´è¡¨æœ€æ–°ç« èŠ‚ä¿¡æ¯å’Œå°è¯´æ€»å­—æ•°ä¿¡æ¯
    //  a) æ›´æ–°å°è¯´è¡¨å…³äºæœ€æ–°ç« èŠ‚çš„ä¿¡æ¯
    BookInfoRespDto bookInfo = bookInfoCacheManager.getBookInfo(dto.getBookId());
    BookInfo newBookInfo = new BookInfo();
    newBookInfo.setId(dto.getBookId());
    newBookInfo.setLastChapterId(newBookChapter.getId());
    newBookInfo.setLastChapterName(newBookChapter.getChapterName());
    newBookInfo.setLastChapterUpdateTime(LocalDateTime.now());
    newBookInfo.setWordCount(bookInfo.getWordCount() + newBookChapter.getWordCount());
    newBookChapter.setUpdateTime(LocalDateTime.now());
    bookInfoMapper.updateById(newBookInfo);
    //  b) åˆ·æ–°å°è¯´ä¿¡æ¯ç¼“å­˜
    bookInfoCacheManager.cachePutBookInfo(dto.getBookId());
    //  c) å‘é€å°è¯´ä¿¡æ¯æ›´æ–°çš„ MQ æ¶ˆæ¯
    amqpMsgManager.sendBookChangeMsg(dto.getBookId());
    return RestResp.ok();
}
</code></pre></div><ol start="6"><li>åœ¨<code>io.github.xxyopen.novel.core.listener</code>åŒ…ä¸‹åˆ›å»º Rabbit é˜Ÿåˆ—ç›‘å¬å™¨ï¼Œç›‘å¬å„ä¸ª RabbitMQ é˜Ÿåˆ—çš„æ¶ˆæ¯å¹¶å¤„ç†ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>/**
 * Rabbit é˜Ÿåˆ—ç›‘å¬å™¨
 *
 * @author xiongxiaoyang
 * @date 2022/5/25
 */
@Component
@RequiredArgsConstructor
@Slf4j
public class RabbitQueueListener {

    private final BookInfoMapper bookInfoMapper;

    private final ElasticsearchClient esClient;

    /**
     * ç›‘å¬å°è¯´ä¿¡æ¯æ”¹å˜çš„ ES æ›´æ–°é˜Ÿåˆ—ï¼Œæ›´æ–°æœ€æ–°å°è¯´ä¿¡æ¯åˆ° ES
     * */
    @RabbitListener(queues = AmqpConsts.BookChangeMq.QUEUE_ES_UPDATE)
    @SneakyThrows
    public void updateEsBook(Long bookId) {
        BookInfo bookInfo = bookInfoMapper.selectById(bookId);
        IndexResponse response = esClient.index(i -&gt; i
                .index(EsConsts.BookIndex.INDEX_NAME)
                .id(bookInfo.getId().toString())
                .document(EsBookDto.build(bookInfo))
        );
        log.info(&quot;Indexed with version &quot; + response.version());
    }

    // ... ç›‘å¬å…¶å®ƒé˜Ÿåˆ—ï¼Œåˆ·æ–°å…¶å®ƒå‰¯æœ¬æ•°æ®

}
</code></pre></div><p>æ­¤æ—¶ï¼Œå¦‚æœéœ€è¦æ›´æ–°å…¶å®ƒå‰¯æœ¬æ•°æ®ï¼Œåªéœ€è¦é…ç½®æ›´æ–°é˜Ÿåˆ—å’Œå¢åŠ ç›‘å¬å™¨ï¼Œä¸éœ€è¦ä¿®æ”¹ä»»ä½•ä¸šåŠ¡ä»£ç ï¼Œè€Œä¸”ä»»æ„å‰¯æœ¬çš„æ•°æ®åˆ·æ–°äº’ä¸å½±å“ï¼ŒçœŸæ­£å®ç°äº†æ¨¡å—é—´çš„è§£è€¦ã€‚</p> <p><strong>æ³¨ï¼šå½“æœåŠ¡é›†ç¾¤éƒ¨ç½²æ—¶ï¼Œç”±äºå¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåŒä¸€ä¸ªé˜Ÿåˆ—æ˜¯æ— æ³•åŒæ—¶æ¶ˆè´¹çš„ï¼Œä¸€ä¸ªæ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œæ‰€ä»¥åˆ·æ–°æœ¬åœ°ç¼“å­˜çš„ MQ é˜Ÿåˆ—å‘½ååº”è¯¥ä½¿ç”¨<code>å›ºå®šå + å”¯ä¸€éšæœºå€¼</code>è¿™ç§åŠ¨æ€å½¢å¼ã€‚è¿™æ ·æ¯æ¬¡å¯åŠ¨ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„é˜Ÿåˆ—ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®è¯¥é˜Ÿåˆ—çš„ autoDelete = trueï¼Œè®©æ‰€æœ‰æ¶ˆè´¹å®¢æˆ·ç«¯è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨åˆ é™¤è¯¥é˜Ÿåˆ—ã€‚</strong></p> <h2 id="ä½¿ç”¨-xxl-job-ä¼˜åŒ–-elasticsearch-æ•°æ®åŒæ­¥ä»»åŠ¡"><a href="#ä½¿ç”¨-xxl-job-ä¼˜åŒ–-elasticsearch-æ•°æ®åŒæ­¥ä»»åŠ¡" class="header-anchor">#</a> ä½¿ç”¨ XXL-JOB ä¼˜åŒ– Elasticsearch æ•°æ®åŒæ­¥ä»»åŠ¡</h2> <ol><li><p><a href="/course/novel/4.html#åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°-xxl-job-é›†æˆä¸é…ç½®">XXL-JOB é›†æˆä¸é…ç½®</a></p></li> <li><p>ç™»å½•è°ƒåº¦ä¸­å¿ƒåå°ï¼Œæ–°å¢ novel é¡¹ç›®ä»»åŠ¡æ‰§è¡Œå™¨ï¼š</p></li></ol> <p><img src="/img/novel/xxljobexe.png" alt="åˆ›å»ºä»»åŠ¡æ‰§è¡Œå™¨"></p> <p><strong>æ³¨ï¼šAppName çš„å€¼éœ€è¦å’Œ novel é¡¹ç›® application.yml é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„å€¼ä¿æŒä¸€è‡´ã€‚</strong></p> <ol start="3"><li>æ–°å¢ Elasticsearch æ•°æ®åŒæ­¥ä»»åŠ¡ï¼š</li></ol> <p><img src="/img/novel/xxljobtask.png" alt="åˆ›å»ºä»»åŠ¡"></p> <ol start="4"><li>ä¿®æ”¹<code>io.github.xxyopen.novel.core.task</code>åŒ…ä¸‹çš„ Elasticsearch æ•°æ®åŒæ­¥ä»»åŠ¡ï¼ˆ<code>@Scheduled</code> æ³¨è§£ æ›¿æ¢ä¸º <code>@XxlJob</code>â€‹ æ³¨è§£ï¼‰ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>/**
 * å°è¯´æ•°æ®åŒæ­¥åˆ° Elasticsearch ä»»åŠ¡
 *
 * @author xiongxiaoyang
 * @date 2022/5/23
 */
@ConditionalOnProperty(prefix = &quot;spring.elasticsearch&quot;, name = &quot;enable&quot;, havingValue = &quot;true&quot;)
@Component
@RequiredArgsConstructor
@Slf4j
public class BookToEsTask {

    private final BookInfoMapper bookInfoMapper;

    private final ElasticsearchClient elasticsearchClient;

    @SneakyThrows
    @XxlJob(&quot;saveToEsJobHandler&quot;) // æ­¤å¤„éœ€è¦å’Œè°ƒåº¦ä¸­å¿ƒåˆ›å»ºä»»åŠ¡æ—¶å¡«å†™çš„ JobHandler å€¼ä¿æŒä¸€è‡´
    public ReturnT&lt;String&gt; saveToEs() {
         try {
            QueryWrapper&lt;BookInfo&gt; queryWrapper = new QueryWrapper&lt;&gt;();
            List&lt;BookInfo&gt; bookInfos;
            long maxId = 0;
            for (; ; ) {
                queryWrapper.clear();
                queryWrapper
                        .orderByAsc(DatabaseConsts.CommonColumnEnum.ID.getName())
                        .gt(DatabaseConsts.CommonColumnEnum.ID.getName(), maxId)
                        .last(DatabaseConsts.SqlEnum.LIMIT_30.getSql());
                bookInfos = bookInfoMapper.selectList(queryWrapper);
                if (bookInfos.isEmpty()) {
                    break;
                }
                BulkRequest.Builder br = new BulkRequest.Builder();

                for (BookInfo book : bookInfos) {
                    br.operations(op -&gt; op
                            .index(idx -&gt; idx
                                    .index(EsConsts.BookIndex.INDEX_NAME)
                                    .id(book.getId().toString())
                                    .document(EsBookDto.build(book))
                            )
                    ).timeout(Time.of(t -&gt; t.time(&quot;10s&quot;)));
                    maxId = book.getId();
                }

                BulkResponse result = elasticsearchClient.bulk(br.build());

                // Log errors, if any
                if (result.errors()) {
                    log.error(&quot;Bulk had errors&quot;);
                    for (BulkResponseItem item : result.items()) {
                        if (item.error() != null) {
                            log.error(item.error().reason());
                        }
                    }
                }
            }
            return ReturnT.SUCCESS;
        } catch (Exception e) {
            log.error(e.getMessage(), e);
            return ReturnT.FAIL;
        }
    }

}

</code></pre></div><ol start="5"><li>æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œå™¨ï¼Œå¯ä»¥å‘ç°å·²ç»æœ‰ä¸€å°æœºå™¨è‡ªåŠ¨æ³¨å†Œï¼š</li></ol> <p><img src="/img/novel/xxljobonline.png" alt="åœ¨çº¿æ³¨å†Œæœºå™¨"></p> <ol start="6"><li>è¿›å…¥ä»»åŠ¡ç®¡ç†ï¼Œæˆ‘ä»¬å¯ä»¥å¯åŠ¨ Elasticsearch æ•°æ®åŒæ­¥ä»»åŠ¡ï¼Œç”±é…ç½®çš„ Cron è¡¨è¾¾å¼è¿›è¡Œä»»åŠ¡è°ƒåº¦ï¼›ä¹Ÿå¯ä»¥é€‰æ‹©æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œï¼š</li></ol> <p><img src="/img/novel/xxljobtaskexe.png" alt="ä»»åŠ¡å¯åŠ¨"></p> <p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»æ‰‹åŠ¨åŒæ­¥æ•°æ®åº“çš„å°è¯´æ•°æ®åˆ° Elasticsearch æœç´¢å¼•æ“ä¸­ï¼Œæå¤§çš„æ–¹ä¾¿äº†æˆ‘ä»¬çš„å¼€å‘æµ‹è¯•å·¥ä½œã€‚</p> <h2 id="ä½¿ç”¨-sentinel-å®ç°æ¥å£é˜²åˆ·å’Œé™æµ"><a href="#ä½¿ç”¨-sentinel-å®ç°æ¥å£é˜²åˆ·å’Œé™æµ" class="header-anchor">#</a> ä½¿ç”¨ Sentinel å®ç°æ¥å£é˜²åˆ·å’Œé™æµ</h2> <h3 id="é—®é¢˜-2"><a href="#é—®é¢˜-2" class="header-anchor">#</a> é—®é¢˜</h3> <p>novel ä½œä¸ºä¸€ä¸ªäº’è”ç½‘ç³»ç»Ÿï¼Œç»å¸¸ä¼šé‡åˆ°éæ³•çˆ¬è™«ï¼ˆä¾‹å¦‚ï¼Œç›—ç‰ˆå°è¯´ç½‘ç«™ï¼‰æ¥çˆ¬å–æˆ‘ä»¬ç³»ç»Ÿçš„å°è¯´æ•°æ®ï¼Œè¿™ç§çˆ¬è™«è¡Œä¸ºæœ‰æ—¶ä¼šé«˜è¾¾æ¯ç§’å‡ ç™¾ç”šè‡³ä¸Šåƒæ¬¡è®¿é—®ã€‚é˜²åˆ·çš„ç›®çš„æ˜¯ä¸ºäº†é™åˆ¶è¿™äº›çˆ¬è™«è¯·æ±‚æˆ‘ä»¬æ¥å£çš„é¢‘ç‡ï¼Œå¦‚æœæˆ‘ä»¬ä¸åšæ¥å£é˜²åˆ·é™åˆ¶çš„è¯ï¼Œæˆ‘ä»¬ç³»ç»Ÿå¾ˆå®¹æ˜“å°±ä¼šè¢«çˆ¬è™«å¹²å€’ã€‚</p> <p>é™æµçš„ç›®çš„æ˜¯åœ¨æµé‡é«˜å³°æœŸé—´ï¼Œæ ¹æ®æˆ‘ä»¬ç³»ç»Ÿçš„æ‰¿å—èƒ½åŠ›ï¼Œé™åˆ¶åŒæ—¶è¯·æ±‚çš„æ•°é‡ï¼Œä¿è¯å¤šä½™çš„è¯·æ±‚ä¼šé˜»å¡ä¸€æ®µæ—¶é—´å†å¤„ç†ï¼Œä¸ç®€å•ç²—æš´çš„ç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯è®©å®¢æˆ·ç«¯é‡è¯•ï¼ŒåŒæ—¶åˆèƒ½èµ·åˆ°æµé‡å‰Šå³°çš„ä½œç”¨ã€‚</p> <p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æ˜¯å°½é‡å°†è¯·æ±‚æ‹¦æˆªåœ¨ç³»ç»Ÿä¸Šæ¸¸ï¼Œæ¯”å¦‚åœ¨åå‘ä»£ç†å±‚é€šè¿‡ Nginx + Lua + Redis æ¥å®ç°é™æµåŠŸèƒ½ï¼Œè¿™ä¸ªåœ¨åé¢éƒ¨ç½²ç¯‡ç« é‡Œé¢ä¼šè¯¦ç»†åœ°è®²è§£å¦‚ä½•å®ç°ã€‚å¦‚æœæˆ‘ä»¬ç³»ç»Ÿè¿˜æ²¡æœ‰ä½¿ç”¨ç±»ä¼¼äº Nginx ä¸€æ ·çš„åå‘ä»£ç†ï¼Œåˆæˆ–è€…æˆ‘ä»¬æƒ³å®ç°æ›´å¤æ‚çš„æµé‡æ§åˆ¶ï¼Œæƒ³è¦ä¸€ä¸ªäººæ€§åŒ–çš„æ§åˆ¶é¢æ¿æ¥åŠ¨æ€é™æµå’Œå®æ—¶ç›‘æ§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é˜¿é‡Œå·´å·´å¼€æºçš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ Sentinel æ¥å®ç°ã€‚</p> <h3 id="sentinel-ä»‹ç»"><a href="#sentinel-ä»‹ç»" class="header-anchor">#</a> Sentinel ä»‹ç»</h3> <p>Sentinel æ˜¯ä¸€ä¸ªé¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ï¼Œä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p> <p>Sentinel æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œ<code>èµ„æº</code>å’Œ<code>è§„åˆ™</code>ï¼š</p> <p><strong>èµ„æº</strong>æ˜¯ Sentinel çš„å…³é”®æ¦‚å¿µã€‚å®ƒå¯ä»¥æ˜¯ Java åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•å†…å®¹ï¼Œä¾‹å¦‚ï¼Œç”±åº”ç”¨ç¨‹åºæä¾›çš„æœåŠ¡ï¼Œæˆ–ç”±åº”ç”¨ç¨‹åºè°ƒç”¨çš„å…¶å®ƒåº”ç”¨æä¾›çš„æœåŠ¡ï¼Œç”šè‡³å¯ä»¥æ˜¯ä¸€æ®µä»£ç ã€‚åªè¦é€šè¿‡ Sentinel API å®šä¹‰çš„ä»£ç ï¼Œå°±æ˜¯èµ„æºï¼Œèƒ½å¤Ÿè¢« Sentinel ä¿æŠ¤èµ·æ¥ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³•ç­¾åï¼ŒURLï¼Œç”šè‡³æœåŠ¡åç§°ä½œä¸ºèµ„æºåæ¥æ ‡ç¤ºèµ„æºã€‚</p> <p><strong>è§„åˆ™</strong>æ˜¯å›´ç»•èµ„æºçš„å®æ—¶çŠ¶æ€è®¾å®šçš„è§„åˆ™ï¼Œå¯ä»¥åŒ…æ‹¬æµé‡æ§åˆ¶è§„åˆ™ã€ç†”æ–­é™çº§è§„åˆ™ä»¥åŠç³»ç»Ÿä¿æŠ¤è§„åˆ™ã€‚æ‰€æœ‰è§„åˆ™å¯ä»¥åŠ¨æ€å®æ—¶è°ƒæ•´ã€‚</p> <p>Sentinel å…·æœ‰ä»¥ä¸‹ç‰¹å¾:</p> <ul><li><p>ä¸°å¯Œçš„åº”ç”¨åœºæ™¯ï¼šSentinel æ‰¿æ¥äº†é˜¿é‡Œå·´å·´è¿‘ 10 å¹´çš„åŒåä¸€å¤§ä¿ƒæµé‡çš„æ ¸å¿ƒåœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ï¼ˆå³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´ï¼‰ã€æ¶ˆæ¯å‰Šå³°å¡«è°·ã€é›†ç¾¤æµé‡æ§åˆ¶ã€å®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰ã€‚</p></li> <li><p>å®Œå¤‡çš„å®æ—¶ç›‘æ§ï¼šSentinel åŒæ—¶æä¾›å®æ—¶çš„ç›‘æ§åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°æœºå™¨ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µã€‚</p></li> <li><p>å¹¿æ³›çš„å¼€æºç”Ÿæ€ï¼šSentinel æä¾›å¼€ç®±å³ç”¨çš„ä¸å…¶å®ƒå¼€æºæ¡†æ¶/åº“çš„æ•´åˆæ¨¡å—ï¼Œä¾‹å¦‚ä¸ Spring Cloudã€Apache Dubboã€gRPCã€Quarkus çš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–å¹¶è¿›è¡Œç®€å•çš„é…ç½®å³å¯å¿«é€Ÿåœ°æ¥å…¥ Sentinelã€‚åŒæ—¶ Sentinel æä¾› Java/Go/C++ ç­‰å¤šè¯­è¨€çš„åŸç”Ÿå®ç°ã€‚</p></li> <li><p>å®Œå–„çš„ SPI æ‰©å±•æœºåˆ¶ï¼šSentinel æä¾›ç®€å•æ˜“ç”¨ã€å®Œå–„çš„ SPI æ‰©å±•æ¥å£ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°æ‰©å±•æ¥å£æ¥å¿«é€Ÿåœ°å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ã€é€‚é…åŠ¨æ€æ•°æ®æºç­‰ã€‚</p></li></ul> <p>Sentinel åˆ†ä¸º<code>æ ¸å¿ƒåº“</code>å’Œ<code>æ§åˆ¶å°</code>ä¸¤éƒ¨åˆ†ï¼Œ<code>æ ¸å¿ƒåº“</code>ä¸ä¾èµ–<code>æ§åˆ¶å°</code>ï¼Œä½†æ˜¯ç»“åˆ<code>æ§åˆ¶å°</code>å¯ä»¥å–å¾—æœ€å¥½çš„æ•ˆæœ:</p> <ul><li><p>æ ¸å¿ƒåº“ï¼ˆJava å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶/åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒã€‚</p></li> <li><p>æ§åˆ¶å°ï¼ˆDashboardï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ã€‚</p></li></ul> <h3 id="ä½¿ç”¨-sentinel-æ ¸å¿ƒåº“å®ç°æ¥å£é˜²åˆ·å’Œé™æµ"><a href="#ä½¿ç”¨-sentinel-æ ¸å¿ƒåº“å®ç°æ¥å£é˜²åˆ·å’Œé™æµ" class="header-anchor">#</a> ä½¿ç”¨ Sentinel æ ¸å¿ƒåº“å®ç°æ¥å£é˜²åˆ·å’Œé™æµ</h3> <ol><li>å¼•å…¥ Sentinel ç›¸å…³ä¾èµ–ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt;
    &lt;artifactId&gt;sentinel-core&lt;/artifactId&gt;
    &lt;version&gt;${sentinel.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt;
    &lt;artifactId&gt;sentinel-parameter-flow-control&lt;/artifactId&gt;
    &lt;version&gt;${sentinel.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre></div><ol start="2"><li>åœ¨<code>io.github.xxyopen.novel.core.config.WebConfig</code>ä¸­æ³¨å†Œä¸€ä¸ªå…¨å±€çš„æ‹¦æˆªå™¨æ‹¦æˆªæ‰€æœ‰çš„è¯·æ±‚ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>// æµé‡é™åˆ¶æ‹¦æˆªå™¨
registry.addInterceptor(flowLimitInterceptor)
        .addPathPatterns(&quot;/**&quot;)
        .order(0);
</code></pre></div><ol start="3"><li>æ‹¦æˆªå™¨ä¸­å®šä¹‰èµ„æºå’Œè§„åˆ™ï¼Œèµ„æºåœ¨<code>preHandle</code>æ–¹æ³•ä¸­å®šä¹‰ï¼Œä¸ºæ‰€æœ‰è¯·æ±‚çš„å…¥å£ï¼Œ<code>æ¥å£é™æµè§„åˆ™</code>å’Œ<code>æ¥å£é˜²åˆ·è§„åˆ™</code>é€šè¿‡<code>static ä»£ç å—</code>åœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>/**
 * æµé‡é™åˆ¶ æ‹¦æˆªå™¨
 * å®ç°æ¥å£é˜²åˆ·å’Œé™æµ
 *
 * @author xiongxiaoyang
 * @date 2022/6/1
 */
@Component
@RequiredArgsConstructor
@Slf4j
public class FlowLimitInterceptor implements HandlerInterceptor {

    private final ObjectMapper objectMapper;

    /**
     * novel é¡¹ç›®æ‰€æœ‰çš„èµ„æº
     */
    private static final String NOVEL_RESOURCE = &quot;novelResource&quot;;

    static {
        // æ¥å£é™æµè§„åˆ™ï¼šæ‰€æœ‰çš„è¯·æ±‚ï¼Œé™åˆ¶æ¯ç§’æœ€å¤šåªèƒ½é€šè¿‡ 2000 ä¸ªï¼Œè¶…å‡ºé™åˆ¶åŒ€é€Ÿæ’é˜Ÿ
        List&lt;FlowRule&gt; rules = new ArrayList&lt;&gt;();
        FlowRule rule1 = new FlowRule();
        rule1.setResource(NOVEL_RESOURCE);
        rule1.setGrade(RuleConstant.FLOW_GRADE_QPS);
        // Set limit QPS to 2000.
        rule1.setCount(2000);
        rule1.setControlBehavior(RuleConstant.CONTROL_BEHAVIOR_RATE_LIMITER);
        rules.add(rule1);
        FlowRuleManager.loadRules(rules);

        // æ¥å£é˜²åˆ·è§„åˆ™ 1ï¼šæ‰€æœ‰çš„è¯·æ±‚ï¼Œé™åˆ¶æ¯ä¸ª IP æ¯ç§’æœ€å¤šåªèƒ½é€šè¿‡ 50 ä¸ªï¼Œè¶…å‡ºé™åˆ¶ç›´æ¥æ‹’ç»
        ParamFlowRule rule2 = new ParamFlowRule(NOVEL_RESOURCE)
                .setParamIdx(0)
                .setCount(50);
        // æ¥å£é˜²åˆ·è§„åˆ™ 2ï¼šæ‰€æœ‰çš„è¯·æ±‚ï¼Œé™åˆ¶æ¯ä¸ª IP æ¯åˆ†é’Ÿæœ€å¤šåªèƒ½é€šè¿‡ 1000 ä¸ªï¼Œè¶…å‡ºé™åˆ¶ç›´æ¥æ‹’ç»
        ParamFlowRule rule3 = new ParamFlowRule(NOVEL_RESOURCE)
                .setParamIdx(0)
                .setCount(1000)
                .setDurationInSec(60);
        ParamFlowRuleManager.loadRules(Arrays.asList(rule2, rule3));
    }

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        String ip = IpUtils.getRealIp(request);
        Entry entry = null;
        try {
            // è‹¥éœ€è¦é…ç½®ä¾‹å¤–é¡¹ï¼Œåˆ™ä¼ å…¥çš„å‚æ•°åªæ”¯æŒåŸºæœ¬ç±»å‹ã€‚
            // EntryType ä»£è¡¨æµé‡ç±»å‹ï¼Œå…¶ä¸­ç³»ç»Ÿè§„åˆ™åªå¯¹ IN ç±»å‹çš„åŸ‹ç‚¹ç”Ÿæ•ˆ
            // count å¤§å¤šæ•°æƒ…å†µéƒ½å¡« 1ï¼Œä»£è¡¨ç»Ÿè®¡ä¸ºä¸€æ¬¡è°ƒç”¨ã€‚
            entry = SphU.entry(NOVEL_RESOURCE, EntryType.IN, 1, ip);
            // Your logic here.
            return HandlerInterceptor.super.preHandle(request, response, handler);
        } catch (BlockException ex) {
            // Handle request rejection.
            log.info(&quot;IP:{}è¢«é™æµäº†ï¼&quot;, ip);
            response.setCharacterEncoding(StandardCharsets.UTF_8.name());
            response.setContentType(MediaType.APPLICATION_JSON_VALUE);
            response.getWriter().write(objectMapper.writeValueAsString(RestResp.fail(ErrorCodeEnum.USER_REQ_MANY)));
        } finally {
            // æ³¨æ„ï¼šexit çš„æ—¶å€™ä¹Ÿä¸€å®šè¦å¸¦ä¸Šå¯¹åº”çš„å‚æ•°ï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰ç»Ÿè®¡é”™è¯¯ã€‚
            if (entry != null) {
                entry.exit(1, ip);
            }
        }
        return false;
    }

}
</code></pre></div><p>è§„åˆ™å±æ€§è¯´æ˜ï¼š</p> <table><thead><tr><th>å±æ€§</th> <th>è¯´æ˜</th> <th>é»˜è®¤å€¼</th></tr></thead> <tbody><tr><td>resource</td> <td>èµ„æºåï¼Œå¿…å¡«</td> <td></td></tr> <tr><td>count</td> <td>é™æµé˜ˆå€¼ï¼Œå¿…å¡«</td> <td></td></tr> <tr><td>grade</td> <td>é™æµæ¨¡å¼</td> <td>QPS æ¨¡å¼</td></tr> <tr><td>durationInSec</td> <td>ç»Ÿè®¡çª—å£æ—¶é—´é•¿åº¦ï¼ˆå•ä½ä¸ºç§’ï¼‰ï¼Œ1.6.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ</td> <td>1s</td></tr> <tr><td>controlBehavior</td> <td>æµæ§æ•ˆæœï¼ˆæ”¯æŒå¿«é€Ÿå¤±è´¥å’ŒåŒ€é€Ÿæ’é˜Ÿæ¨¡å¼ï¼‰ï¼Œ1.6.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ</td> <td>å¿«é€Ÿå¤±è´¥</td></tr> <tr><td>maxQueueingTimeMs</td> <td>æœ€å¤§æ’é˜Ÿç­‰å¾…æ—¶é•¿ï¼ˆä»…åœ¨åŒ€é€Ÿæ’é˜Ÿæ¨¡å¼ç”Ÿæ•ˆï¼‰ï¼Œ1.6.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ</td> <td>0ms</td></tr> <tr><td>paramIdx</td> <td>çƒ­ç‚¹å‚æ•°çš„ç´¢å¼•ï¼Œå¿…å¡«ï¼Œå¯¹åº” <code>SphU.entry(xxx, args)</code> ä¸­çš„å‚æ•°ç´¢å¼•ä½ç½®</td> <td></td></tr> <tr><td>paramFlowItemList</td> <td>å‚æ•°ä¾‹å¤–é¡¹ï¼Œå¯ä»¥é’ˆå¯¹æŒ‡å®šçš„å‚æ•°å€¼å•ç‹¬è®¾ç½®é™æµé˜ˆå€¼ï¼Œä¸å—å‰é¢ <code>count</code> é˜ˆå€¼çš„é™åˆ¶ã€‚<strong>ä»…æ”¯æŒåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ç±»å‹</strong></td> <td></td></tr> <tr><td>clusterMode</td> <td>æ˜¯å¦æ˜¯é›†ç¾¤å‚æ•°æµæ§è§„åˆ™</td> <td><code>false</code></td></tr> <tr><td>clusterConfig</td> <td>é›†ç¾¤æµæ§ç›¸å…³é…ç½®</td> <td></td></tr></tbody></table> <p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ Sentinel æä¾›çš„<code>æ³¨è§£æ”¯æŒæ¨¡å—</code>æ¥å®šä¹‰æˆ‘ä»¬çš„èµ„æºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼ŒhelloWorld() æ–¹æ³•æˆäº†æˆ‘ä»¬çš„ä¸€ä¸ªèµ„æºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>@SentinelResource(&quot;HelloWorld&quot;)
public void helloWorld() {
    // èµ„æºä¸­çš„é€»è¾‘
    System.out.println(&quot;hello world&quot;);
}
</code></pre></div><p><strong>æ³¨ï¼šæ³¨è§£æ”¯æŒæ¨¡å—éœ€è¦é…åˆ Spring AOP æˆ–è€… AspectJ ä¸€èµ·ä½¿ç”¨ã€‚</strong></p> <p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†æ¥å£é˜²åˆ·å’Œé™æµçš„åŠŸèƒ½ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å®æ—¶ç›‘æ§å’Œç®¡ç†é™æµè§„åˆ™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŒ‰å¦‚ä¸‹æ­¥éª¤æ¥å…¥ Sentinel å¼€æºæ§åˆ¶å°ï¼š</p> <ul><li><p>ä¸‹è½½æ§åˆ¶å° jar åŒ…å¹¶åœ¨æœ¬åœ°å¯åŠ¨</p></li> <li><p>novel é¡¹ç›®å¼•å…¥ Transport æ¨¡å—æ¥ä¸ Sentinel æ§åˆ¶å°è¿›è¡Œé€šä¿¡</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt;
    &lt;artifactId&gt;sentinel-transport-simple-http&lt;/artifactId&gt;
    &lt;version&gt;1.8.4&lt;/version&gt;
&lt;/dependency&gt;
</code></pre></div><ul><li>novel é¡¹ç›®å¯åŠ¨æ—¶åŠ å…¥ JVM å‚æ•° -Dcsp.sentinel.dashboard.server=consoleIp:port æŒ‡å®šæ§åˆ¶å°åœ°å€å’Œç«¯å£</li> <li>ç¡®ä¿ novel é¡¹ç›®æœ‰è®¿é—®é‡</li></ul> <p>å®Œæˆä»¥ä¸Šæ­¥éª¤åå³å¯åœ¨ Sentinel æ§åˆ¶å°ä¸Šçœ‹åˆ°å¯¹åº”çš„åº”ç”¨ï¼Œæœºå™¨åˆ—è¡¨é¡µé¢å¯ä»¥çœ‹åˆ°å¯¹åº”çš„æœºå™¨ã€‚</p> <h2 id="é›†æˆ-shardingsphere-jdbc-ä¼˜åŒ–å°è¯´å†…å®¹å­˜å‚¨"><a href="#é›†æˆ-shardingsphere-jdbc-ä¼˜åŒ–å°è¯´å†…å®¹å­˜å‚¨" class="header-anchor">#</a> é›†æˆ ShardingSphere-JDBC ä¼˜åŒ–å°è¯´å†…å®¹å­˜å‚¨</h2> <h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="header-anchor">#</a> èƒŒæ™¯</h3> <p>ä¼ ç»Ÿçš„å°†æ•°æ®é›†ä¸­å­˜å‚¨è‡³å•ä¸€èŠ‚ç‚¹çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨æ€§èƒ½ã€å¯ç”¨æ€§å’Œè¿ç»´æˆæœ¬è¿™ä¸‰æ–¹é¢å·²ç»éš¾äºæ»¡è¶³æµ·é‡æ•°æ®çš„åœºæ™¯ã€‚</p> <p>ä»æ€§èƒ½æ–¹é¢æ¥è¯´ï¼Œç”±äºå…³ç³»å‹æ•°æ®åº“å¤§å¤šé‡‡ç”¨ B+ æ ‘ç±»å‹çš„ç´¢å¼•ï¼Œåœ¨æ•°æ®é‡è¶…è¿‡é˜ˆå€¼çš„æƒ…å†µä¸‹ï¼Œç´¢å¼•æ·±åº¦çš„å¢åŠ ä¹Ÿå°†ä½¿å¾—ç£ç›˜è®¿é—®çš„ IO æ¬¡æ•°å¢åŠ ï¼Œè¿›è€Œå¯¼è‡´æŸ¥è¯¢æ€§èƒ½çš„ä¸‹é™ï¼› åŒæ—¶ï¼Œé«˜å¹¶å‘è®¿é—®è¯·æ±‚ä¹Ÿä½¿å¾—é›†ä¸­å¼æ•°æ®åº“æˆä¸ºç³»ç»Ÿçš„æœ€å¤§ç“¶é¢ˆã€‚</p> <p>ä»å¯ç”¨æ€§çš„æ–¹é¢æ¥è®²ï¼ŒæœåŠ¡åŒ–çš„æ— çŠ¶æ€æ€§ï¼Œèƒ½å¤Ÿè¾¾åˆ°è¾ƒå°æˆæœ¬çš„éšæ„æ‰©å®¹ï¼Œè¿™å¿…ç„¶å¯¼è‡´ç³»ç»Ÿçš„æœ€ç»ˆå‹åŠ›éƒ½è½åœ¨æ•°æ®åº“ä¹‹ä¸Šã€‚ è€Œå•ä¸€çš„æ•°æ®èŠ‚ç‚¹ï¼Œæˆ–è€…ç®€å•çš„ä¸»ä»æ¶æ„ï¼Œå·²ç»è¶Šæ¥è¶Šéš¾ä»¥æ‰¿æ‹…ã€‚æ•°æ®åº“çš„å¯ç”¨æ€§ï¼Œå·²æˆä¸ºæ•´ä¸ªç³»ç»Ÿçš„å…³é”®ã€‚</p> <p>ä»è¿ç»´æˆæœ¬æ–¹é¢è€ƒè™‘ï¼Œå½“ä¸€ä¸ªæ•°æ®åº“å®ä¾‹ä¸­çš„æ•°æ®è¾¾åˆ°é˜ˆå€¼ä»¥ä¸Šï¼Œå¯¹äº DBA çš„è¿ç»´å‹åŠ›å°±ä¼šå¢å¤§ã€‚ æ•°æ®å¤‡ä»½å’Œæ¢å¤çš„æ—¶é—´æˆæœ¬éƒ½å°†éšç€æ•°æ®é‡çš„å¤§å°è€Œæ„ˆå‘ä¸å¯æ§ã€‚ä¸€èˆ¬æ¥è®²ï¼Œå•ä¸€æ•°æ®åº“å®ä¾‹çš„æ•°æ®çš„é˜ˆå€¼åœ¨ 1TB ä¹‹å†…ï¼Œæ˜¯æ¯”è¾ƒåˆç†çš„èŒƒå›´ã€‚</p> <p>æ•°æ®åˆ†ç‰‡æŒ‡æŒ‰ç…§æŸä¸ªç»´åº¦å°†å­˜æ”¾åœ¨å•ä¸€æ•°æ®åº“ä¸­çš„æ•°æ®åˆ†æ•£åœ°å­˜æ”¾è‡³å¤šä¸ªæ•°æ®åº“æˆ–è¡¨ä¸­ä»¥è¾¾åˆ°æå‡æ€§èƒ½ç“¶é¢ˆä»¥åŠå¯ç”¨æ€§çš„æ•ˆæœã€‚é€šè¿‡åˆ†åº“å’Œåˆ†è¡¨è¿›è¡Œæ•°æ®çš„æ‹†åˆ†æ¥ä½¿å¾—å„ä¸ªè¡¨çš„æ•°æ®é‡ä¿æŒåœ¨é˜ˆå€¼ä»¥ä¸‹ï¼Œä»¥åŠå¯¹æµé‡è¿›è¡Œç–å¯¼åº”å¯¹é«˜è®¿é—®é‡ï¼Œæ˜¯åº”å¯¹é«˜å¹¶å‘å’Œæµ·é‡æ•°æ®ç³»ç»Ÿçš„æœ‰æ•ˆæ‰‹æ®µã€‚åˆ†åº“å’Œåˆ†è¡¨å‡å¯ä»¥æœ‰æ•ˆçš„é¿å…ç”±æ•°æ®é‡è¶…è¿‡å¯æ‰¿å—é˜ˆå€¼è€Œäº§ç”Ÿçš„æŸ¥è¯¢ç“¶é¢ˆã€‚</p> <p>å°è¯´æ•°æ®æœ‰ç€å†…å®¹å¤šã€å¢é•¿é€Ÿåº¦å¿«çš„ç‰¹ç‚¹ï¼Œä¸€æœ¬ä¸»æµçš„å®Œç»“å°è¯´ä¸€èˆ¬æ‰€éœ€å­˜å‚¨ç©ºé—´å¤§æ¦‚åœ¨ 5MB ä»¥ä¸Šã€‚ä¸€ä¸ªä¸»æµçš„å°è¯´ç½‘ç«™åœ¨å‘å±•ä¸­åæœŸï¼Œæ•°æ®é‡æ˜¯è¿œè¿œè¶…è¿‡å•ä¸€æ•°æ®åº“å®ä¾‹çš„é˜ˆå€¼çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹å°è¯´å†…å®¹è¿›è¡Œåˆ†åº“åˆ†è¡¨å­˜å‚¨æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚åœ¨å‘å±•åˆæœŸï¼Œæˆ‘ä»¬çš„æ•°æ®é‡è¿˜ä¸æ˜¯å¾ˆå¤§ï¼Œå¯ä»¥å…ˆå°†å°è¯´å†…å®¹åˆ†è¡¨å­˜å‚¨ä»¥å‡è½»æ•°æ®åº“å•è¡¨å‹åŠ›ä»¥åŠä¸ºåæœŸçš„æ•°æ®åº“åˆ†åº“åšå‡†å¤‡ã€‚ç­‰æ•°æ®é‡å³å°†è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå†è¿ç§»åˆ°ä¸åŒçš„æ•°æ®åº“å®ä¾‹ä¸Šã€‚</p> <p><strong>æ³¨ï¼šæ•°æ®åˆ†ç‰‡åˆ†ä¸ºæŒ‰ç…§ä¸šåŠ¡å°†è¡¨è¿›è¡Œå½’ç±»ï¼Œåˆ†å¸ƒåˆ°ä¸åŒçš„æ•°æ®åº“ä¸­çš„å‚ç›´åˆ†ç‰‡å’Œé€šè¿‡æŸä¸ªå­—æ®µï¼ˆæˆ–æŸå‡ ä¸ªå­—æ®µï¼‰æŒ‰ç…§æŸç§è§„åˆ™å°†æ•°æ®åˆ†æ•£è‡³å¤šä¸ªåº“æˆ–è¡¨ä¸­çš„æ°´å¹³åˆ†ç‰‡ã€‚</strong></p> <h3 id="apache-shardingsphere-ä»‹ç»"><a href="#apache-shardingsphere-ä»‹ç»" class="header-anchor">#</a> Apache ShardingSphere ä»‹ç»</h3> <p>Apache ShardingSphere äº§å“å®šä½ä¸º Database Plusï¼Œå®ƒå…³æ³¨å¦‚ä½•å……åˆ†åˆç†åœ°åˆ©ç”¨æ•°æ®åº“çš„è®¡ç®—å’Œå­˜å‚¨èƒ½åŠ›ï¼Œè€Œå¹¶éå®ç°ä¸€ä¸ªå…¨æ–°çš„æ•°æ®åº“ã€‚ShardingSphere ç«™åœ¨æ•°æ®åº“çš„ä¸Šå±‚è§†è§’ï¼Œå…³æ³¨ä»–ä»¬ä¹‹é—´çš„åä½œå¤šäºæ•°æ®åº“è‡ªèº«ï¼Œç”± JDBCã€Proxy å’Œ Sidecarï¼ˆè§„åˆ’ä¸­ï¼‰è¿™ 3 æ¬¾æ—¢èƒ½å¤Ÿç‹¬ç«‹éƒ¨ç½²ï¼Œåˆæ”¯æŒæ··åˆéƒ¨ç½²é…åˆä½¿ç”¨çš„äº§å“ç»„æˆã€‚ å®ƒä»¬å‡æä¾›æ ‡å‡†åŒ–çš„åŸºäºæ•°æ®åº“ä½œä¸ºå­˜å‚¨èŠ‚ç‚¹çš„å¢é‡åŠŸèƒ½ï¼Œå¯é€‚ç”¨äºå¦‚ Java åŒæ„ã€å¼‚æ„è¯­è¨€ã€äº‘åŸç”Ÿç­‰å„ç§å¤šæ ·åŒ–çš„åº”ç”¨åœºæ™¯ã€‚</p> <p>ShardingSphere-JDBC å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œåœ¨ Java çš„ JDBC å±‚æä¾›é¢å¤–æœåŠ¡ã€‚ å®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œä»¥ jar åŒ…å½¢å¼æä¾›æœåŠ¡ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ JDBC é©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ JDBC å’Œå„ç§ ORM æ¡†æ¶ã€‚</p> <p>ShardingSphere-Proxy å®šä½ä¸ºé€æ˜åŒ–çš„æ•°æ®åº“ä»£ç†ç«¯ï¼Œæä¾›å°è£…äº†æ•°æ®åº“äºŒè¿›åˆ¶åè®®çš„æœåŠ¡ç«¯ç‰ˆæœ¬ï¼Œç”¨äºå®Œæˆå¯¹å¼‚æ„è¯­è¨€çš„æ”¯æŒã€‚</p> <p>ShardingSphere-Sidecar å®šä½ä¸º Kubernetes çš„äº‘åŸç”Ÿæ•°æ®åº“ä»£ç†ï¼Œä»¥ Sidecar çš„å½¢å¼ä»£ç†æ‰€æœ‰å¯¹æ•°æ®åº“çš„è®¿é—®ã€‚ é€šè¿‡æ— ä¸­å¿ƒã€é›¶ä¾µå…¥çš„æ–¹æ¡ˆæä¾›ä¸æ•°æ®åº“äº¤äº’çš„å•®åˆå±‚ï¼Œå³ Database Meshï¼Œåˆå¯ç§°æ•°æ®åº“ç½‘æ ¼ã€‚</p> <p>è¿æ¥ã€å¢é‡ å’Œ å¯æ’æ‹” æ˜¯ Apache ShardingSphere çš„æ ¸å¿ƒæ¦‚å¿µï¼š</p> <ul><li><p>è¿æ¥ï¼šé€šè¿‡å¯¹æ•°æ®åº“åè®®ã€SQL æ–¹è¨€ä»¥åŠæ•°æ®åº“å­˜å‚¨çš„çµæ´»é€‚é…ï¼Œå¿«é€Ÿçš„è¿æ¥åº”ç”¨ä¸å¤šæ¨¡å¼çš„å¼‚æ„æ•°æ®åº“ï¼›</p></li> <li><p>å¢é‡ï¼šè·å–æ•°æ®åº“çš„è®¿é—®æµé‡ï¼Œå¹¶æä¾›æµé‡é‡å®šå‘ï¼ˆæ•°æ®åˆ†ç‰‡ã€è¯»å†™åˆ†ç¦»ã€å½±å­åº“ï¼‰ã€æµé‡å˜å½¢ï¼ˆæ•°æ®åŠ å¯†ã€æ•°æ®è„±æ•ï¼‰ã€æµé‡é‰´æƒï¼ˆå®‰å…¨ã€å®¡è®¡ã€æƒé™ï¼‰ã€æµé‡æ²»ç†ï¼ˆç†”æ–­ã€é™æµï¼‰ä»¥åŠæµé‡åˆ†æï¼ˆæœåŠ¡è´¨é‡åˆ†æã€å¯è§‚å¯Ÿæ€§ï¼‰ç­‰é€æ˜åŒ–å¢é‡åŠŸèƒ½ï¼›</p></li> <li><p>å¯æ’æ‹”ï¼šé¡¹ç›®é‡‡ç”¨å¾®å†…æ ¸ + ä¸‰å±‚å¯æ’æ‹”æ¨¡å‹ï¼Œä½¿å†…æ ¸ã€åŠŸèƒ½ç»„ä»¶ä»¥åŠç”Ÿæ€å¯¹æ¥å®Œå…¨èƒ½å¤Ÿçµæ´»çš„æ–¹å¼è¿›è¡Œæ’æ‹”å¼æ‰©å±•ï¼Œå¼€å‘è€…èƒ½å¤Ÿåƒä½¿ç”¨ç§¯æœ¨ä¸€æ ·å®šåˆ¶å±äºè‡ªå·±çš„ç‹¬ç‰¹ç³»ç»Ÿã€‚</p></li></ul> <p>Apache ShardingSphere çš„æ•°æ®åˆ†ç‰‡æ¨¡å—é€æ˜åŒ–äº†åˆ†åº“åˆ†è¡¨æ‰€å¸¦æ¥çš„å½±å“ï¼Œè®©ä½¿ç”¨æ–¹å°½é‡åƒä½¿ç”¨ä¸€ä¸ªæ•°æ®åº“ä¸€æ ·ä½¿ç”¨æ°´å¹³åˆ†ç‰‡ä¹‹åçš„æ•°æ®åº“é›†ç¾¤ã€‚</p> <h3 id="é›†æˆæ­¥éª¤"><a href="#é›†æˆæ­¥éª¤" class="header-anchor">#</a> é›†æˆæ­¥éª¤</h3> <ol><li>MySQL æ‰§è¡Œä»¥ä¸‹çš„æ•°æ®è¿ç§»è„šæœ¬ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>DROP PROCEDURE
IF
	EXISTS createBookChapterTable;
-- åˆ›å»ºå°è¯´ç« èŠ‚è¡¨çš„å­˜å‚¨è¿‡ç¨‹
CREATE PROCEDURE createBookChapterTable ( ) BEGIN
	-- å®šä¹‰å˜é‡
	DECLARE
		i INT DEFAULT 0;
	DECLARE
		tableName CHAR ( 13 ) DEFAULT NULL;
	WHILE
			i &lt; 10 DO
			
			SET tableName = concat( 'book_chapter', i );
		
			SET @stmt = concat( 'create table ', tableName, '(
				`id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
				`book_id` bigint(20) unsigned NOT NULL COMMENT \'å°è¯´ID\',
				`chapter_num` smallint(5) unsigned NOT NULL COMMENT \'ç« èŠ‚å·\',
				`chapter_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT \'ç« èŠ‚å\',
				`word_count` int(10) unsigned NOT NULL COMMENT \'ç« èŠ‚å­—æ•°\',
				`is_vip` tinyint(3) unsigned NOT NULL DEFAULT \'0\' COMMENT \'æ˜¯å¦æ”¶è´¹;1-æ”¶è´¹ 0-å…è´¹\',
				`create_time` datetime DEFAULT NULL,
				`update_time` datetime DEFAULT NULL,
				PRIMARY KEY (`id`) USING BTREE,
				UNIQUE KEY `uk_bookId_chapterNum` (`book_id`,`chapter_num`) USING BTREE,
				UNIQUE KEY `pk_id` (`id`) USING BTREE,
				KEY `idx_bookId` (`book_id`) USING BTREE
			) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT=\'å°è¯´ç« èŠ‚\'' );
			PREPARE stmt 
			FROM
				@stmt;
			EXECUTE stmt;
			DEALLOCATE PREPARE stmt;
			
			SET i = i + 1;
		
	END WHILE;
END;
CALL createBookChapterTable ( );

DROP PROCEDURE
IF
	EXISTS createBookContentTable;
-- åˆ›å»ºå°è¯´å†…å®¹è¡¨çš„å­˜å‚¨è¿‡ç¨‹
CREATE PROCEDURE createBookContentTable ( ) BEGIN
	-- å®šä¹‰å˜é‡
	DECLARE
		i INT DEFAULT 0;
	DECLARE
		tableName CHAR ( 13 ) DEFAULT NULL;
	WHILE
			i &lt; 10 DO
			
			SET tableName = concat( 'book_content', i );
		
			SET @stmt = concat( 'create table ', tableName, '(
				`id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT \'ä¸»é”®\',
				`chapter_id` bigint(20) unsigned NOT NULL COMMENT \'ç« èŠ‚ID\',
				`content` mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT \'å°è¯´ç« èŠ‚å†…å®¹\',
				`create_time` datetime DEFAULT NULL,
				`update_time` datetime DEFAULT NULL,
				PRIMARY KEY (`id`) USING BTREE,
				UNIQUE KEY `uk_chapterId` (`chapter_id`) USING BTREE,
				UNIQUE KEY `pk_id` (`id`) USING BTREE
			) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT=\'å°è¯´å†…å®¹\'' );
			PREPARE stmt 
			FROM
				@stmt;
			EXECUTE stmt;
			DEALLOCATE PREPARE stmt;
			
			SET i = i + 1;
		
	END WHILE;
END;
CALL createBookContentTable ( );

DROP PROCEDURE
IF
	EXISTS copyBookChapterData;
-- è¿ç§»å°è¯´ç« èŠ‚æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹
CREATE PROCEDURE copyBookChapterData ( ) BEGIN
	-- å®šä¹‰å˜é‡
	DECLARE
		s INT DEFAULT 0;
	DECLARE
		chapterId BIGINT;
	DECLARE
		bookId BIGINT;
	DECLARE
		chapterNum SMALLINT;
	DECLARE
		chapterName VARCHAR ( 100 );
	DECLARE
		wordCount INT DEFAULT 0;
	DECLARE
		isVip TINYINT ( 64 ) DEFAULT 0;
	DECLARE
		createTime datetime DEFAULT NULL;
	DECLARE
		updateTime datetime DEFAULT NULL;
	DECLARE
		tableNumber INT DEFAULT 0;
	DECLARE
		tableName CHAR ( 13 ) DEFAULT NULL;
	-- å®šä¹‰æ¸¸æ ‡
	DECLARE
		report CURSOR FOR SELECT
		id,
		book_id,
		chapter_num,
		chapter_name,
		word_count,
		is_vip,
		create_time,
		update_time 
	FROM
		book_chapter;
	-- å£°æ˜å½“æ¸¸æ ‡éå†å®Œåå°†æ ‡å¿—å˜é‡ç½®æˆæŸä¸ªå€¼
	DECLARE
		CONTINUE HANDLER FOR NOT FOUND 
		SET s = 1;
	-- æ‰“å¼€æ¸¸æ ‡
	OPEN report;
	-- å°†æ¸¸æ ‡ä¸­çš„å€¼èµ‹å€¼ç»™å˜é‡ï¼Œæ³¨æ„ï¼šå˜é‡åä¸è¦å’Œè¿”å›çš„åˆ—ååŒåï¼Œå˜é‡é¡ºåºè¦å’Œsqlç»“æœåˆ—çš„é¡ºåºä¸€è‡´
	FETCH report INTO chapterId,
	bookId,
	chapterNum,
	chapterName,
	wordCount,
	isVip,
	createTime,
	updateTime;
	-- å¾ªç¯éå†
	WHILE
			s &lt;&gt; 1 DO
			-- æ‰§è¡Œä¸šåŠ¡é€»è¾‘
			
			SET tableNumber = bookId % 10;
		
			SET tableName = concat( 'book_chapter', tableNumber );
			
			SET @stmt = concat(
				'insert into ',
				tableName,
				'(`id`, `book_id`, `chapter_num`, `chapter_name`, `word_count`, `is_vip`, `create_time`, `update_time`) VALUES (',
				chapterId,
				', ',
				bookId,
				', ',
				chapterNum,
				', \'',
				chapterName,
				'\', ',
				wordCount,
				', ',
				isVip,
				', \'',
				createTime,
				'\', \'',
				updateTime,
				'\')' 
			);
			PREPARE stmt 
			FROM
				@stmt;
			EXECUTE stmt;
			DEALLOCATE PREPARE stmt;
			FETCH report INTO chapterId,
			bookId,
			chapterNum,
			chapterName,
			wordCount,
			isVip,
			createTime,
			updateTime;
		
	END WHILE;
	-- å…³é—­æ¸¸æ ‡
	CLOSE report;
END;
CALL copyBookChapterData ( );

DROP PROCEDURE
IF
	EXISTS copyBookContentData;
-- è¿ç§»å°è¯´å†…å®¹æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹
CREATE PROCEDURE copyBookContentData ( ) BEGIN
	-- å®šä¹‰å˜é‡
	DECLARE
		s INT DEFAULT 0;
	DECLARE
		contentId BIGINT;
	DECLARE
		chapterId BIGINT;
	DECLARE
		bookContent MEDIUMTEXT;
	DECLARE
		createTime datetime DEFAULT NULL;
	DECLARE
		updateTime datetime DEFAULT NULL;
	DECLARE
		tableNumber INT DEFAULT 0;
	DECLARE
		tableName CHAR ( 13 ) DEFAULT NULL;
	-- å®šä¹‰æ¸¸æ ‡
	DECLARE
		report CURSOR FOR SELECT
		id,
		chapter_id,
		content,
		create_time,
		update_time 
	FROM
		book_content;
	-- å£°æ˜å½“æ¸¸æ ‡éå†å®Œåå°†æ ‡å¿—å˜é‡ç½®æˆæŸä¸ªå€¼
	DECLARE
		CONTINUE HANDLER FOR NOT FOUND 
		SET s = 1;
	-- æ‰“å¼€æ¸¸æ ‡
	OPEN report;
	-- å°†æ¸¸æ ‡ä¸­çš„å€¼èµ‹å€¼ç»™å˜é‡ï¼Œæ³¨æ„ï¼šå˜é‡åä¸è¦å’Œè¿”å›çš„åˆ—ååŒåï¼Œå˜é‡é¡ºåºè¦å’Œsqlç»“æœåˆ—çš„é¡ºåºä¸€è‡´
	FETCH report INTO contentId,
	chapterId,
	bookContent,
	createTime,
	updateTime;
	-- å¾ªç¯éå†
	WHILE
			s &lt;&gt; 1 DO
			-- æ‰§è¡Œä¸šåŠ¡é€»è¾‘
			
			SET tableNumber = chapterId % 10;
		
			SET tableName = concat( 'book_content', tableNumber );
			
			SET bookContent = REPLACE ( bookContent, '\'', &quot;\\'&quot; );
			
			SET @stmt = concat(
				'insert into ',
				tableName,
				'(`id`, `chapter_id`, `content`) VALUES (',
				contentId,
				', ',
				chapterId,
				',\'',
				bookContent,
				'\')' 
			);
			PREPARE stmt 
			FROM
				@stmt;
			EXECUTE stmt;
			DEALLOCATE PREPARE stmt;
			FETCH report INTO contentId,
			chapterId,
			bookContent,
			createTime,
			updateTime;
		
	END WHILE;
	-- å…³é—­æ¸¸æ ‡
	CLOSE report;
END;
CALL copyBookContentData ( );
</code></pre></div><ol start="2"><li>å¼•å…¥ ShardingSphere-JDBC å®˜æ–¹æä¾›çš„ Spring Boot Starter ä¾èµ–ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt;
    &lt;artifactId&gt;shardingsphere-jdbc-core-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;5.1.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre></div><ol start="3"><li>application.yml ä¸­æ·»åŠ  ShardingSphere-JDBC çš„é…ç½®ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>spring:
  shardingsphere:
    # æ˜¯å¦å¼€å¯ shardingsphere
    enabled: false
    props:
      # æ˜¯å¦åœ¨æ—¥å¿—ä¸­æ‰“å° SQL
      sql-show: true
    # æ¨¡å¼é…ç½®
    mode:
      # å•æœºæ¨¡å¼
      type: Standalone
      repository:
        # æ–‡ä»¶æŒä¹…åŒ–
        type: File
        props:
          # å…ƒæ•°æ®å­˜å‚¨è·¯å¾„
          path: .shardingsphere
      # ä½¿ç”¨æœ¬åœ°é…ç½®è¦†ç›–æŒä¹…åŒ–é…ç½®
      overwrite: true
    # æ•°æ®æºé…ç½®
    datasource:
      names: ds_0
      ds_0:
        type: com.zaxxer.hikari.HikariDataSource
        driverClassName: com.mysql.cj.jdbc.Driver
        jdbcUrl: jdbc:mysql://localhost:3306/novel_test?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai
        username: root
        password: test123456
    # è§„åˆ™é…ç½®
    rules:
      # æ•°æ®åˆ†ç‰‡
      sharding:
        tables:
          # book_content è¡¨
          book_content:
            # æ•°æ®èŠ‚ç‚¹
            actual-data-nodes: ds_$-&gt;{0}.book_content$-&gt;{0..9}
            # åˆ†è¡¨ç­–ç•¥
            table-strategy:
              standard:
                # åˆ†ç‰‡åˆ—åç§°
                sharding-column: chapter_id
                # åˆ†ç‰‡ç®—æ³•åç§°
                sharding-algorithm-name: bookContentSharding
        sharding-algorithms:
          bookContentSharding:
            # è¡Œè¡¨è¾¾å¼åˆ†ç‰‡ç®—æ³•ï¼Œä½¿ç”¨ Groovy çš„è¡¨è¾¾å¼ï¼Œæä¾›å¯¹ SQL è¯­å¥ä¸­çš„ = å’Œ IN çš„åˆ†ç‰‡æ“ä½œæ”¯æŒ
            type: INLINE
            props:
              # åˆ†ç‰‡ç®—æ³•çš„è¡Œè¡¨è¾¾å¼
              algorithm-expression: book_content$-&gt;{chapter_id % 10}
</code></pre></div><p>é…ç½®æ˜¯ ShardingSphere-JDBC ä¸­å”¯ä¸€ä¸åº”ç”¨å¼€å‘è€…äº¤äº’çš„æ¨¡å—ï¼Œé€šè¿‡å®ƒå¯ä»¥å¿«é€Ÿæ¸…æ™°çš„ç†è§£ ShardingSphere-JDBC æ‰€æä¾›çš„åŠŸèƒ½ã€‚</p> <ul><li><p>æ¨¡å¼é…ç½®ï¼š Apache ShardingSphere æä¾›çš„ 3 ç§è¿è¡Œæ¨¡å¼åˆ†åˆ«æ˜¯é€‚ç”¨äºé›†æˆæµ‹è¯•çš„ç¯å¢ƒå¯åŠ¨ï¼Œæ–¹ä¾¿å¼€å‘äººå‘˜åœ¨æ•´åˆåŠŸèƒ½æµ‹è¯•ä¸­é›†æˆ Apache ShardingSphere è€Œæ— éœ€æ¸…ç†è¿è¡Œç—•è¿¹<code>å†…å­˜æ¨¡å¼</code>ã€èƒ½å¤Ÿå°†æ•°æ®æºå’Œè§„åˆ™ç­‰å…ƒæ•°æ®ä¿¡æ¯æŒä¹…åŒ–ï¼Œä½†æ— æ³•å°†å…ƒæ•°æ®åŒæ­¥è‡³å¤šä¸ª Apache ShardingSphere å®ä¾‹ï¼Œæ— æ³•åœ¨é›†ç¾¤ç¯å¢ƒä¸­ç›¸äº’æ„ŸçŸ¥çš„<code>å•æœºæ¨¡å¼</code>å’Œæä¾›äº†å¤šä¸ª Apache ShardingSphere å®ä¾‹ä¹‹é—´çš„å…ƒæ•°æ®å…±äº«å’Œåˆ†å¸ƒå¼åœºæ™¯ä¸‹çŠ¶æ€åè°ƒèƒ½åŠ›çš„<code>é›†ç¾¤æ¨¡å¼</code>ã€‚</p></li> <li><p>æ•°æ®æºé…ç½®ï¼šåŒ…æ‹¬ä½¿ç”¨æœ¬åœ°æ•°æ®æºé…ç½®ï¼ˆæœ¬é¡¹ç›®ä¸­ï¼‰å’Œä½¿ç”¨ JNDI æ•°æ®æºçš„é…ç½®ã€‚å¦‚æœè®¡åˆ’ä½¿ç”¨ JNDI é…ç½®æ•°æ®åº“ï¼Œåœ¨åº”ç”¨å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰ä¸­ä½¿ç”¨ ShardingSphere-JDBC æ—¶ï¼Œ å¯ä½¿ç”¨ spring.shardingsphere.datasource.${datasourceName}.jndiName æ¥ä»£æ›¿æ•°æ®æºçš„ä¸€ç³»åˆ—é…ç½®ã€‚</p></li> <li><p>è§„åˆ™é…ç½®ï¼šè§„åˆ™æ˜¯ Apache ShardingSphere é¢å‘å¯æ’æ‹”çš„ä¸€éƒ¨åˆ†ï¼ŒåŒ…æ‹¬æ•°æ®åˆ†ç‰‡ã€è¯»å†™åˆ†ç¦»ã€é«˜å¯ç”¨ã€æ•°æ®åŠ å¯†ã€å½±å­åº“ã€SQL è§£æã€æ··åˆè§„åˆ™ç­‰ã€‚</p></li></ul> <p>ä»¥ä¸‹æ˜¯æ•°æ®åˆ†ç‰‡çš„é…ç½®é¡¹è¯´æ˜ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code># æ ‡å‡†åˆ†ç‰‡è¡¨é…ç½®
spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.actual-data-nodes= # ç”±æ•°æ®æºå + è¡¨åç»„æˆï¼Œä»¥å°æ•°ç‚¹åˆ†éš”ã€‚å¤šä¸ªè¡¨ä»¥é€—å·åˆ†éš”ï¼Œæ”¯æŒ inline è¡¨è¾¾å¼ã€‚ç¼ºçœè¡¨ç¤ºä½¿ç”¨å·²çŸ¥æ•°æ®æºä¸é€»è¾‘è¡¨åç§°ç”Ÿæˆæ•°æ®èŠ‚ç‚¹ï¼Œç”¨äºå¹¿æ’­è¡¨ï¼ˆå³æ¯ä¸ªåº“ä¸­éƒ½éœ€è¦ä¸€ä¸ªåŒæ ·çš„è¡¨ç”¨äºå…³è”æŸ¥è¯¢ï¼Œå¤šä¸ºå­—å…¸è¡¨ï¼‰æˆ–åªåˆ†åº“ä¸åˆ†è¡¨ä¸”æ‰€æœ‰åº“çš„è¡¨ç»“æ„å®Œå…¨ä¸€è‡´çš„æƒ…å†µ

# åˆ†åº“ç­–ç•¥ï¼Œç¼ºçœè¡¨ç¤ºä½¿ç”¨é»˜è®¤åˆ†åº“ç­–ç•¥ï¼Œä»¥ä¸‹çš„åˆ†ç‰‡ç­–ç•¥åªèƒ½é€‰å…¶ä¸€

# ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯
spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.database-strategy.standard.sharding-column= # åˆ†ç‰‡åˆ—åç§°
spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.database-strategy.standard.sharding-algorithm-name= # åˆ†ç‰‡ç®—æ³•åç§°

# ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤åˆåˆ†ç‰‡åœºæ™¯
spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.database-strategy.complex.sharding-columns= # åˆ†ç‰‡åˆ—åç§°ï¼Œå¤šä¸ªåˆ—ä»¥é€—å·åˆ†éš”
spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.database-strategy.complex.sharding-algorithm-name= # åˆ†ç‰‡ç®—æ³•åç§°

# ç”¨äº Hint çš„åˆ†ç‰‡ç­–ç•¥
spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.database-strategy.hint.sharding-algorithm-name= # åˆ†ç‰‡ç®—æ³•åç§°

# åˆ†è¡¨ç­–ç•¥ï¼ŒåŒåˆ†åº“ç­–ç•¥
spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.table-strategy.xxx= # çœç•¥

# è‡ªåŠ¨åˆ†ç‰‡è¡¨é…ç½®
spring.shardingsphere.rules.sharding.auto-tables.&lt;auto-table-name&gt;.actual-data-sources= # æ•°æ®æºå

spring.shardingsphere.rules.sharding.auto-tables.&lt;auto-table-name&gt;.sharding-strategy.standard.sharding-column= # åˆ†ç‰‡åˆ—åç§°
spring.shardingsphere.rules.sharding.auto-tables.&lt;auto-table-name&gt;.sharding-strategy.standard.sharding-algorithm-name= # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°

# åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥é…ç½®
spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.key-generate-strategy.column= # åˆ†å¸ƒå¼åºåˆ—åˆ—åç§°
spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.key-generate-strategy.key-generator-name= # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°

spring.shardingsphere.rules.sharding.binding-tables[0]= # ç»‘å®šè¡¨è§„åˆ™åˆ—è¡¨
spring.shardingsphere.rules.sharding.binding-tables[1]= # ç»‘å®šè¡¨è§„åˆ™åˆ—è¡¨
spring.shardingsphere.rules.sharding.binding-tables[x]= # ç»‘å®šè¡¨è§„åˆ™åˆ—è¡¨

spring.shardingsphere.rules.sharding.broadcast-tables[0]= # å¹¿æ’­è¡¨è§„åˆ™åˆ—è¡¨
spring.shardingsphere.rules.sharding.broadcast-tables[1]= # å¹¿æ’­è¡¨è§„åˆ™åˆ—è¡¨
spring.shardingsphere.rules.sharding.broadcast-tables[x]= # å¹¿æ’­è¡¨è§„åˆ™åˆ—è¡¨

spring.shardingsphere.sharding.default-database-strategy.xxx= # é»˜è®¤æ•°æ®åº“åˆ†ç‰‡ç­–ç•¥
spring.shardingsphere.sharding.default-table-strategy.xxx= # é»˜è®¤è¡¨åˆ†ç‰‡ç­–ç•¥
spring.shardingsphere.sharding.default-key-generate-strategy.xxx= # é»˜è®¤åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥
spring.shardingsphere.sharding.default-sharding-column= # é»˜è®¤åˆ†ç‰‡åˆ—åç§°

# åˆ†ç‰‡ç®—æ³•é…ç½®
spring.shardingsphere.rules.sharding.sharding-algorithms.&lt;sharding-algorithm-name&gt;.type= # åˆ†ç‰‡ç®—æ³•ç±»å‹
spring.shardingsphere.rules.sharding.sharding-algorithms.&lt;sharding-algorithm-name&gt;.props.xxx= # åˆ†ç‰‡ç®—æ³•å±æ€§é…ç½®

# åˆ†å¸ƒå¼åºåˆ—ç®—æ³•é…ç½®
spring.shardingsphere.rules.sharding.key-generators.&lt;key-generate-algorithm-name&gt;.type= # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•ç±»å‹
spring.shardingsphere.rules.sharding.key-generators.&lt;key-generate-algorithm-name&gt;.props.xxx= # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•å±æ€§é…ç½®
</code></pre></div><p>å…¶ä¸­ï¼Œåˆ†ç‰‡ç®—æ³•åˆ†ä¸ºåŒ…å«å–æ¨¡åˆ†ç‰‡ã€å“ˆå¸Œå–æ¨¡åˆ†ç‰‡ã€åŸºäºåˆ†ç‰‡å®¹é‡çš„èŒƒå›´åˆ†ç‰‡ã€åŸºäºåˆ†ç‰‡è¾¹ç•Œçš„èŒƒå›´åˆ†ç‰‡ã€è‡ªåŠ¨æ—¶é—´æ®µåˆ†ç‰‡åœ¨å†…çš„<code>è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•</code>å’ŒåŒ…å«è¡Œè¡¨è¾¾å¼åˆ†ç‰‡ã€æ—¶é—´èŒƒå›´åˆ†ç‰‡åœ¨å†…çš„<code>æ ‡å‡†åˆ†ç‰‡ç®—æ³•</code>ä»¥åŠ<code>å¤åˆåˆ†ç‰‡ç®—æ³•</code>å’Œ<code>Hint åˆ†ç‰‡ç®—æ³•</code>ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ç±»åˆ†ç‰‡ç®—æ³•ï¼Œé€šè¿‡é…ç½®åˆ†ç‰‡ç­–ç•¥ç±»å‹å’Œç®—æ³•ç±»åï¼Œå®ç°è‡ªå®šä¹‰æ‰©å±•ã€‚</p> <p>åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åŒ…æ‹¬é›ªèŠ±ç®—æ³•å’Œ UUIDã€‚</p> <h2 id="é›†æˆ-spring-boot-admin-å®ç°åº”ç”¨ç®¡ç†å’Œç›‘æ§åŠŸèƒ½"><a href="#é›†æˆ-spring-boot-admin-å®ç°åº”ç”¨ç®¡ç†å’Œç›‘æ§åŠŸèƒ½" class="header-anchor">#</a> é›†æˆ Spring Boot Admin å®ç°åº”ç”¨ç®¡ç†å’Œç›‘æ§åŠŸèƒ½</h2> <h3 id="spring-boot-actuator-ä»‹ç»"><a href="#spring-boot-actuator-ä»‹ç»" class="header-anchor">#</a> Spring Boot Actuator ä»‹ç»</h3> <p>å½“æˆ‘ä»¬å°†åº”ç”¨ç¨‹åºæŠ•å…¥ç”Ÿäº§æ—¶ï¼ŒSpring Boot åŒ…å«äº†è®¸å¤šå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯¹å…¶è¿›è¡Œç›‘æ§å’Œç®¡ç†çš„<code>ç”Ÿäº§å°±ç»ªåŠŸèƒ½</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨ HTTP ç«¯ç‚¹æˆ– JMX æ¥ç®¡ç†å’Œç›‘æ§æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚</p> <p>Spring Boot Actuator æ¨¡å—æä¾›äº† Spring Boot çš„æ‰€æœ‰<code>ç”Ÿäº§å°±ç»ªåŠŸèƒ½</code>ï¼Œæˆ‘ä»¬é€šè¿‡æ·»åŠ  spring-boot-starter-actuator <code>Starter</code>ä¾èµ–æ¥å¯ç”¨è¿™äº›åŠŸèƒ½ã€‚</p> <p><code>ç«¯ç‚¹</code>ï¼ˆendpointsï¼‰è®©æˆ‘ä»¬å¯ä»¥ç›‘æ§åº”ç”¨ç¨‹åºå¹¶ä¸ä¹‹äº¤äº’ã€‚Spring Boot åŒ…å«è®¸å¤šå†…ç½®ç«¯ç‚¹ï¼Œå¹¶å…è®¸æˆ‘ä»¬æ·»åŠ è‡ªå·±çš„ç«¯ç‚¹ã€‚ä¾‹å¦‚ï¼Œhealth ç«¯ç‚¹æä¾›åŸºæœ¬çš„åº”ç”¨ç¨‹åºå¥åº·ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥å•ç‹¬<code>å¯ç”¨</code>æˆ–<code>ç¦ç”¨</code>æ¯ä¸€ä¸ªç«¯ç‚¹å¹¶é€šè¿‡ HTTP æˆ– JMX <code>å…¬å¼€</code>å®ƒä»¬ï¼ˆä½¿å®ƒä»¬å¯ä»¥è¿œç¨‹è®¿é—®ï¼‰ã€‚å½“ç«¯ç‚¹è¢«<code>å¯ç”¨</code>å’Œ<code>å…¬å¼€</code>æ—¶ï¼Œå®ƒè¢«è®¤ä¸ºæ˜¯<code>å¯ç”¨</code>çš„ï¼Œå†…ç½®ç«¯ç‚¹ä»…åœ¨å¯ç”¨æ—¶æ‰ä¼šè‡ªåŠ¨é…ç½®ã€‚</p> <p>å¤§å¤šæ•°åº”ç”¨ç¨‹åºé€‰æ‹©é€šè¿‡ HTTP å…¬å¼€ç«¯ç‚¹ï¼Œå…¶ä¸­ç«¯ç‚¹çš„ ID å’Œå‰ç¼€ /actuator è¢«æ˜ å°„åˆ°ä¸€ä¸ª URL åœ°å€ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œhealth ç«¯ç‚¹æ˜ å°„åˆ° /actuator/healthã€‚</p> <p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé™¤äº† shutdown ä¹‹å¤–çš„æ‰€æœ‰ç«¯ç‚¹éƒ½æ˜¯å¯ç”¨çš„ï¼Œå¦‚æœè¦é…ç½®ä¸€ä¸ªç«¯ç‚¹çš„å¯ç”¨ï¼Œéœ€è¦ä½¿ç”¨ <code>management.endpoint.&lt;id&gt;.enabled</code> é…ç½®å±æ€§ã€‚</p> <p>ç”±äºç«¯ç‚¹å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œæˆ‘ä»¬åº”è¯¥ä»”ç»†è€ƒè™‘ä½•æ—¶å…¬å¼€å®ƒä»¬ã€‚ä¸‹è¡¨æ˜¾ç¤ºäº†å†…ç½®ç«¯ç‚¹çš„é»˜è®¤å…¬å¼€æƒ…å†µï¼š</p> <table><thead><tr><th style="text-align:left;">ID</th> <th style="text-align:left;">JMX</th> <th style="text-align:left;">Web</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>auditevents</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>beans</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>caches</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>conditions</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>configprops</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>env</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>flyway</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>health</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">Yes</td></tr> <tr><td style="text-align:left;"><code>heapdump</code></td> <td style="text-align:left;">N/A</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>httptrace</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>info</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>integrationgraph</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>jolokia</code></td> <td style="text-align:left;">N/A</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>logfile</code></td> <td style="text-align:left;">N/A</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>loggers</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>liquibase</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>metrics</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>mappings</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>prometheus</code></td> <td style="text-align:left;">N/A</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>quartz</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>scheduledtasks</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>sessions</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>shutdown</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>startup</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr> <tr><td style="text-align:left;"><code>threaddump</code></td> <td style="text-align:left;">Yes</td> <td style="text-align:left;">No</td></tr></tbody></table> <p>å¦‚æœæƒ³è¦æ›´æ”¹å…¬å¼€çš„ç«¯ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç‰¹å®šæŠ€æœ¯çš„ <code>include</code>å’Œ<code>exclude</code>é…ç½®å±æ€§ï¼š</p> <table><thead><tr><th style="text-align:left;">Property</th> <th style="text-align:left;">Default</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>management.endpoints.jmx.exposure.exclude</code></td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"><code>management.endpoints.jmx.exposure.include</code></td> <td style="text-align:left;"><code>*</code></td></tr> <tr><td style="text-align:left;"><code>management.endpoints.web.exposure.exclude</code></td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;"><code>management.endpoints.web.exposure.include</code></td> <td style="text-align:left;"><code>health</code></td></tr></tbody></table> <p>include å±æ€§åˆ—å‡ºéœ€è¦å…¬å¼€çš„ç«¯ç‚¹ IDã€‚exclude å±æ€§åˆ—å‡ºä¸åº”å…¬å¼€çš„ç«¯ç‚¹ IDï¼Œexclude ä¼˜å…ˆäº includeã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ç«¯ç‚¹ ID åˆ—è¡¨æ¥é…ç½® include å’Œ exclude å±æ€§ã€‚</p> <p><code>åº”ç”¨ç¨‹åºä¿¡æ¯</code>ï¼ˆApplication Informationï¼‰å…¬å¼€äº† ApplicationContext ä¸­å®šä¹‰çš„æ‰€æœ‰ InfoContributor bean æ”¶é›†çš„å„ç§ä¿¡æ¯ã€‚ Spring Boot åŒ…å«è®¸å¤šè‡ªåŠ¨é…ç½®çš„ InfoContributor beanï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç¼–å†™è‡ªå·±çš„ InfoContributor beanã€‚</p> <p>åœ¨é€‚å½“çš„æ—¶å€™ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½®ä»¥ä¸‹çš„ InfoContributor beanï¼š</p> <table><thead><tr><th style="text-align:left;">ID</th> <th style="text-align:left;">Bean</th> <th style="text-align:left;">æè¿°</th> <th style="text-align:left;">å…ˆå†³æ¡ä»¶</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>build</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/BuildInfoContributor.java" target="_blank" rel="noopener noreferrer"><code>BuildInfoContributor</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">å…¬å¼€æ„å»ºä¿¡æ¯</td> <td style="text-align:left;">èµ„æºæ–‡ä»¶<code>META-INF/build-info.properties</code> å­˜åœ¨</td></tr> <tr><td style="text-align:left;"><code>env</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/EnvironmentInfoContributor.java" target="_blank" rel="noopener noreferrer"><code>EnvironmentInfoContributor</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">å…¬å¼€æ‰€æœ‰ä»¥ <code>info.</code>å¼€å¤´çš„ç¯å¢ƒå±æ€§</td> <td style="text-align:left;">æ— </td></tr> <tr><td style="text-align:left;"><code>git</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/GitInfoContributor.java" target="_blank" rel="noopener noreferrer"><code>GitInfoContributor</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">å…¬å¼€ git ä¿¡æ¯</td> <td style="text-align:left;">èµ„æºæ–‡ä»¶<code>git.properties</code> å­˜åœ¨</td></tr> <tr><td style="text-align:left;"><code>java</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/JavaInfoContributor.java" target="_blank" rel="noopener noreferrer"><code>JavaInfoContributor</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">å…¬å¼€ Java è¿è¡Œæ—¶ä¿¡æ¯</td> <td style="text-align:left;">æ— </td></tr> <tr><td style="text-align:left;"><code>os</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/OsInfoContributor.java" target="_blank" rel="noopener noreferrer"><code>OsInfoContributor</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">å…¬å¼€æ“ä½œç³»ç»Ÿä¿¡æ¯</td> <td style="text-align:left;">æ— </td></tr></tbody></table> <p><code>management.info.&lt;id&gt;.enabled</code> å±æ€§æ§åˆ¶å•ä¸ª InfoContributor bean æ˜¯å¦å¯ç”¨ï¼Œä¸åŒçš„ InfoContributor bean å¯¹æ­¤å±æ€§æœ‰ä¸åŒçš„é»˜è®¤å€¼ï¼Œè¿™å–å†³äºå®ƒä»¬çš„å…ˆå†³æ¡ä»¶å’Œå®ƒä»¬å…¬å¼€ä¿¡æ¯çš„æ€§è´¨ã€‚é»˜è®¤æƒ…å†µä¸‹ envã€java å’Œ os è¢«ç¦ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å…¶ <code>management.info.&lt;id&gt;.enabled</code> å±æ€§è®¾ç½®ä¸º true æ¥å¼€å¯ã€‚build å’Œ git é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å…¶ <code>management.info.&lt;id&gt;.enabled</code> å±æ€§è®¾ç½®ä¸º false æ¥ç¦ç”¨ã€‚</p> <p><code>å¥åº·ä¿¡æ¯</code>ï¼ˆHealth Informationï¼‰å¯ä»¥ç”¨æ¥æ£€æŸ¥æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚å½“ç”Ÿäº§ç³»ç»Ÿå‡ºç°æ•…éšœæ—¶ï¼Œç›‘æ§è½¯ä»¶ç»å¸¸ä½¿ç”¨å®ƒæ¥æé†’æŸäººã€‚</p> <p>å¥åº·ä¿¡æ¯æ˜¯ä» HealthContributorRegistry çš„å†…å®¹ä¸­æ”¶é›†çš„ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰åœ¨ ApplicationContext ä¸­å®šä¹‰çš„ HealthContributor å®ä¾‹ï¼‰ã€‚ Spring Boot åŒ…å«è®¸å¤šè‡ªåŠ¨é…ç½®çš„ HealthContributorï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç¼–å†™è‡ªå·±çš„ã€‚</p> <p>åœ¨é€‚å½“çš„æ—¶å€™ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½®ä»¥ä¸‹çš„ HealthIndicator beanï¼š</p> <table><thead><tr><th style="text-align:left;">Key</th> <th style="text-align:left;">Bean</th> <th style="text-align:left;">æè¿°</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>cassandra</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/cassandra/CassandraDriverHealthIndicator.java" target="_blank" rel="noopener noreferrer"><code>CassandraDriverHealthIndicator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">æ£€æŸ¥ Cassandra æ•°æ®åº“æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr> <tr><td style="text-align:left;"><code>couchbase</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/couchbase/CouchbaseHealthIndicator.java" target="_blank" rel="noopener noreferrer"><code>CouchbaseHealthIndicator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">æ£€æŸ¥ Couchbase é›†ç¾¤æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr> <tr><td style="text-align:left;"><code>db</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/jdbc/DataSourceHealthIndicator.java" target="_blank" rel="noopener noreferrer"><code>DataSourceHealthIndicator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">æ£€æŸ¥æ˜¯å¦å¯ä»¥è·å¾—<code>DataSource</code>è¿æ¥ã€‚</td></tr> <tr><td style="text-align:left;"><code>diskspace</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/system/DiskSpaceHealthIndicator.java" target="_blank" rel="noopener noreferrer"><code>DiskSpaceHealthIndicator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦ä¸è¶³ã€‚</td></tr> <tr><td style="text-align:left;"><code>elasticsearch</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/elasticsearch/ElasticsearchRestHealthIndicator.java" target="_blank" rel="noopener noreferrer"><code>ElasticsearchRestHealthIndicator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">æ£€æŸ¥ Elasticsearch é›†ç¾¤æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr> <tr><td style="text-align:left;"><code>hazelcast</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/hazelcast/HazelcastHealthIndicator.java" target="_blank" rel="noopener noreferrer"><code>HazelcastHealthIndicator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">æ£€æŸ¥ Hazelcast æœåŠ¡æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr> <tr><td style="text-align:left;"><code>influxdb</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/influx/InfluxDbHealthIndicator.java" target="_blank" rel="noopener noreferrer"><code>InfluxDbHealthIndicator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">æ£€æŸ¥ InfluxDB æœåŠ¡æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr> <tr><td style="text-align:left;"><code>jms</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/jms/JmsHealthIndicator.java" target="_blank" rel="noopener noreferrer"><code>JmsHealthIndicator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">æ£€æŸ¥ JMS ä»£ç†æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr> <tr><td style="text-align:left;"><code>ldap</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/ldap/LdapHealthIndicator.java" target="_blank" rel="noopener noreferrer"><code>LdapHealthIndicator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">æ£€æŸ¥ LDAP æœåŠ¡æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr> <tr><td style="text-align:left;"><code>mail</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mail/MailHealthIndicator.java" target="_blank" rel="noopener noreferrer"><code>MailHealthIndicator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">æ£€æŸ¥é‚®ä»¶æœåŠ¡æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr> <tr><td style="text-align:left;"><code>mongo</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mongo/MongoHealthIndicator.java" target="_blank" rel="noopener noreferrer"><code>MongoHealthIndicator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">æ£€æŸ¥ Mongo æ•°æ®åº“æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr> <tr><td style="text-align:left;"><code>neo4j</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/neo4j/Neo4jHealthIndicator.java" target="_blank" rel="noopener noreferrer"><code>Neo4jHealthIndicator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">æ£€æŸ¥ Neo4j æ•°æ®åº“æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr> <tr><td style="text-align:left;"><code>ping</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/PingHealthIndicator.java" target="_blank" rel="noopener noreferrer"><code>PingHealthIndicator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">å§‹ç»ˆä»¥ <code>UP</code>å“åº”ã€‚</td></tr> <tr><td style="text-align:left;"><code>rabbit</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/amqp/RabbitHealthIndicator.java" target="_blank" rel="noopener noreferrer"><code>RabbitHealthIndicator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">æ£€æŸ¥ Rabbit æœåŠ¡æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr> <tr><td style="text-align:left;"><code>redis</code></td> <td style="text-align:left;"><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/redis/RedisHealthIndicator.java" target="_blank" rel="noopener noreferrer"><code>RedisHealthIndicator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">æ£€æŸ¥ Redis æœåŠ¡æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr></tbody></table> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>management.health.&lt;key&gt;.enabled</code> é…ç½®æ¥å¯ç”¨æˆ–ç¦ç”¨é€‰å®šçš„å¥åº·æ£€æŸ¥ã€‚</p> <h3 id="spring-boot-admin-ä»‹ç»"><a href="#spring-boot-admin-ä»‹ç»" class="header-anchor">#</a> Spring Boot Admin ä»‹ç»</h3> <p>Spring Boot Admin æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å’Œç›‘æ§æˆ‘ä»¬ Spring Boot åº”ç”¨ç¨‹åºçš„å¼€æºé¡¹ç›®ï¼Œç”±æœåŠ¡ç«¯ï¼ˆSpring Boot Admin Serverï¼‰å’Œå®¢æˆ·ç«¯ï¼ˆSpring Boot Admin Clientï¼‰ä¸¤éƒ¨åˆ†æ„æˆã€‚</p> <p>åº”ç”¨ç¨‹åºä½¿ç”¨ Spring Boot Admin Clientï¼ˆé€šè¿‡ HTTPï¼‰æˆ–ä½¿ç”¨ Spring Cloud è‡ªåŠ¨å‘ç°ï¼ˆä¾‹å¦‚ Eurekaã€Consulã€Nacos ç­‰ï¼‰å‘ Spring Boot Admin Server æ³¨å†Œã€‚</p> <p>Spring Boot Admin Server UI æ˜¯æ„å»ºåœ¨ Spring Boot Actuator ç«¯ç‚¹ä¹‹ä¸Šçš„ Vue.js åº”ç”¨ç¨‹åºï¼ŒSpring Boot Admin Server çš„ç›‘æ§ä¿¡æ¯å‡æ¥è‡ª Spring Boot Actuator ç«¯ç‚¹ï¼Œå¹¶ä¸”é€šè¿‡ç«¯ç‚¹æ¥ç®¡ç†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚</p> <h3 id="æ„å»º-spring-boot-admin-server"><a href="#æ„å»º-spring-boot-admin-server" class="header-anchor">#</a> æ„å»º Spring Boot Admin Server</h3> <ol><li>ä½¿ç”¨ <a href="https://start.spring.io/" target="_blank" rel="noopener noreferrer">Spring Initializr<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> åˆå§‹åŒ–ä¸€ä¸ª Spring Boot é¡¹ç›®ï¼Œå¹¶åŠ å…¥ä»¥ä¸‹ä¾èµ–å’Œä»“åº“ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;de.codecentric&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-admin-starter-server&lt;/artifactId&gt;
    &lt;version&gt;3.0.0-M1&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;


&lt;repositories&gt;
    &lt;repository&gt;
        &lt;id&gt;spring-milestone&lt;/id&gt;
        &lt;snapshots&gt;
            &lt;enabled&gt;false&lt;/enabled&gt;
        &lt;/snapshots&gt;
        &lt;url&gt;http://repo.spring.io/milestone&lt;/url&gt;
    &lt;/repository&gt;
    &lt;repository&gt;
        &lt;id&gt;spring-snapshot&lt;/id&gt;
        &lt;snapshots&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
        &lt;/snapshots&gt;
        &lt;url&gt;http://repo.spring.io/snapshot&lt;/url&gt;
    &lt;/repository&gt;
    &lt;repository&gt;
        &lt;id&gt;sonatype-nexus-snapshots&lt;/id&gt;
        &lt;name&gt;Sonatype Nexus Snapshots&lt;/name&gt;
        &lt;url&gt;https://oss.sonatype.org/content/repositories/snapshots/&lt;/url&gt;
        &lt;snapshots&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
        &lt;/snapshots&gt;
        &lt;releases&gt;
            &lt;enabled&gt;false&lt;/enabled&gt;
        &lt;/releases&gt;
    &lt;/repository&gt;
&lt;/repositories&gt;
</code></pre></div><ol start="2"><li>åœ¨ application.properties é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  Spring Security ç”¨æˆ·åã€å¯†ç çš„é…ç½®å±æ€§ï¼Œç”¨äºç™»å½• Spring Boot Admin Serverï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>spring.security.user.name=novel
spring.security.user.password=novel
</code></pre></div><ol start="3"><li>åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ  @EnableAdminServer æ³¨è§£ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>@SpringBootApplication
@EnableAdminServer
public class MonitorApplication {

	public static void main(String[] args) {
		SpringApplication.run(MonitorApplication.class, args);
	}

}
</code></pre></div><ol start="4"><li>æ·»åŠ  Spring Security é…ç½®ç±»ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>/**
 * Spring Security é…ç½®
 *
 * @author xiongxiaoyang
 * @date 2022/6/8
 */
@Configuration(proxyBeanMethods = false)
public class SecuritySecureConfig extends WebSecurityConfigurerAdapter {

    private final AdminServerProperties adminServer;

    private final SecurityProperties security;

    public SecuritySecureConfig(AdminServerProperties adminServer, SecurityProperties security) {
        this.adminServer = adminServer;
        this.security = security;
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        SavedRequestAwareAuthenticationSuccessHandler successHandler = new SavedRequestAwareAuthenticationSuccessHandler();
        successHandler.setTargetUrlParameter(&quot;redirectTo&quot;);
        successHandler.setDefaultTargetUrl(this.adminServer.path(&quot;/&quot;));

        http.authorizeRequests(
                        authorizeRequests -&gt; authorizeRequests
                                .antMatchers(this.adminServer.path(&quot;/assets/**&quot;)).permitAll()
                                .antMatchers(this.adminServer.path(&quot;/actuator/info&quot;)).permitAll()
                                .antMatchers(this.adminServer.path(&quot;/actuator/health&quot;)).permitAll()
                                .antMatchers(this.adminServer.path(&quot;/login&quot;)).permitAll()
                                .anyRequest().authenticated()
                ).formLogin(
                        formLogin -&gt; formLogin
                                .loginPage(this.adminServer.path(&quot;/login&quot;))
                                .successHandler(successHandler).and()
                ).logout(
                        logout -&gt; logout.logoutUrl(this.adminServer.path(&quot;/logout&quot;))
                ).httpBasic(Customizer.withDefaults())
                .csrf(csrf -&gt; csrf.csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())
                        .ignoringRequestMatchers(
                                new AntPathRequestMatcher(this.adminServer.path(&quot;/instances&quot;),
                                        HttpMethod.POST.toString()),
                                new AntPathRequestMatcher(this.adminServer.path(&quot;/instances/*&quot;),
                                        HttpMethod.DELETE.toString()),
                                new AntPathRequestMatcher(this.adminServer.path(&quot;/actuator/**&quot;))
                        ))
                .rememberMe(rememberMe -&gt; rememberMe
                        .key(UUID.randomUUID().toString())
                        .tokenValiditySeconds(1209600));
    }

    /**
     * Required to provide UserDetailsService for &quot;remember functionality&quot;
     * */
    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.inMemoryAuthentication().withUser(security.getUser().getName())
                .password(&quot;{noop}&quot; + security.getUser().getPassword()).roles(&quot;USER&quot;);
    }

}
</code></pre></div><p>æ­¤æ—¶ï¼Œè¿è¡Œåº”ç”¨ç¨‹åºï¼Œæµè§ˆå™¨ä¸­è®¿é—® 8080 ç«¯å£ï¼Œè¾“å…¥ä¸Šé¢é…ç½®çš„ç”¨æˆ·åå’Œå¯†ç å³å¯è¿›å…¥ Spring Boot Admin Server æ§åˆ¶å°ç®¡ç†å’Œç›‘æ§æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚</p> <h3 id="é€šè¿‡-spring-boot-admin-client-æ³¨å†Œ-novel-æœåŠ¡"><a href="#é€šè¿‡-spring-boot-admin-client-æ³¨å†Œ-novel-æœåŠ¡" class="header-anchor">#</a> é€šè¿‡ Spring Boot Admin Client æ³¨å†Œ novel æœåŠ¡</h3> <ol><li>åœ¨æˆ‘ä»¬ novel é¡¹ç›®ä¸­åŠ å…¥ä»¥ä¸‹ä¾èµ–å’Œä»“åº“ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;de.codecentric&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-admin-starter-client&lt;/artifactId&gt;
    &lt;version&gt;3.0.0-M1&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;


&lt;repository&gt;
    &lt;id&gt;sonatype-nexus-snapshots&lt;/id&gt;
    &lt;name&gt;Sonatype Nexus Snapshots&lt;/name&gt;
    &lt;url&gt;https://oss.sonatype.org/content/repositories/snapshots/&lt;/url&gt;
    &lt;snapshots&gt;
        &lt;enabled&gt;true&lt;/enabled&gt;
    &lt;/snapshots&gt;
    &lt;releases&gt;
        &lt;enabled&gt;false&lt;/enabled&gt;
    &lt;/releases&gt;
&lt;/repository&gt;
</code></pre></div><ol start="2"><li>åœ¨ novel é¡¹ç›®çš„ application.yml é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹é…ç½®ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>spring:
  # Spring Boot åº”ç”¨ç®¡ç†å’Œç›‘æ§
  boot:
    admin:
      client:
        # æ˜¯å¦å¼€å¯ Spring Boot Admin å®¢æˆ·ç«¯
        enabled: true
        # Spring Boot Admin æœåŠ¡ç«¯æ³¨å†Œåœ°å€
        url: http://localhost:8080
        # Spring Boot Admin æœåŠ¡ç«¯è®¤è¯ç”¨æˆ·å
        username: novel
        # Spring Boot Admin æœåŠ¡ç«¯è®¤è¯å¯†ç 
        password: novel
        instance:
          metadata:
            # SBA Client
            user.name: ${spring.security.user.name}
            user.password: ${spring.security.user.password}
  security:
    user:
      # Actuator ç«¯ç‚¹ä¿æŠ¤é…ç½®
      name: ENDPOINT_ADMIN
      password: ENDPOINT_ADMIN
      roles: ENDPOINT_ADMIN

# Actuator ç«¯ç‚¹ç®¡ç†
management:
  # ç«¯ç‚¹å…¬å¼€é…ç½®
  endpoints:
    # é€šè¿‡ HTTP å…¬å¼€çš„ Web ç«¯ç‚¹
    web:
      exposure:
        # å…¬å¼€æ‰€æœ‰çš„ Web ç«¯ç‚¹
        include: &quot;*&quot;

  # ç«¯ç‚¹å¯ç”¨é…ç½®
  endpoint:
    logfile:
      # å¯ç”¨è¿”å›æ—¥å¿—æ–‡ä»¶å†…å®¹çš„ç«¯ç‚¹
      enabled: true
      # å¤–éƒ¨æ—¥å¿—æ–‡ä»¶è·¯å¾„
      external-file: logs/novel.log

  info:
    env:
      # å…¬å¼€æ‰€æœ‰ä»¥ info. å¼€å¤´çš„ç¯å¢ƒå±æ€§
      enabled: true
  health:
    rabbit:
      # å…³é—­ rabbitmq çš„å¥åº·æ£€æŸ¥
      enabled: false
    elasticsearch:
      # å…³é—­ elasticsearch çš„å¥åº·æ£€æŸ¥
      enabled: false

</code></pre></div><ol start="3"><li>novel é¡¹ç›®å¯åŠ¨ç±»ä¸­æ·»åŠ  Spring Boot Actuator ç«¯ç‚¹ä¿æŠ¤çš„ Spring Security é…ç½®ï¼š</li></ol> <div class="language- extra-class"><pre class="language-text"><code>@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http.csrf().disable()
            .requestMatcher(EndpointRequest.toAnyEndpoint())
            .authorizeRequests(requests -&gt; requests.anyRequest().hasRole(&quot;ENDPOINT_ADMIN&quot;));
    http.httpBasic();
    return http.build();
}
</code></pre></div><p>æ­¤æ—¶ï¼Œå¯åŠ¨ novel é¡¹ç›®ï¼Œç™»å½• Spring Boot Admin Server æ§åˆ¶å°å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç›‘æ§ä¿¡æ¯ï¼š</p> <p><img src="/img/novel/springbootadmin1.png" alt="Spring Boot Admin"> <img src="/img/novel/springbootadmin2.png" alt="Spring Boot Admin"> <img src="/img/novel/springbootadmin3.png" alt="Spring Boot Admin"> <img src="/img/novel/springbootadmin4.png" alt="Spring Boot Admin"> <img src="/img/novel/springbootadmin5.png" alt="Spring Boot Admin"></p> <p>è¸©å‘ï¼šåœ¨å¯åŠ¨ Spring Boot Admin Server ä¹‹å‰æœ‰ä¸ª node ç¨‹åºç›‘å¬äº† 8080 ç«¯å£æ²¡æœ‰é‡Šæ”¾ï¼Œç„¶åå¯åŠ¨ Spring Boot Admin Serverï¼ˆé»˜è®¤ä¹Ÿæ˜¯ 8080 ç«¯å£ï¼‰ï¼Œæ­¤æ—¶æµè§ˆå™¨ä¸­å¯ä»¥æ­£å¸¸è®¿é—®åˆ° Spring Boot Admin Server çš„ç•Œé¢ï¼Œä½†æ˜¯ novel æœåŠ¡æ— æ³•æ³¨å†Œåˆ° Spring Boot Admin Server ä¸Šï¼Œæç¤º404 é”™è¯¯ã€‚åæ¥å‘ç° novel æœåŠ¡çš„æ³¨å†Œè¢«ç›‘å¬ 8080 ç«¯å£çš„ node ç¨‹åºå¤„ç†äº†ï¼Œå…³é—­è¯¥ node ç¨‹åºå³å¯æ­£å¸¸æ³¨å†Œã€‚ è¯¥æœºåˆ¶è¯·å‚è€ƒ <a href="https://segmentfault.com/a/1190000014701988" target="_blank" rel="noopener noreferrer">Node.Js çš„ç«¯å£é‡ç”¨<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">16 days ago</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/course/novel/4.html" class="prev">
        é¡¹ç›®å¼€å‘
      </a></span> <span class="next"><a href="/course/novel/6.html">
        é¡¹ç›®éƒ¨ç½²
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div><div></div></div></div>
    <script src="/assets/js/app.09e306c7.js" defer></script><script src="/assets/js/2.99247de7.js" defer></script><script src="/assets/js/19.4939c52f.js" defer></script>
  </body>
</html>
