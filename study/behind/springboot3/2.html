<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>æ ¸å¿ƒåŠŸèƒ½ | å°è¯´ç²¾å“å±‹</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script crossorigin="anonymous" async="true" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7927582798443371"></script>
    <script src="/redirect.js"></script>
    <meta name="description" content="å°è¯´ç²¾å“å±‹é¡¹ç›®å¼€å‘æ–‡æ¡£,JAVAå­¦ä¹ æ•™ç¨‹,JAVAå¼€æºé¡¹ç›®,JAVAé¡¹ç›®å®æˆ˜æ•™ç¨‹,æ‰‹æŠŠæ‰‹æ•™ä½ å¼€å‘ä¸Šçº¿ä¸€ä¸ªç”Ÿäº§çº§åˆ«çš„å°è¯´ç³»ç»Ÿ">
    
    <link rel="preload" href="/assets/css/0.styles.f109e9b6.css" as="style"><link rel="preload" href="/assets/js/app.09e306c7.js" as="script"><link rel="preload" href="/assets/js/2.99247de7.js" as="script"><link rel="preload" href="/assets/js/26.4fbe7fce.js" as="script"><link rel="prefetch" href="/assets/js/10.0074f0b6.js"><link rel="prefetch" href="/assets/js/11.a30c50a6.js"><link rel="prefetch" href="/assets/js/12.8b56d8ab.js"><link rel="prefetch" href="/assets/js/13.c749534f.js"><link rel="prefetch" href="/assets/js/14.d3b12aa4.js"><link rel="prefetch" href="/assets/js/15.74294d9c.js"><link rel="prefetch" href="/assets/js/16.6da0ac7a.js"><link rel="prefetch" href="/assets/js/17.1ab88373.js"><link rel="prefetch" href="/assets/js/18.8875335c.js"><link rel="prefetch" href="/assets/js/19.4939c52f.js"><link rel="prefetch" href="/assets/js/20.34025d9d.js"><link rel="prefetch" href="/assets/js/21.7cce32ee.js"><link rel="prefetch" href="/assets/js/22.11440c86.js"><link rel="prefetch" href="/assets/js/23.e192cd17.js"><link rel="prefetch" href="/assets/js/24.45216f10.js"><link rel="prefetch" href="/assets/js/25.3be12542.js"><link rel="prefetch" href="/assets/js/27.ba19a09d.js"><link rel="prefetch" href="/assets/js/28.8fee7490.js"><link rel="prefetch" href="/assets/js/29.1393ab46.js"><link rel="prefetch" href="/assets/js/3.d1f014c5.js"><link rel="prefetch" href="/assets/js/30.d7fe8f4e.js"><link rel="prefetch" href="/assets/js/31.3e268b35.js"><link rel="prefetch" href="/assets/js/4.c866ff58.js"><link rel="prefetch" href="/assets/js/5.1dabba3b.js"><link rel="prefetch" href="/assets/js/6.2b9e04ea.js"><link rel="prefetch" href="/assets/js/7.da8e9de0.js"><link rel="prefetch" href="/assets/js/8.f14eb728.js"><link rel="prefetch" href="/assets/js/9.89a7523c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f109e9b6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="å°è¯´ç²¾å“å±‹" class="logo"> <span class="site-name can-hide">å°è¯´ç²¾å“å±‹</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="http://47.106.243.172:8888" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åœ¨çº¿æ¼”ç¤º
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://developer.aliyun.com/ebook/read/394" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å¼€å‘è§„çº¦
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.xxyopen.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æŠ€æœ¯åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Project Menu" class="dropdown-title"><span class="title">é¡¹ç›®å®æˆ˜</span> <span class="arrow down"></span></button> <button type="button" aria-label="Project Menu" class="mobile-dropdown-title"><span class="title">é¡¹ç›®å®æˆ˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/course/novel/" class="nav-link">
  novel
</a></li><li class="dropdown-item"><!----> <a href="/course/novelcloud.html" class="nav-link">
  novel-cloud
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Log Menu" class="dropdown-title"><span class="title">æ›´æ–°æ—¥å¿—</span> <span class="arrow down"></span></button> <button type="button" aria-label="Log Menu" class="mobile-dropdown-title"><span class="title">æ›´æ–°æ—¥å¿—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/log/novel.html" class="nav-link">
  novel
</a></li><li class="dropdown-item"><!----> <a href="/log/novelcloud.html" class="nav-link">
  novel-cloud
</a></li></ul></div></div><div class="nav-item"><a href="/suport/" class="nav-link">
  ğŸ’–æ”¯æŒ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub Menu" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub Menu" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/201206030/novel" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/201206030/novel-plus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-plus
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/201206030/novel-cloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-cloud
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Gitee Menu" class="dropdown-title"><span class="title">ç äº‘</span> <span class="arrow down"></span></button> <button type="button" aria-label="Gitee Menu" class="mobile-dropdown-title"><span class="title">ç äº‘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/novel_dev_team/novel" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/novel_dev_team/novel-plus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-plus
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/novel_dev_team/novel-cloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-cloud
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="http://47.106.243.172:8888" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åœ¨çº¿æ¼”ç¤º
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://developer.aliyun.com/ebook/read/394" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å¼€å‘è§„çº¦
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.xxyopen.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æŠ€æœ¯åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Project Menu" class="dropdown-title"><span class="title">é¡¹ç›®å®æˆ˜</span> <span class="arrow down"></span></button> <button type="button" aria-label="Project Menu" class="mobile-dropdown-title"><span class="title">é¡¹ç›®å®æˆ˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/course/novel/" class="nav-link">
  novel
</a></li><li class="dropdown-item"><!----> <a href="/course/novelcloud.html" class="nav-link">
  novel-cloud
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Log Menu" class="dropdown-title"><span class="title">æ›´æ–°æ—¥å¿—</span> <span class="arrow down"></span></button> <button type="button" aria-label="Log Menu" class="mobile-dropdown-title"><span class="title">æ›´æ–°æ—¥å¿—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/log/novel.html" class="nav-link">
  novel
</a></li><li class="dropdown-item"><!----> <a href="/log/novelcloud.html" class="nav-link">
  novel-cloud
</a></li></ul></div></div><div class="nav-item"><a href="/suport/" class="nav-link">
  ğŸ’–æ”¯æŒ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub Menu" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub Menu" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/201206030/novel" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/201206030/novel-plus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-plus
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/201206030/novel-cloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-cloud
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Gitee Menu" class="dropdown-title"><span class="title">ç äº‘</span> <span class="arrow down"></span></button> <button type="button" aria-label="Gitee Menu" class="mobile-dropdown-title"><span class="title">ç äº‘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/novel_dev_team/novel" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/novel_dev_team/novel-plus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-plus
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/novel_dev_team/novel-cloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  novel-cloud
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/study/behind/springboot3/" aria-current="page" class="sidebar-link">Spring Boot å…¥é—¨</a></li><li><a href="/study/behind/springboot3/1.html" class="sidebar-link">Spring Boot ä½¿ç”¨</a></li><li><a href="/study/behind/springboot3/2.html" aria-current="page" class="active sidebar-link">æ ¸å¿ƒåŠŸèƒ½</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#springapplication" class="sidebar-link">SpringApplication</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#å¯åŠ¨å¤±è´¥åˆ†æ" class="sidebar-link">å¯åŠ¨å¤±è´¥åˆ†æ</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#å»¶è¿Ÿåˆå§‹åŒ–" class="sidebar-link">å»¶è¿Ÿåˆå§‹åŒ–</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#è‡ªå®šä¹‰-banner" class="sidebar-link">è‡ªå®šä¹‰ banner</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#è‡ªå®šä¹‰-springapplication" class="sidebar-link">è‡ªå®šä¹‰ SpringApplication</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#springapplicationbuilder" class="sidebar-link">SpringApplicationBuilder</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#å¯ç”¨æ€§çŠ¶æ€" class="sidebar-link">å¯ç”¨æ€§çŠ¶æ€</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#äº‹ä»¶å’Œç›‘å¬å™¨" class="sidebar-link">äº‹ä»¶å’Œç›‘å¬å™¨</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#web-ç¯å¢ƒ" class="sidebar-link">Web ç¯å¢ƒ</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#è®¿é—®åº”ç”¨ç¨‹åºå‚æ•°" class="sidebar-link">è®¿é—®åº”ç”¨ç¨‹åºå‚æ•°</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#å¯åŠ¨æ—¶ä»»åŠ¡" class="sidebar-link">å¯åŠ¨æ—¶ä»»åŠ¡</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#åº”ç”¨ç¨‹åºé€€å‡º" class="sidebar-link">åº”ç”¨ç¨‹åºé€€å‡º</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#é…ç½®" class="sidebar-link">é…ç½®</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#å‘½ä»¤è¡Œå±æ€§" class="sidebar-link">å‘½ä»¤è¡Œå±æ€§</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#json-åº”ç”¨å±æ€§" class="sidebar-link">JSON åº”ç”¨å±æ€§</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#å¤–éƒ¨åº”ç”¨å±æ€§" class="sidebar-link">å¤–éƒ¨åº”ç”¨å±æ€§</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#é…ç½®éšæœºå€¼" class="sidebar-link">é…ç½®éšæœºå€¼</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#é…ç½®ç³»ç»Ÿç¯å¢ƒå±æ€§" class="sidebar-link">é…ç½®ç³»ç»Ÿç¯å¢ƒå±æ€§</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#ç±»å‹å®‰å…¨çš„é…ç½®å±æ€§" class="sidebar-link">ç±»å‹å®‰å…¨çš„é…ç½®å±æ€§</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#profiles" class="sidebar-link">Profiles</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#æ—¥å¿—" class="sidebar-link">æ—¥å¿—</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#æ—¥å¿—æ ¼å¼" class="sidebar-link">æ—¥å¿—æ ¼å¼</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#æ§åˆ¶å°è¾“å‡º" class="sidebar-link">æ§åˆ¶å°è¾“å‡º</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#æ–‡ä»¶è¾“å‡º" class="sidebar-link">æ–‡ä»¶è¾“å‡º</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#æ–‡ä»¶è½®æ¢" class="sidebar-link">æ–‡ä»¶è½®æ¢</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#æ—¥å¿—çº§åˆ«" class="sidebar-link">æ—¥å¿—çº§åˆ«</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#æ—¥å¿—åˆ†ç»„" class="sidebar-link">æ—¥å¿—åˆ†ç»„</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#è‡ªå®šä¹‰æ—¥å¿—é…ç½®" class="sidebar-link">è‡ªå®šä¹‰æ—¥å¿—é…ç½®</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#logback-æ‰©å±•" class="sidebar-link">Logback æ‰©å±•</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#json" class="sidebar-link">JSON</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#jackson" class="sidebar-link">Jackson</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#gson" class="sidebar-link">Gson</a></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#json-b" class="sidebar-link">JSON-B</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/behind/springboot3/2.html#ä»»åŠ¡æ‰§è¡Œä¸è°ƒåº¦" class="sidebar-link">ä»»åŠ¡æ‰§è¡Œä¸è°ƒåº¦</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="æ ¸å¿ƒåŠŸèƒ½"><a href="#æ ¸å¿ƒåŠŸèƒ½" class="header-anchor">#</a> æ ¸å¿ƒåŠŸèƒ½</h1> <h2 id="springapplication"><a href="#springapplication" class="header-anchor">#</a> SpringApplication</h2> <p>SpringApplication ç±»æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•ç”¨æ¥å¼•å¯¼ä» main() æ–¹æ³•å¯åŠ¨çš„ Spring åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥å§”æ‰˜ç»™é™æ€æ–¹æ³• SpringApplication.run ï¼Œå¦‚ä¸‹æ‰€ç¤º</p> <div class="language- extra-class"><pre class="language-text"><code>@SpringBootApplication
public class NovelApplication {

    public static void main(String[] args) {
        SpringApplication.run(NovelApplication.class, args);
    }

}
</code></pre></div><p>åº”ç”¨å¯åŠ¨æ—¶ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::       (v3.0.0-SNAPSHOT)

2022-05-07T10:16:13.116+08:00  INFO 33212 --- [  restartedMain] i.github.xxyopen.novel.NovelApplication  : Starting NovelApplication using Java 17.0.3 on xiongxiaoyangdeMacBook-Air.local with PID 33212 (/Users/xiongxiaoyang/java/springboot3/target/classes started by xiongxiaoyang in /Users/xiongxiaoyang/java/springboot3)
2022-05-07T10:16:13.120+08:00  INFO 33212 --- [  restartedMain] i.github.xxyopen.novel.NovelApplication  : No active profile set, falling back to 1 default profile: &quot;default&quot;
2022-05-07T10:16:13.247+08:00  INFO 33212 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2022-05-07T10:16:13.248+08:00  INFO 33212 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2022-05-07T10:16:15.136+08:00  INFO 33212 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
2022-05-07T10:16:15.164+08:00  INFO 33212 --- [  restartedMain] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2022-05-07T10:16:15.164+08:00  INFO 33212 --- [  restartedMain] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/10.0.18]
2022-05-07T10:16:15.291+08:00  INFO 33212 --- [  restartedMain] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2022-05-07T10:16:15.294+08:00  INFO 33212 --- [  restartedMain] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 2042 ms
2022-05-07T10:16:15.896+08:00  INFO 33212 --- [  restartedMain] o.s.b.d.a.OptionalLiveReloadServer       : LiveReload server is running on port 35729
2022-05-07T10:16:15.948+08:00  INFO 33212 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
2022-05-07T10:16:15.960+08:00  INFO 33212 --- [  restartedMain] i.github.xxyopen.novel.NovelApplication  : Started NovelApplication in 8.561 seconds (JVM running for 9.373)
</code></pre></div><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ§åˆ¶å°ä¼šæ˜¾ç¤º INFO çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸€äº›ç›¸å…³çš„å¯åŠ¨è¯¦ç»†ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® spring.main.log-startup-info=false å±æ€§æ¥å…³é—­å¯åŠ¨æ—¥å¿—ä¿¡æ¯ã€‚</p> <p>æˆ‘ä»¬å¦‚æœæƒ³æ·»åŠ é¢å¤–çš„å¯åŠ¨æ—¥å¿—ï¼Œå¯ä»¥åœ¨ SpringApplication å­ç±»ä¸­é‡å†™ logStartupInfo(boolean) æ–¹æ³•ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>@SpringBootApplication
public class NovelApplication {

    public static void main(String[] args) {
        SpringApplication application = new SpringApplication(NovelApplication.class){
            @Override
            protected void logStartupInfo(boolean isRoot) {
                getApplicationLog().info(&quot;å°è¯´ç²¾å“å±‹å¼€å§‹å¯åŠ¨å•¦ã€‚ã€‚ã€‚&quot;);
                super.logStartupInfo(isRoot);
            }
        };
        application.run(args);
    }

}
</code></pre></div><h3 id="å¯åŠ¨å¤±è´¥åˆ†æ"><a href="#å¯åŠ¨å¤±è´¥åˆ†æ" class="header-anchor">#</a> å¯åŠ¨å¤±è´¥åˆ†æ</h3> <p>å¦‚æœåº”ç”¨ç¨‹åºå¯åŠ¨å¤±è´¥ï¼Œæˆ‘ä»¬é€šè¿‡æ³¨å†Œçš„ FailureAnalyzers èƒ½å¤Ÿå¾—åˆ°ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯æè¿°å’Œå…·ä½“çš„è§£å†³æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œå¯åŠ¨ web åº”ç”¨çš„ç«¯å£å· 8080 è¢«å ç”¨äº†ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä¸‹çš„æ¶ˆæ¯ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>***************************
APPLICATION FAILED TO START
***************************

Description:

Web server failed to start. Port 8080 was already in use.

Action:

Identify and stop the process that's listening on port 8080 or configure this application to listen on another port.
</code></pre></div><p>Spring Boot æä¾›äº†å¾ˆå¤š FailureAnalyzer çš„å®ç°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ META-INF/spring.factories ä¸­æ·»åŠ è‡ªå·±çš„ FailureAnalyzer å®ç°ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code># Failure analyzers
org.springframework.boot.diagnostics.FailureAnalyzer=\
org.springframework.boot.autoconfigure.data.redis.RedisUrlSyntaxFailureAnalyzer,\
org.springframework.boot.autoconfigure.diagnostics.analyzer.NoSuchBeanDefinitionFailureAnalyzer,\
org.springframework.boot.autoconfigure.flyway.FlywayMigrationScriptMissingFailureAnalyzer,\
org.springframework.boot.autoconfigure.jdbc.DataSourceBeanCreationFailureAnalyzer,\
org.springframework.boot.autoconfigure.jdbc.HikariDriverConfigurationFailureAnalyzer,\
org.springframework.boot.autoconfigure.jooq.NoDslContextBeanFailureAnalyzer,\
org.springframework.boot.autoconfigure.r2dbc.ConnectionFactoryBeanCreationFailureAnalyzer,\
org.springframework.boot.autoconfigure.r2dbc.MissingR2dbcPoolDependencyFailureAnalyzer,\
org.springframework.boot.autoconfigure.r2dbc.MultipleConnectionPoolConfigurationsFailureAnalzyer,\
org.springframework.boot.autoconfigure.r2dbc.NoConnectionFactoryBeanFailureAnalyzer,\
org.springframework.boot.autoconfigure.session.NonUniqueSessionRepositoryFailureAnalyzer
</code></pre></div><p>å¦‚æœ FailureAnalyzers ä¸èƒ½å¤„ç†æˆ‘ä»¬çš„å¼‚å¸¸ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® debug å±æ€§æˆ–è€…ç»™ org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener è®¾ç½® DEBUG çº§åˆ«çš„æ—¥å¿—æ¥æŸ¥çœ‹å®Œæ•´çš„é”™è¯¯æŠ¥å‘Šä»¥æ›´å¥½çš„äº†è§£é—®é¢˜æ‰€åœ¨ã€‚</p> <p>è®¾ç½® debug å±æ€§ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -jar target/novel-0.0.1-SNAPSHOT.jar --debug
</code></pre></div><p>è®¾ç½® DEBUG çº§åˆ«æ—¥å¿—ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>logging.level.org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener=debug
</code></pre></div><h3 id="å»¶è¿Ÿåˆå§‹åŒ–"><a href="#å»¶è¿Ÿåˆå§‹åŒ–" class="header-anchor">#</a> å»¶è¿Ÿåˆå§‹åŒ–</h3> <p>SpringApplication å…è®¸æˆ‘ä»¬çš„åº”ç”¨å»¶è¿Ÿåˆå§‹åŒ–ã€‚å½“å»¶è¿Ÿåˆå§‹åŒ–å¼€å¯åï¼Œbeans ä¸æ˜¯åœ¨åº”ç”¨å¯åŠ¨æœŸé—´è€Œæ˜¯åœ¨éœ€è¦æ—¶åˆ›å»ºï¼Œè¿™æ ·ä¼šå‡å°‘åº”ç”¨çš„å¯åŠ¨æ—¶é—´ã€‚åœ¨ä¸€ä¸ª web åº”ç”¨ä¸­ï¼Œå¼€å¯å»¶è¿Ÿåˆå§‹åŒ–å°†å¯¼è‡´è®¸å¤š web ç›¸å…³çš„ beans åœ¨ HTTP è¯·æ±‚åˆ°æ¥æ—¶æ‰ä¼šåˆ›å»ºã€‚</p> <p>å»¶è¿Ÿåˆå§‹åŒ–çš„ä¸€ä¸ªä¸è¶³ä¹‹å¤„åœ¨äºä¸èƒ½åŠæ—¶å‘ç°åº”ç”¨çš„é—®é¢˜ï¼Œå¦‚æœä¸€ä¸ªé”™è¯¯é…ç½®çš„ bean è¢«å»¶è¿Ÿåˆå§‹åŒ–ï¼Œé‚£ä¹ˆåº”ç”¨å¯åŠ¨æœŸé—´å°†ä¸å†å‘ç”Ÿé”™è¯¯ï¼Œè€Œæ˜¯ä»…ä»…å½“ bean åˆå§‹åŒ–çš„æ—¶å€™æ‰ä¼šæš´éœ²é—®é¢˜ï¼Œè€Œä¸”è¿˜å¿…é¡»è¦æ³¨æ„ä¿è¯ JVM æœ‰è¶³å¤Ÿçš„å†…å­˜æ¥å®¹çº³åº”ç”¨ç¨‹åºçš„æ‰€æœ‰ beans è€Œä¸æ˜¯ä»…ä»…åœ¨åº”ç”¨å¯åŠ¨æœŸé—´åˆå§‹åŒ–çš„é‚£äº› beansã€‚åŸºäºè¿™äº›åŸå› ï¼Œå»¶è¿Ÿåˆå§‹åŒ–é»˜è®¤æƒ…å†µä¸‹æ˜¯å…³é—­çš„ï¼Œå¹¶ä¸”å»ºè®®åœ¨å¯ç”¨å»¶è¿Ÿåˆå§‹åŒ–ä¹‹å‰å¯¹ JVM çš„å †å¤§å°è¿›è¡Œå¾®è°ƒã€‚</p> <p>å»¶è¿Ÿåˆå§‹åŒ–å¯ä»¥é€šè¿‡ SpringApplicationBuilder çš„ lazyInitialization æ–¹æ³•æˆ– SpringApplication çš„ setLazyInitialization æ–¹æ³•ç­‰ç¼–ç¨‹å¼æ–¹å¼å¼€å¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½® spring.main.lazy-initialization å±æ€§çš„æ–¹å¼æ¥å¼€å¯ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>spring.main.lazy-initialization=true
</code></pre></div><p>å¦‚æœæƒ³åœ¨ä½¿ç”¨å»¶è¿Ÿåˆå§‹åŒ–çš„æ—¶å€™ç¦ç”¨æŸäº›ç‰¹å®š beans çš„å»¶è¿Ÿåˆå§‹åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ @Lazy(false) æ³¨è§£å°†å…¶å»¶è¿Ÿå±æ€§æ˜¾å¼è®¾ç½®ä¸º falseã€‚</p> <h3 id="è‡ªå®šä¹‰-banner"><a href="#è‡ªå®šä¹‰-banner" class="header-anchor">#</a> è‡ªå®šä¹‰ banner</h3> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ classpath ä¸‹æ·»åŠ ä¸€ä¸ª banner.txt æ–‡ä»¶æˆ–è€…è®¾ç½® spring.banner.location å±æ€§ä¸ºå¦å¤–ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„æ¥æ”¹å˜åº”ç”¨å¯åŠ¨æ—¶æ‰“å°çš„ bannerã€‚å¦‚æœæ–‡ä»¶çš„ç¼–ç ä¸æ˜¯ UTF-8ï¼Œè¿˜å¯ä»¥è®¾ç½® spring.banner.charset å±æ€§ã€‚æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡è°ƒç”¨ SpringApplication.setBanner(â€¦â€‹) æ–¹æ³•æˆ–å®ç° org.springframework.boot.Banner æ¥å£çš„ printBanner æ–¹æ³•ç­‰ç¼–ç¨‹æ–¹å¼æ¥æ”¹å˜ bannerã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª banner å†…å®¹çš„ç¤ºä¾‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>${AnsiColor.CYAN}

--------------------------------------------------------------------------------
${AnsiColor.RED}
||   / |  / /
||  /  | / /  ___     //  ___      ___      _   __
|| / /||/ / //___) ) // //   ) ) //   ) ) // ) )  ) )
||/ / |  / //       // //       //   / / // / /  / /
|  /  | / ((____   // ((____   ((___/ / // / /  / /   å°è¯´ç²¾å“å±‹æ¬¢è¿æ‚¨ï¼ï¼ï¼

                                               -------Powered By XXY
${AnsiColor.CYAN}
--------------------------------------------------------------------------------
${AnsiColor.BRIGHT_YELLOW}
::: Spring-Boot ${spring-boot.formatted-version} :::
</code></pre></div><h3 id="è‡ªå®šä¹‰-springapplication"><a href="#è‡ªå®šä¹‰-springapplication" class="header-anchor">#</a> è‡ªå®šä¹‰ SpringApplication</h3> <p>å¦‚æœæˆ‘ä»¬æƒ³æ”¹å˜ SpringApplication çš„é»˜è®¤é…ç½®ï¼Œå¯ä»¥ä¸ç›´æ¥è°ƒç”¨é™æ€æ–¹æ³• SpringApplication.run ï¼Œè€Œæ˜¯åˆ›å»º SpringApplication çš„æœ¬åœ°å®ä¾‹å¹¶å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰ã€‚ä¾‹å¦‚ï¼Œè¦å…³é—­æ¨ªå¹…ï¼Œå¯ä»¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>@SpringBootApplication
public class NovelApplication {

    public static void main(String[] args) {
        SpringApplication application = new SpringApplication(NovelApplication.class);
        application.setBannerMode(Banner.Mode.OFF);
        application.run(args);
    }

}
</code></pre></div><p>ä¼ é€’ç»™ SpringApplication çš„æ„é€ å‚æ•°æ˜¯ Spring beans çš„é…ç½®æºã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ˜¯ä¸€ä¸ª @Configuration ç±»ï¼Œä¹Ÿå¯ä»¥æ˜¯ @Component ç±»ã€‚</p> <p>SpringApplication ä¹Ÿå¯ä»¥é€šè¿‡ application.properties é…ç½®æ–‡ä»¶é…ç½®ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>spring.main.banner-mode=off
</code></pre></div><h3 id="springapplicationbuilder"><a href="#springapplicationbuilder" class="header-anchor">#</a> SpringApplicationBuilder</h3> <p>å¦‚æœæƒ³æ„å»ºä¸€ä¸ªæœ‰å±‚æ¬¡çš„ ApplicationContextï¼ˆå…·æœ‰çˆ¶/å­å…³ç³»çš„å¤šä¸ªä¸Šä¸‹æ–‡ï¼‰æˆ–è€…æ›´æƒ³ä½¿ç”¨æµåˆ©çš„æ„å»ºå™¨ APIï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ SpringApplicationBuilderã€‚</p> <p>SpringApplicationBuilder å¯ä»¥è®©æˆ‘ä»¬é“¾å¼è°ƒç”¨å¤šä¸ªåŒ…å« parent å’Œ child åœ¨å†…çš„æœ‰å±‚æ¬¡ç»“æ„çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>new SpringApplicationBuilder()
        .sources(Parent.class)
        .child(Application.class)
        .bannerMode(Banner.Mode.OFF)
        .run(args);

</code></pre></div><h3 id="å¯ç”¨æ€§çŠ¶æ€"><a href="#å¯ç”¨æ€§çŠ¶æ€" class="header-anchor">#</a> å¯ç”¨æ€§çŠ¶æ€</h3> <p>å½“åº”ç”¨éƒ¨ç½²åœ¨å¹³å°ä¸Šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼äº Kubernetes Probes çš„åŸºç¡€è®¾æ–½æä¾›å…¶å¯ç”¨æ€§çš„ä¿¡æ¯ã€‚Spring Boot åŒ…å«äº†å¯¹å¸¸ç”¨çš„ livenessï¼ˆæ´»è·ƒçŠ¶æ€ï¼‰ å’Œ readinessï¼ˆå°±ç»ªçŠ¶æ€ï¼‰ ç­‰å¯ç”¨æ€§çŠ¶æ€çš„å¼€ç®±å³ç”¨æ”¯æŒã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨äº† Spring Boot çš„ actuatorï¼Œé‚£ä¹ˆè¿™äº›çŠ¶æ€å°†ä½œä¸ºå¥åº·ç»„ï¼ˆhealthï¼‰çš„ç«¯ç‚¹æš´éœ²å‡ºæ¥ã€‚</p> <p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡æ³¨å…¥ ApplicationAvailability æ¥å£åˆ°æˆ‘ä»¬è‡ªå·±çš„ bean ä¸­æ¥è·å–å¯ç”¨æ€§çŠ¶æ€ä¿¡æ¯ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>@RestController
@SpringBootApplication
public class NovelApplication {

    private final ApplicationAvailability applicationAvailability;

    public NovelApplication(ApplicationAvailability applicationAvailability) {
        this.applicationAvailability = applicationAvailability;
    }

    @RequestMapping(&quot;/state&quot;)
    String state() {
        return &quot;æ´»è·ƒçŠ¶æ€ï¼š&quot; + applicationAvailability.getLivenessState()
                + &quot;ï¼Œå°±ç»ªçŠ¶æ€ï¼š&quot; + applicationAvailability.getReadinessState();
    }

    public static void main(String[] args) {
        SpringApplication.run(NovelApplication.class, args);
    }

}
</code></pre></div><p>è®¿é—® localhost:8080/state å¾—åˆ°ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>æ´»è·ƒçŠ¶æ€ï¼šCORRECTï¼Œå°±ç»ªçŠ¶æ€ï¼šACCEPTING_TRAFFIC
</code></pre></div><p>åº”ç”¨ç¨‹åºçš„ Liveness çŠ¶æ€è¡¨æ˜å…¶å†…éƒ¨æ˜¯å¦å…è®¸å…¶æ­£å¸¸å·¥ä½œæˆ–è€…æ˜¯å¦ä»é”™è¯¯ä¸­è‡ªè¡Œæ¢å¤ã€‚ä¸€ä¸ª BROKEN Liveness çŠ¶æ€æ„å‘³ç€åº”ç”¨ç¨‹åºå¤„äºæ— æ³•æ¢å¤çš„çŠ¶æ€ï¼ŒåŸºç¡€è®¾æ–½åº”è¯¥é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºã€‚</p> <p>ä¸€èˆ¬æ¥è¯´ï¼ŒLiveness çŠ¶æ€ä¸åº”åŸºäºå¤–éƒ¨æ£€æŸ¥ï¼Œå¦‚æœè¿™æ ·åšçš„è¯ï¼Œä¸€ä¸ªå¤±è´¥çš„å¤–éƒ¨ç³»ç»Ÿï¼ˆæ•°æ®åº“ã€Web APIã€å¤–éƒ¨ç¼“å­˜ç­‰ï¼‰å°†è§¦å‘å¤§è§„æ¨¡é‡å¯å’Œè·¨å¹³å°çš„çº§è”æ•…éšœã€‚</p> <p>åº”ç”¨ç¨‹åºçš„å°±ç»ªçŠ¶æ€è¡¨æ˜åº”ç”¨ç¨‹åºæ˜¯å¦å·²å‡†å¤‡å¥½å¤„ç†æµé‡ã€‚å¤±è´¥çš„å°±ç»ªçŠ¶æ€å‘Šè¯‰å¹³å°ç°åœ¨ä¸åº”è¯¥å°†æµé‡è·¯ç”±åˆ°åº”ç”¨ç¨‹åºã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨åº”ç”¨å¯åŠ¨æœŸé—´æ­£åœ¨å¤„ç† CommandLineRunner å’Œ ApplicationRunner ç»„ä»¶ï¼Œæˆ–è€…åœ¨åº”ç”¨ç¨‹åºå¤ªå¿™è€Œæ— æ³•è·å¾—é¢å¤–æµé‡çš„ä»»ä½•æ—¶åˆ»ã€‚</p> <p>ä¸€æ—¦å¤„ç†å®Œæˆ CommandLineRunner å’Œ ApplicationRunner ç»„ä»¶ï¼Œå°±è®¤ä¸ºåº”ç”¨ç¨‹åºå·²å‡†å¤‡å°±ç»ªã€‚</p> <p>å¦‚æœæˆ‘ä»¬æœ‰ç¨‹åºå¯åŠ¨æ—¶ä»»åŠ¡è¦æ‰§è¡Œï¼Œåº”è¯¥ç”± CommandLineRunner å’Œ ApplicationRunner ç»„ä»¶æ¥æ‰§è¡Œè€Œä¸æ˜¯ä½¿ç”¨ç±»ä¼¼ @PostConstruct æ³¨è§£çš„ Spring ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>@Bean
public CommandLineRunner commandLineRunner(){
    return args -&gt; log.info(&quot;åœ¨æ­¤æ‰§è¡Œä»»åŠ¡ç¨‹åºå¯åŠ¨æ—¶ä»»åŠ¡ï¼&quot;);
}
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ @EventListener æ³¨è§£æ¥ç›‘å¬çŠ¶æ€æ›´æ–°äº‹ä»¶ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>@EventListener
public void onStateChange(AvailabilityChangeEvent&lt;ReadinessState&gt; event) {
    log.info(&quot;åº”ç”¨ç¨‹åºå°±ç»ªçŠ¶æ€æ”¹å˜å•¦ï¼æœ€æ–°çŠ¶æ€ä¸º{}&quot;,event.getState());
    switch (event.getState()) {
        case ACCEPTING_TRAFFIC:
            // do something
            break;
        case REFUSING_TRAFFIC:
            // do something
            break;
    }
}
</code></pre></div><p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨åº”ç”¨ä¸­æ–­ä¸”æ— æ³•æ¢å¤æ—¶æ›´æ–°åº”ç”¨çš„çŠ¶æ€ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>@Component
public class MyLocalCacheVerifier {

    private final ApplicationEventPublisher eventPublisher;

    public MyLocalCacheVerifier(ApplicationEventPublisher eventPublisher) {
        this.eventPublisher = eventPublisher;
    }

    public void checkLocalCache() {
        try {
            // ...
        }
        catch (CacheCompletelyBrokenException ex) {
            AvailabilityChangeEvent.publish(this.eventPublisher, ex, LivenessState.BROKEN);
        }
    }

}
</code></pre></div><h3 id="äº‹ä»¶å’Œç›‘å¬å™¨"><a href="#äº‹ä»¶å’Œç›‘å¬å™¨" class="header-anchor">#</a> äº‹ä»¶å’Œç›‘å¬å™¨</h3> <p>é™¤äº†å¸¸è§çš„ Spring Framework äº‹ä»¶ï¼Œæ¯”å¦‚ ContextRefreshedEventï¼ŒSpringApplication ä¹Ÿå‘å¸ƒäº†ä¸€äº›é¢å¤–çš„åº”ç”¨äº‹ä»¶ã€‚</p> <p>æŸäº›äº‹ä»¶æ˜¯åœ¨ ApplicationContext åˆ›å»ºä¹‹å‰è§¦å‘çš„ï¼Œä¸èƒ½åœ¨è¿™äº›äº‹ä»¶ä¸Šå°†ç›‘å¬å™¨æ³¨å†Œä¸º @Beanï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ SpringApplication.addListeners(â€¦â€‹) æ–¹æ³•æˆ– SpringApplicationBuilder.listeners(â€¦â€‹) æ–¹æ³•æ³¨å†Œå®ƒä»¬çš„ç›‘å¬å™¨ã€‚</p> <p>å¦‚æœæƒ³è‡ªåŠ¨æ³¨å†Œè¿™äº›ç›‘å¬å™¨ï¼Œæ— è®ºåº”ç”¨åˆ›å»ºçš„æ–¹å¼å¦‚ä½•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ª META-INF/spring.factories æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æ–‡ä»¶ä¸­é€šè¿‡ org.springframework.context.ApplicationListener ä½œä¸º key æ¥å¼•ç”¨å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>org.springframework.context.ApplicationListener=com.example.project.MyListener
</code></pre></div><p>åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼Œåº”ç”¨äº‹ä»¶æŒ‰ç…§ä»¥ä¸‹é¡ºåºå‘é€ï¼š</p> <ol><li><p>ApplicationStartingEventï¼šåœ¨åº”ç”¨å¼€å§‹è¿è¡Œï¼Œé™¤äº†ç›‘å¬å™¨å’Œåˆå§‹åŒ–ç¨‹åºæ³¨å†Œçš„ä»»ä½•å¤„ç†ä¹‹å‰å‘é€ã€‚</p></li> <li><p>ApplicationEnvironmentPreparedEventï¼šåœ¨ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨çš„ç¯å¢ƒå·²ç»å‡†å¤‡å¥½ï¼Œä¸Šä¸‹æ–‡åˆ›å»ºä¹‹å‰å‘é€ã€‚</p></li> <li><p>ApplicationContextInitializedEventï¼šåœ¨ ApplicationContext å‡†å¤‡å¥½ï¼Œ ApplicationContextInitializers è¢«è°ƒç”¨ï¼Œbean å®šä¹‰åŠ è½½ä¹‹å‰å‘é€ã€‚</p></li> <li><p>ApplicationPreparedEventï¼šåœ¨ bean å®šä¹‰åŠ è½½ä¹‹åï¼Œä¸Šä¸‹æ–‡ refresh ä¹‹å‰å‘é€ã€‚</p></li> <li><p>ApplicationStartedEventï¼šåœ¨ä¸Šä¸‹æ–‡ refresh ä¹‹åï¼Œä»»ä½• CommandLineRunner å’Œ ApplicationRunner ç»„ä»¶è°ƒç”¨ä¹‹å‰å‘é€ã€‚</p></li> <li><p>AvailabilityChangeEventï¼šç´§éšå…¶åç«‹å³å‘é€ä¸€ä¸ªå¸¦æœ‰ LivenessState.CORRECT çš„äº‹ä»¶ï¼Œè¡¨æ˜åº”ç”¨ç¨‹åºæ˜¯æ´»è·ƒçš„ã€‚</p></li> <li><p>ApplicationReadyEventï¼šåœ¨ä»»æ„ CommandLineRunner å’Œ ApplicationRunner ç»„ä»¶è°ƒç”¨ä¹‹åå‘é€ã€‚</p></li> <li><p>AvailabilityChangeEventï¼šç´§éšå…¶åç«‹å³å‘é€ä¸€ä¸ªå¸¦æœ‰ ReadinessState.ACCEPTING_TRAFFIC çš„äº‹ä»¶ï¼Œè¡¨ç¤ºåº”ç”¨ç¨‹åºå·²å‡†å¤‡å¥½ä¸ºè¯·æ±‚æä¾›æœåŠ¡ã€‚</p></li> <li><p>ApplicationFailedEventï¼šå¯åŠ¨æ—¶å‡ºç°å¼‚å¸¸åˆ™å‘é€ã€‚</p></li></ol> <p>åœ¨å†…éƒ¨ï¼ŒSpring Boot ä½¿ç”¨äº‹ä»¶æ¥å¤„ç†å„ç§ä»»åŠ¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹ä»¶ç›‘å¬å™¨ä¸åº”è¯¥è¿è¡Œå¯èƒ½å†—é•¿çš„ä»»åŠ¡ï¼Œå› ä¸ºå®ƒä»¬åœ¨åŒä¸€çº¿ç¨‹ä¸­æ‰§è¡Œã€‚åº”è¯¥è€ƒè™‘ä½¿ç”¨ CommandLineRunner å’Œ ApplicationRunnerã€‚</p> <p>åº”ç”¨äº‹ä»¶æ˜¯ä½¿ç”¨ Spring Framework çš„äº‹ä»¶å‘å¸ƒæœºåˆ¶å‘é€çš„ã€‚è¯¥å‘å¸ƒæœºåˆ¶çš„ä¸€éƒ¨åˆ†ç¡®ä¿äº†åœ¨å­ä¸Šä¸‹æ–‡ä¸­å‘å¸ƒç»™ç›‘å¬å™¨çš„äº‹ä»¶ä¹Ÿä¼šå‘å¸ƒç»™ä»»ä½•ç¥–å…ˆä¸Šä¸‹æ–‡ä¸­çš„ç›‘å¬å™¨ã€‚å› æ­¤ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä½¿ç”¨äº†æœ‰å±‚æ¬¡ç»“æ„çš„SpringApplication å®ä¾‹ï¼ŒåŒä¸€ä¸ªç›‘å¬å™¨å¯èƒ½ä¼šæ”¶åˆ°ç›¸åŒåº”ç”¨äº‹ä»¶ç±»å‹çš„å¤šä¸ªå®ä¾‹ã€‚ä¸ºäº†è®©ç›‘å¬å™¨åŒºåˆ†çˆ¶å­ä¸Šä¸‹æ–‡çš„äº‹ä»¶ï¼Œç›‘å¬å™¨åº”è¯¥æ³¨å…¥å…¶åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œç„¶åå°†æ³¨å…¥çš„ä¸Šä¸‹æ–‡ä¸äº‹ä»¶çš„ä¸Šä¸‹æ–‡è¿›è¡Œæ¯”è¾ƒã€‚å¯ä»¥é€šè¿‡å®ç° ApplicationContextAware æ¥å£æ¥æ³¨å…¥ä¸Šä¸‹æ–‡ï¼Œæˆ–è€…å¦‚æœç›‘å¬å™¨æ˜¯ä¸€ä¸ª Spring beanï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ @Autowired æ³¨è§£æ¥æ³¨å…¥ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>private static class MyAppListener implements ApplicationListener&lt;ApplicationPreparedEvent&gt;, ApplicationContextAware {

    @Autowired
    private ApplicationContext applicationContext;

    @Override
    public void onApplicationEvent(ApplicationPreparedEvent event) {

        if(event.getApplicationContext() == applicationContext){
            
            // do something
            
        }

    }

    @Override
    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {

        this.applicationContext = applicationContext;

    }
    
}
</code></pre></div><h3 id="web-ç¯å¢ƒ"><a href="#web-ç¯å¢ƒ" class="header-anchor">#</a> Web ç¯å¢ƒ</h3> <p>SpringApplication å°è¯•åˆ›å»ºæ­£ç¡®ç±»å‹çš„ ApplicationContextï¼Œç”¨äºç¡®å®š WebApplicationType çš„ç®—æ³•å¦‚ä¸‹:</p> <ul><li><p>å¦‚æœå­˜åœ¨ Spring MVCï¼Œä¼šåˆ›å»º AnnotationConfigServletWebServerApplicationContext</p></li> <li><p>å¦‚æœä¸å­˜åœ¨ Spring MVC ä½†æ˜¯å­˜åœ¨ Spring WebFluxï¼Œä¼šåˆ›å»º AnnotationConfigReactiveWebServerApplicationContext</p></li> <li><p>å…¶å®ƒæƒ…å†µä¼šåˆ›å»º AnnotationConfigApplicationContext</p></li></ul> <p>è¿™æ„å‘³ç€å¦‚æœåœ¨åŒä¸€ä¸ªåº”ç”¨ä¸­ä½¿ç”¨ Spring MVC å’Œæ¥è‡ª Spring WebFlux çš„æ–° WebClientï¼Œé»˜è®¤æƒ…å†µä¸‹å°†ä½¿ç”¨ Spring MVCã€‚å¯ä»¥é€šè¿‡è°ƒç”¨ setWebApplicationType(WebApplicationType) æ–¹æ³•æ¥æ”¹å˜å®ƒã€‚</p> <p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ setApplicationContextClass(â€¦â€‹) æ–¹æ³•æ¥å®Œå…¨æ§åˆ¶ä½¿ç”¨çš„ ApplicationContext ç±»å‹ã€‚</p> <p>åœ¨ JUnit æµ‹è¯•ä¸­ä½¿ç”¨ SpringApplication æ—¶ï¼Œé€šå¸¸éœ€è¦è°ƒç”¨ setWebApplicationType(WebApplicationType.NONE) æ–¹æ³•ã€‚</p> <h3 id="è®¿é—®åº”ç”¨ç¨‹åºå‚æ•°"><a href="#è®¿é—®åº”ç”¨ç¨‹åºå‚æ•°" class="header-anchor">#</a> è®¿é—®åº”ç”¨ç¨‹åºå‚æ•°</h3> <p>å¦‚æœéœ€è¦è®¿é—®ä¼ é€’ç»™ SpringApplication.run(â€¦â€‹) çš„åº”ç”¨ç¨‹åºå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨å…¥ä¸€ä¸ª org.springframework.boot.ApplicationArguments beanã€‚è¯¥ ApplicationArguments æ¥å£æä¾›å¯¹åŸå§‹ String[] å‚æ•°ä»¥åŠè§£æåçš„ option å’Œ non-option å‚æ•°çš„è®¿é—®ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>@Component
public class MyBean {

    public MyBean(ApplicationArguments args) {
        boolean debug = args.containsOption(&quot;debug&quot;);
        List&lt;String&gt; files = args.getNonOptionArgs();
        if (debug) {
            System.out.println(files);
        }
        // if run with &quot;--debug logfile.txt&quot; prints [&quot;logfile.txt&quot;]
    }

}
</code></pre></div><p>Spring Boot è¿˜åœ¨ Spring ç¯å¢ƒä¸­æ³¨å†Œäº†ä¸€ä¸ª CommandLinePropertySourceã€‚è¿™ä¸ªå¯ä»¥è®©æˆ‘ä»¬ä½¿ç”¨ @Value æ³¨è§£æ³¨å…¥å•ä¸ªåº”ç”¨ç¨‹åºå‚æ•°ã€‚</p> <h3 id="å¯åŠ¨æ—¶ä»»åŠ¡"><a href="#å¯åŠ¨æ—¶ä»»åŠ¡" class="header-anchor">#</a> å¯åŠ¨æ—¶ä»»åŠ¡</h3> <p>å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ SpringApplication å¯åŠ¨åè¿è¡ŒæŸäº›ç‰¹å®šä»£ç ï¼Œå¯ä»¥é€šè¿‡å®ç° ApplicationRunner æˆ– CommandLineRunner æ¥å£ã€‚è¿™ä¸¤ä¸ªæ¥å£ä»¥ç›¸åŒçš„æ–¹å¼å·¥ä½œå¹¶æä¾›ä¸€ä¸ªrunæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨ SpringApplication.run(â€¦â€‹) å®Œæˆä¹‹å‰è°ƒç”¨ã€‚è¿™ç§æ–¹å¼éå¸¸é€‚åˆåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨ä¹‹åå¼€å§‹æ¥å—æµé‡ä¹‹å‰è¿è¡Œçš„ä»»åŠ¡ã€‚</p> <p>CommandLineRunner æ¥å£æä¾›ä¸€ç§ä»¥å­—ç¬¦ä¸²æ•°ç»„å½¢å¼æ¥è®¿é—®åº”ç”¨ç¨‹åºå‚æ•°çš„æ–¹å¼ï¼Œè€Œ ApplicationRunner ä½¿ç”¨å‰é¢è®¨è®ºçš„ ApplicationArguments æ¥å£æ¥è®¿é—®ã€‚</p> <p>å¦‚æœå®šä¹‰äº†å¿…é¡»æŒ‰ç‰¹å®šé¡ºåºè°ƒç”¨çš„å¤šä¸ª CommandLineRunner æˆ– ApplicationRunner beansï¼Œå¯ä»¥å¦å¤–å®ç° ApplicationRunnerorg.springframework.core.Ordered æ¥å£æˆ–ä½¿ç”¨ org.springframework.core.annotation.Order æ³¨è§£ã€‚</p> <h3 id="åº”ç”¨ç¨‹åºé€€å‡º"><a href="#åº”ç”¨ç¨‹åºé€€å‡º" class="header-anchor">#</a> åº”ç”¨ç¨‹åºé€€å‡º</h3> <p>æ¯ä¸ª SpringApplication éƒ½ä¼šå‘ JVM æ³¨å†Œä¸€ä¸ªå…³é—­é’©å­ï¼Œä»¥ç¡®ä¿ ApplicationContext åœ¨é€€å‡ºæ—¶æ­£å¸¸å…³é—­ï¼Œæ‰€æœ‰æ ‡å‡†çš„ Spring ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼ˆä¾‹å¦‚ DisposableBean æ¥å£æˆ– @PreDestroy æ³¨è§£ï¼‰éƒ½å¯ä»¥ä½¿ç”¨ã€‚å¦‚æœå¸Œæœ›åœ¨è°ƒç”¨ SpringApplication.exit() æ—¶è¿”å›ç‰¹å®šçš„é€€å‡ºç ï¼Œå¯ä»¥æ³¨å†Œä¸€ä¸ªå®ç° org.springframework.boot.ExitCodeGenerator æ¥å£çš„ beanã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>@SpringBootApplication
public class NovelApplication {

    @Bean
    public ExitCodeGenerator exitCodeGenerator() {
        return () -&gt; 42;
    }

    public static void main(String[] args) {
        System.exit(SpringApplication.exit(SpringApplication.run(NovelApplication.class, args)));
    }

}
</code></pre></div><p>ExitCodeGenerator æ¥å£å¯èƒ½ä¼šè¢«å¼‚å¸¸å®ç°. å½“é‡åˆ°è¿™æ ·çš„å¼‚å¸¸æ—¶, Spring Boot ä¼šè¿”å› getExitCode() å®ç°æ–¹æ³•æä¾›çš„é€€å‡ºç ã€‚</p> <p>å¦‚æœæœ‰å¤šä¸ª ExitCodeGeneratorï¼Œåˆ™ä½¿ç”¨ç¬¬ä¸€ä¸ªç”Ÿæˆçš„éé›¶é€€å‡ºç ã€‚è¦æ§åˆ¶ç”Ÿæˆå™¨è°ƒç”¨çš„é¡ºåºï¼Œå¯ä»¥å¦å¤–å®ç° org.springframework.core.Ordered æ¥å£æˆ–ä½¿ç”¨ org.springframework.core.annotation.Order æ³¨è§£ã€‚</p> <h2 id="é…ç½®"><a href="#é…ç½®" class="header-anchor">#</a> é…ç½®</h2> <p>Spring Boot å…è®¸æˆ‘ä»¬å°†é…ç½®å¤–éƒ¨åŒ–ï¼Œä»¥ä¾¿å¯ä»¥åœ¨ä¸åŒçš„ç¯å¢ƒä¸­ä½¿ç”¨ç›¸åŒçš„åº”ç”¨ç¨‹åºä»£ç ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒ…æ‹¬ Java properties æ–‡ä»¶ã€YAML æ–‡ä»¶ã€ç¯å¢ƒå˜é‡å’Œå‘½ä»¤è¡Œå‚æ•°åœ¨å†…çš„å„ç§å¤–éƒ¨é…ç½®æºã€‚</p> <p>å¯¹äºé…ç½®å±æ€§å€¼çš„è®¿é—®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @Value æ³¨è§£ç›´æ¥æ³¨å…¥è¿›æˆ‘ä»¬çš„ Spring beansã€é€šè¿‡ Spring çš„ Environment æ¥å£è®¿é—®æˆ–é€šè¿‡ @ConfigurationProperties æ³¨è§£ç»‘å®šåˆ°ç»“æ„åŒ–å¯¹è±¡ä¸Šã€‚</p> <p>ä¾‹å¦‚æˆ‘ä»¬åœ¨ properties é…ç½®æ–‡ä»¶ä¸­æ·»åŠ äº†å¦‚ä¸‹çš„æ•°æ®æºé…ç½®ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>spring.datasource.url=jdbc:mysql://127.0.0.1:3306/novel?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai
spring.datasource.username=test
spring.datasource.password=test123456
</code></pre></div><p>åœ¨ Spring bean ä¸­ä½¿ç”¨ @Value æ³¨è§£æ³¨å…¥çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>@Value(&quot;${spring.datasource.url}&quot;)
private String url;

@Value(&quot;${spring.datasource.username}&quot;)
private String username;

@Value(&quot;${spring.datasource.password}&quot;)
private String password;
</code></pre></div><p>é€šè¿‡ Environment æ¥å£è®¿é—®çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>@Bean
public CommandLineRunner commandLineRunner(ApplicationContext ctx) {

    return args -&gt; {

        Environment environment = ctx.getEnvironment();
        String url = environment.getProperty(&quot;spring.datasource.url&quot;);
        String username = environment.getProperty(&quot;spring.datasource.username&quot;);
        String password = environment.getProperty(&quot;spring.datasource.password&quot;);
        log.info(&quot;url:{},username:{},password:{}&quot;,url,username,password);

    };

}
</code></pre></div><p>é€šè¿‡ @ConfigurationProperties æ³¨è§£ç»‘å®šçš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)
public class DataSourceProperties {

    private String url;

    private String username;

    private String password;

    // getter method

    // setter method
}
</code></pre></div><p>Spring Boot ä½¿ç”¨äº†ä¸€ç§ç‰¹å®šçš„å±æ€§æºåŠ è½½é¡ºåºï¼Œæ—¨åœ¨å…è®¸çµæ´»åœ°è¦†ç›–å±æ€§å€¼ã€‚æŒ‰ç…§ä»¥ä¸‹é¡ºåºåŠ è½½ï¼ˆåé¢çš„ä¼šè¦†ç›–å‰é¢çš„ï¼‰ï¼š</p> <ol><li><p>ç”± SpringApplication.setDefaultProperties è®¾ç½®çš„é»˜è®¤å±æ€§ã€‚</p></li> <li><p>@Configuration ç±»ä¸Šçš„ @PropertySource æ³¨è§£ã€‚æ³¨æ„ï¼Œåœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡åˆ·æ–°ä¹‹å‰ï¼Œä¸ä¼šå°†æ­¤ç±»å±æ€§æºæ·»åŠ åˆ° Environment ä¸­ã€‚æ‰€ä»¥ä¸èƒ½å¤Ÿé…ç½® logging.* å’Œ spring.main.* è¿™ç±»åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡åˆ·æ–°ä¹‹å‰å°±è¯»å–çš„å±æ€§ã€‚</p></li> <li><p>é…ç½®æ–‡ä»¶é…ç½®çš„æ•°æ®ï¼ˆä¾‹å¦‚ application.properties æ–‡ä»¶ï¼‰ã€‚</p></li> <li><p>ä»…å…·æœ‰ random.* å±æ€§çš„ RandomValuePropertySourceã€‚</p></li> <li><p>æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚</p></li> <li><p>Java ç³»ç»Ÿå±æ€§ ( System.getProperties())ã€‚</p></li> <li><p>æ¥è‡ª java:comp/env çš„ JNDI å±æ€§.</p></li> <li><p>ServletContext åˆå§‹åŒ–å‚æ•°ã€‚</p></li> <li><p>ServletConfig åˆå§‹åŒ–å‚æ•°ã€‚</p></li> <li><p>æ¥è‡ªäº SPRING_APPLICATION_JSONï¼ˆåµŒå…¥åœ¨ç¯å¢ƒå˜é‡æˆ–ç³»ç»Ÿå±æ€§ä¸­çš„å†…è” JSONï¼‰çš„å±æ€§ã€‚</p></li> <li><p>å‘½ä»¤è¡Œå‚æ•°ã€‚</p></li> <li><p>æµ‹è¯•ä¸­çš„ properties å±æ€§ã€‚å¯ç”¨äº @SpringBootTest å’Œæµ‹è¯•ç¨‹åºç‰¹å®šéƒ¨åˆ†çš„æµ‹è¯•æ³¨è§£ã€‚</p></li> <li><p>æµ‹è¯•ä¸­çš„ @TestPropertySource æ³¨è§£ã€‚</p></li> <li><p>å½“ devtools å¯ç”¨æ—¶ï¼Œåœ¨ $HOME/.config/spring-bootç›®å½•ä¸­çš„è®¾ç½®çš„å…¨å±€å±æ€§ã€‚</p></li></ol> <p>é…ç½®æ–‡ä»¶çš„å±æ€§æŒ‰ä»¥ä¸‹é¡ºåºåŠ è½½ï¼š</p> <ol><li><p>æ‰“åŒ…åœ¨ jar ä¸­çš„åº”ç”¨ç¨‹åºå±æ€§ï¼ˆapplication.properties æˆ– YAML å˜ä½“ï¼‰ã€‚</p></li> <li><p>æ‰“åŒ…åœ¨ jar ä¸­ç‰¹å®šé…ç½®çš„åº”ç”¨ç¨‹åºå±æ€§ï¼ˆapplication-{profile}.properties æˆ– YAML å˜ä½“ï¼‰ã€‚</p></li> <li><p>æ‰“åŒ…åœ¨ jar ä¹‹å¤–çš„åº”ç”¨ç¨‹åºå±æ€§ï¼ˆapplication.properties æˆ– YAML å˜ä½“ï¼‰ã€‚</p></li> <li><p>æ‰“åŒ…çš„ jar ä¹‹å¤–ç‰¹å®šé…ç½®çš„åº”ç”¨ç¨‹åºå±æ€§ï¼ˆapplication-{profile}.properties æˆ– YAML å˜ä½“ï¼‰ã€‚</p></li></ol> <p><strong>æ³¨ï¼šå»ºè®®åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨åŒä¸€ç§æ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚å¦‚æœåœ¨åŒä¸€ä½ç½®åŒæ—¶æœ‰ .properties å’Œ .yml æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼Œåˆ™ä¼˜å…ˆè€ƒè™‘ .propertiesã€‚</strong></p> <h3 id="å‘½ä»¤è¡Œå±æ€§"><a href="#å‘½ä»¤è¡Œå±æ€§" class="header-anchor">#</a> å‘½ä»¤è¡Œå±æ€§</h3> <p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringApplication å°†ä»»æ„çš„å‘½ä»¤è¡Œå‚æ•°ï¼ˆä»¥ -- å¼€å¤´ï¼Œä¾‹å¦‚ --server.port=80ï¼‰è½¬æ¢æˆä¸€ä¸ª property å¹¶æ·»åŠ åˆ° Spring Environmentã€‚å‘½ä»¤è¡Œå±æ€§å§‹ç»ˆä¼˜å…ˆäºåŸºäºæ–‡ä»¶çš„å±æ€§æºã€‚</p> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ SpringApplication.setAddCommandLineProperties(false) æ–¹æ³•æ¥ç¦ç”¨å‘½ä»¤è¡Œå‚æ•°ã€‚</p> <h3 id="json-åº”ç”¨å±æ€§"><a href="#json-åº”ç”¨å±æ€§" class="header-anchor">#</a> JSON åº”ç”¨å±æ€§</h3> <p>ç¯å¢ƒå˜é‡å’Œç³»ç»Ÿå±æ€§ç»å¸¸æœ‰ç€æŸäº›å±æ€§åç§°ä¸èƒ½ä½¿ç”¨çš„é™åˆ¶ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒSpring Boot å…è®¸å°†å±æ€§å—ç¼–ç ä¸ºå•ä¸ª JSON ç»“æ„ã€‚</p> <p>å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œä»»æ„çš„ spring.application.json æˆ– SPRING_APPLICATION_JSON å±æ€§éƒ½å°†è¢«è§£æå¹¶æ·»åŠ åˆ° Environmentã€‚</p> <p>ä¾‹å¦‚ï¼ŒSPRING_APPLICATION_JSON å¯ä»¥åœ¨ UN*X shell çš„å‘½ä»¤è¡Œä¸­å°†å±æ€§ä½œä¸ºç¯å¢ƒå˜é‡æä¾›ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>$ SPRING_APPLICATION_JSON='{&quot;my&quot;:{&quot;name&quot;:&quot;test&quot;}}' java -jar myapp.jar
</code></pre></div><p>æœ€ç»ˆï¼Œæˆ‘ä»¬åœ¨ Spring çš„ Environment ä¸­å¾—åˆ° my.name=test çš„ç»“æœã€‚</p> <p>åŒæ ·çš„ JSON ä¹Ÿå¯ä»¥ä½œä¸ºç³»ç»Ÿå±æ€§æä¾›ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -Dspring.application.json='{&quot;my&quot;:{&quot;name&quot;:&quot;test&quot;}}' -jar myapp.jar
</code></pre></div><p>æˆ–è€…å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æä¾› JSONï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -jar myapp.jar --spring.application.json='{&quot;my&quot;:{&quot;name&quot;:&quot;test&quot;}}'
</code></pre></div><p><strong>æ³¨ï¼šè™½ç„¶æ¥è‡ª JSON ä¸­çš„ null å€¼ä¼šè¢«æ·»åŠ åˆ°ç”Ÿæˆçš„å±æ€§æºä¸­ï¼Œä½† PropertySourcesPropertyResolver å°† null è§†ä¸ºç¼ºå¤±å€¼ï¼Œä¸ä¼šä½¿ç”¨ null å€¼æ¥è¦†ç›–æ¥è‡ªä½ä¼˜å…ˆçº§å±æ€§æºçš„å±æ€§ã€‚</strong></p> <h3 id="å¤–éƒ¨åº”ç”¨å±æ€§"><a href="#å¤–éƒ¨åº”ç”¨å±æ€§" class="header-anchor">#</a> å¤–éƒ¨åº”ç”¨å±æ€§</h3> <p>å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒSpring Boot å°†è‡ªåŠ¨ä»ä»¥ä¸‹ä½ç½®æŸ¥æ‰¾å¹¶åŠ è½½ application.properties æˆ– application.yaml é…ç½®æ–‡ä»¶ã€‚</p> <ol><li><p>ä» classpath ç±»è·¯å¾„</p> <p>a. ç±»è·¯å¾„æ ¹åŒ…</p> <p>b. ç±»è·¯å¾„ä¸‹çš„ /config åŒ…</p></li> <li><p>ä»å½“å‰ç›®å½•</p> <p>a. å½“å‰ç›®å½•</p> <p>b. å½“å‰ç›®å½•ä¸­çš„ /config å­ç›®å½•</p> <p>c. /config å­ç›®å½•çš„ç›´æ¥å­ç›®å½•</p></li></ol> <p>åŠ è½½æ–‡ä»¶ä¸­çš„æ–‡æ¡£ä½œä¸º PropertySources è¢«æ·»åŠ åˆ° Spring Environment ä¸­ï¼Œåé¢çš„å±æ€§å€¼ä¼šè¦†ç›–å‰é¢çš„ã€‚</p> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®š environment å±æ€§ spring.config.name æ¥æ›´æ”¹ application é…ç½®æ–‡ä»¶åä¸ºå¦ä¸€ä¸ªæ–‡ä»¶åã€‚ä¾‹å¦‚ï¼Œè¦æŸ¥æ‰¾ novel.properties å’Œ novel.yaml é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è¿è¡Œåº”ç”¨ç¨‹åºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -jar novel.jar --spring.config.name=novel
</code></pre></div><p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨ environment å±æ€§ spring.config.location æ¥å¼•ç”¨ä¸€ä¸ªç¡®åˆ‡çš„è·¯å¾„ã€‚è¯¥å±æ€§æ¥å—ä»¥é€—å·åˆ†éš”çš„ä¸€ä¸ªæˆ–å¤šä¸ªè¦æ£€æŸ¥çš„è·¯å¾„åˆ—è¡¨ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -jar novel.jar --spring.config.location=\
    optional:classpath:/default.properties,\
    optional:classpath:/override.properties

</code></pre></div><p>optional è¡¨ç¤ºè¯¥ä½ç½®æ˜¯å¯é€‰çš„ï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦å­˜åœ¨ã€‚</p> <p>å¦‚æœæˆ‘ä»¬æƒ³æ·»åŠ å…¶å®ƒè·¯å¾„ï¼Œè€Œä¸æ˜¯æ›¿æ¢å®ƒä»¬ï¼Œå¯ä»¥ä½¿ç”¨ spring.config.additional-locationï¼Œä»å…¶ä»–ä½ç½®åŠ è½½çš„å±æ€§å¯ä»¥è¦†ç›–é»˜è®¤è·¯å¾„ä¸­çš„å±æ€§ã€‚</p> <p><strong>æ³¨ï¼šspring.config.name, spring.config.location, å’Œspring.config.additional-location å¾ˆæ—©å°±ç”¨äºç¡®å®šè¦åŠ è½½å“ªäº›æ–‡ä»¶ã€‚å®ƒä»¬å¿…é¡»å®šä¹‰ä¸º environment å±æ€§ï¼ˆé€šå¸¸æ˜¯æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡ã€ç³»ç»Ÿå±æ€§æˆ–å‘½ä»¤è¡Œå‚æ•°ï¼‰ã€‚</strong></p> <p>å¦‚æœ spring.config.location åŒ…å«ç›®å½•ï¼ˆè€Œä¸æ˜¯æ–‡ä»¶ï¼‰ï¼Œåº”è¯¥ä»¥ / ç»“å°¾ï¼ŒåŠ è½½ä¹‹å‰å®ƒä»¬ä¼šåŠ ä¸Šä» spring.config.name å¾—åˆ°çš„æ–‡ä»¶åï¼Œè€Œ spring.config.location ä¸­æŒ‡å®šçš„æ–‡ä»¶ä¼šç›´æ¥è¢«å¯¼å…¥ã€‚</p> <h4 id="å¯é€‰è·¯å¾„"><a href="#å¯é€‰è·¯å¾„" class="header-anchor">#</a> å¯é€‰è·¯å¾„</h4> <p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æŒ‡å®šçš„é…ç½®æ–‡ä»¶ä½ç½®ä¸å­˜åœ¨æ—¶ï¼ŒSpring Boot ä¼šæŠ›å‡ºä¸€ä¸ª ConfigDataLocationNotFoundException å¹¶ä¸”åº”ç”¨ç¨‹åºå¯åŠ¨å¤±è´¥ã€‚</p> <p>å¦‚æœæˆ‘ä»¬æƒ³æŒ‡å®šä¸€ä¸ªè·¯å¾„ï¼Œåˆä¸ä»‹æ„å®ƒæ˜¯å¦å­˜åœ¨ï¼Œå¯ä»¥ä½¿ç”¨ optional: å‰ç¼€ã€‚æˆ‘ä»¬å¯ä»¥å°†æ­¤å‰ç¼€ä¸ spring.config.location å’Œ spring.config.additional-location å±æ€§ä»¥åŠ spring.config.import å£°æ˜ä¸€èµ·ä½¿ç”¨ã€‚</p> <p>ä¾‹å¦‚ï¼Œspring.config.import çš„å€¼ optional:file:./myconfig.properties å…è®¸åº”ç”¨ç¨‹åºå³ä½¿åœ¨ myconfig.properties æ–‡ä»¶ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å¯åŠ¨ã€‚</p> <p>å¦‚æœæˆ‘ä»¬æƒ³å¿½ç•¥æ‰€æœ‰çš„ ConfigDataLocationNotFoundExceptionsï¼Œç»§ç»­å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨ spring.config.on-not-found å±æ€§ã€‚é€šè¿‡ SpringApplication.setDefaultProperties(â€¦â€‹) æˆ–ä½¿ç”¨ä¸€ä¸ªç³»ç»Ÿ/ç¯å¢ƒå˜é‡å°†å€¼è®¾ç½®ä¸º ignoreã€‚</p> <h4 id="é€šé…ç¬¦è·¯å¾„"><a href="#é€šé…ç¬¦è·¯å¾„" class="header-anchor">#</a> é€šé…ç¬¦è·¯å¾„</h4> <p>å¦‚æœé…ç½®æ–‡ä»¶è·¯å¾„æœ€åä¸€ä¸ªè·¯å¾„æ®µä¸­åŒ…å« * çš„å­—ç¬¦ï¼Œå°±å¯ä»¥è¢«è§†ä¸ºé€šé…ç¬¦è·¯å¾„ã€‚åŠ è½½é…ç½®æ—¶ä¼šæ‰©å±•é€šé…ç¬¦ï¼Œä»¥ä¾¿åŒæ—¶æ£€æŸ¥ç›´æ¥å­ç›®å½•ã€‚å½“æœ‰å¤šä¸ªé…ç½®å±æ€§æ¥æºæ—¶ï¼Œé€šé…ç¬¦è·¯å¾„ç‰¹åˆ«æœ‰ç”¨ã€‚</p> <p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€äº› Redis é…ç½®å’Œä¸€äº› MySQL é…ç½®ï¼Œæˆ‘ä»¬å¸Œæœ›å°†è¿™ä¸¤ä¸ªé…ç½®åˆ†å¼€ï¼ŒåŒæ—¶è¦æ±‚å®ƒä»¬éƒ½å­˜åœ¨äºä¸€ä¸ªå«åš application.properties çš„æ–‡ä»¶ä¸­ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ä¸¤ä¸ªå•ç‹¬çš„ application.properties æ–‡ä»¶å®‰è£…åœ¨ä¸åŒçš„ä½ç½®ï¼Œä¾‹å¦‚ /config/redis/application.properties å’Œ /config/mysql/application.properties. åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šé…ç¬¦ä½ç½® config/*/ å°†å¯¼è‡´ä¸¤ä¸ªæ–‡ä»¶éƒ½è¢«å¤„ç†ã€‚</p> <p>Spring Boot é»˜è®¤æœç´¢ä½ç½®ä¸­åŒ…æ‹¬ config/*/ï¼Œjar å¤–éƒ¨ /config ç›®å½•ä¸­çš„æ‰€æœ‰å­ç›®å½•éƒ½ä¼šè¢«æœç´¢ã€‚</p> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ spring.config.location å’Œ spring.config.additional-location å±æ€§è®¾ç½®è‡ªå·±çš„é€šé…ç¬¦è·¯å¾„ã€‚</p> <p><strong>æ³¨ï¼šé€šé…ç¬¦è·¯å¾„å¿…é¡»åªåŒ…å«ä¸€ä¸ª <code>*</code> å¹¶ä»¥ <code>*/</code>ï¼ˆæœç´¢è·¯å¾„æ˜¯ç›®å½•ï¼‰ æˆ– <code>*/&lt;filename&gt;</code>ï¼ˆæœç´¢è·¯å¾„æ˜¯æ–‡ä»¶ï¼‰ç»“å°¾ï¼Œå¸¦æœ‰é€šé…ç¬¦çš„è·¯å¾„æŒ‰ç…§æ–‡ä»¶åç»å¯¹è·¯å¾„çš„å­—æ¯é¡ºåºæ’åºã€‚å¹¶ä¸”é€šé…ç¬¦è·¯å¾„ä»…é€‚ç”¨äºå¤–éƒ¨ç›®å½•ï¼Œä¸èƒ½åœ¨ classpath: ä¸­ä½¿ç”¨é€šé…ç¬¦ã€‚</strong></p> <h4 id="ç‰¹å®šé…ç½®å±æ€§æ–‡ä»¶"><a href="#ç‰¹å®šé…ç½®å±æ€§æ–‡ä»¶" class="header-anchor">#</a> ç‰¹å®šé…ç½®å±æ€§æ–‡ä»¶</h4> <p>é™¤äº† application å±æ€§æ–‡ä»¶ï¼ŒSpring Boot è¿˜ä½¿ç”¨å‘½åçº¦å®š application-{profile} æ¥åŠ è½½ç‰¹å®šé…ç½®çš„å±æ€§æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ¿€æ´»äº†ä¸€ä¸ªåä¸º prod çš„é…ç½®å¹¶ä¸”ä½¿ç”¨çš„æ˜¯ YAML é…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆ application.yml å’Œ application-prod.yml éƒ½ä¼šè¢«åŠ è½½ã€‚</p> <p>ç‰¹å®šé…ç½®æ–‡ä»¶çš„åŠ è½½è·¯å¾„å’Œæ ‡å‡†çš„ application.properties é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œç‰¹å®šé…ç½®æ–‡ä»¶çš„å±æ€§æ€»æ˜¯ä¼šè¦†ç›–éç‰¹å®šé…ç½®æ–‡ä»¶ã€‚å¦‚æœæŒ‡å®šäº†å¤šä¸ªç‰¹å®šé…ç½®æ–‡ä»¶ï¼Œåˆ™åº”ç”¨æœ€åè·èƒœç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ spring.profiles.active å±æ€§æŒ‡å®šäº†é…ç½®æ–‡ä»¶ prod,liveï¼Œåˆ™ application-prod.properties ä¸­çš„å€¼æ€»æ˜¯è¢« application-live.properties ä¸­çš„å€¼è¦†ç›–ã€‚</p> <p>å¦‚æœæ²¡æœ‰ active ä»»ä½• profile ç‰¹å®šé…ç½®æ–‡ä»¶çš„è¯ï¼Œé»˜è®¤ä¼šä½¿ç”¨ application-defaultï¼ˆå¦‚æœå­˜åœ¨ï¼‰ çš„å±æ€§ã€‚</p> <h4 id="å¯¼å…¥é¢å¤–é…ç½®"><a href="#å¯¼å…¥é¢å¤–é…ç½®" class="header-anchor">#</a> å¯¼å…¥é¢å¤–é…ç½®</h4> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ spring.config.import å±æ€§ä»å…¶å®ƒçš„è·¯å¾„å¯¼å…¥æ›´å¤šçš„é…ç½®æ•°æ®ï¼Œå¯¼å…¥è¢«è§†ä¸ºåœ¨å£°æ˜å¯¼å…¥æ–‡ä»¶çš„ä¸‹æ–¹æ’å…¥é™„åŠ æ–‡ä»¶ã€‚</p> <p>ä¾‹å¦‚ï¼Œå¦‚æœç±»è·¯å¾„ä¸‹çš„ application.properties é…ç½®æ–‡ä»¶ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>spring.application.name=myapp
spring.config.import=optional:file:./dev.properties
</code></pre></div><p>é‚£ä¹ˆå½“å‰ç›®å½•ä¸­ dev.properties æ–‡ä»¶å°†ä¼šè¢«å¯¼å…¥ï¼ˆå¦‚æœå­˜åœ¨è¿™æ ·çš„æ–‡ä»¶ï¼‰ï¼Œä» dev.properties ä¸­å¯¼å…¥çš„å±æ€§å€¼å°†ä¼˜å…ˆäºè§¦å‘å¯¼å…¥çš„ application.properties æ–‡ä»¶ä¸­çš„å±æ€§å€¼ ï¼Œdev.properties å¯ä»¥é‡æ–°å®šä¹‰ spring.application.name çš„å±æ€§å€¼ã€‚</p> <p>ä¸€ä¸ª import æ— è®ºè¢«å£°æ˜å¤šå°‘æ¬¡ï¼Œéƒ½åªä¼šæœ‰ä¸€æ¬¡å¯¼å…¥ï¼Œå¹¶ä¸”åœ¨å•ä¸ª properties/yaml æ–‡ä»¶ä¸­å®šä¹‰çš„å¯¼å…¥é¡ºåºæ— å…³ç´§è¦ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä¸¤ä¸ªç¤ºä¾‹å°†äº§ç”Ÿç›¸åŒçš„ç»“æœï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>spring.config.import=my.properties
my.property=value
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>my.property=value
spring.config.import=my.properties
</code></pre></div><p>åœ¨ä¸Šè¿°ä¸¤ä¸ªç¤ºä¾‹ä¸­ï¼Œmy.properties æ–‡ä»¶ä¸­çš„å±æ€§å€¼å°†ä¼˜å…ˆäºè§¦å‘å…¶å¯¼å…¥çš„æ–‡ä»¶ã€‚</p> <p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ spring.config.import å±æ€§æŒ‡å®šå¤šä¸ªå¯¼å…¥è·¯å¾„ï¼ŒæŒ‰ç…§å®šä¹‰çš„é¡ºåºè¿›è¡Œå¤„ç†ï¼Œåé¢çš„å¯¼å…¥ä¼˜å…ˆã€‚</p> <p>Spring Boot æ”¯æŒé…ç½®å„ç§ä¸åŒä½ç½®æ•°æ®â€‹çš„å¯æ’æ‹” APIã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Java å±æ€§ã€YAML å’Œ é…ç½®æ ‘ã€‚</p> <p>ç¬¬ä¸‰æ–¹ jar å¯ä»¥æä¾›å¯¹å…¶ä»–æŠ€æœ¯çš„æ”¯æŒï¼ˆä¸éœ€è¦æ–‡ä»¶æ˜¯æœ¬åœ°çš„ï¼‰ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå‡å®šé…ç½®æ•°æ®æ¥è‡ªå¤–éƒ¨å­˜å‚¨ï¼Œä¾‹å¦‚ Consulã€Apache ZooKeeperã€Netflix Archaius æˆ– Nacos ç­‰ã€‚</p> <p>å¦‚æœæˆ‘ä»¬æƒ³è‡ªå®šä¹‰è‡ªå·±çš„é…ç½®æ•°æ®ä½ç½®ï¼Œå¯ä»¥å‚è€ƒ org.springframework.boot.context.config åŒ…ä¸‹çš„ ConfigDataLocationResolver å’Œ ConfigDataLoaderç±»ã€‚</p> <h4 id="å¯¼å…¥æ— æ‰©å±•åæ–‡ä»¶"><a href="#å¯¼å…¥æ— æ‰©å±•åæ–‡ä»¶" class="header-anchor">#</a> å¯¼å…¥æ— æ‰©å±•åæ–‡ä»¶</h4> <p>æŸäº›äº‘å¹³å°æ— æ³•ä¸ºå·æŒ‚è½½æ–‡ä»¶æ·»åŠ æ–‡ä»¶æ‰©å±•åã€‚è¦å¯¼å…¥è¿™äº›æ— æ‰©å±•åçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ç»™ Spring Boot ä¸€ä¸ªæç¤ºæ¥è®©å®ƒçŸ¥é“å¦‚ä½•åŠ è½½å®ƒä»¬ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†æ‰©å±•æç¤ºæ”¾åœ¨æ–¹æ‹¬å·ä¸­æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</p> <p>ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ª /etc/config/myconfig æ–‡ä»¶è¦å¯¼å…¥ä¸º yamlã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç åœ¨ application.properties ä¸­å¯¼å…¥å®ƒï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>spring.config.import=file:/etc/config/myconfig[.yaml]
</code></pre></div><h4 id="ä½¿ç”¨é…ç½®æ ‘"><a href="#ä½¿ç”¨é…ç½®æ ‘" class="header-anchor">#</a> ä½¿ç”¨é…ç½®æ ‘</h4> <p>åœ¨äº‘å¹³å°ï¼ˆä¾‹å¦‚ Kubernetesï¼‰ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼Œé€šå¸¸éœ€è¦è¯»å–å¹³å°æä¾›çš„é…ç½®å€¼ã€‚å°†ç¯å¢ƒå˜é‡ç”¨äºæ­¤ç±»çš„ç›®çš„å¹¶ä¸å°‘è§ï¼Œä½†è¿™å¯èƒ½ä¼šæœ‰ç¼ºç‚¹ï¼Œå°¤å…¶æ˜¯åœ¨å€¼åº”è¯¥ä¿å¯†çš„æƒ…å†µä¸‹ã€‚</p> <p>ä½œä¸ºç¯å¢ƒå˜é‡çš„æ›¿ä»£æ–¹æ¡ˆï¼Œè®¸å¤šäº‘å¹³å°ç°åœ¨å…è®¸æˆ‘ä»¬å°†é…ç½®æ˜ å°„åˆ°æŒ‚è½½çš„æ•°æ®å·ã€‚ä¾‹å¦‚ï¼ŒKubernetes å¯ä»¥åŒæ—¶æŒ‚è½½ ConfigMaps å’Œ Secretsã€‚</p> <p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ç§å¸¸è§çš„å·æŒ‚è½½æ¨¡å¼ï¼š</p> <ol><li><p>åŒ…å«ä¸€ç»„å®Œæ•´å±æ€§çš„å•ä¸ªæ–‡ä»¶ï¼ˆé€šå¸¸å†™ä¸º YAMLï¼‰ã€‚</p></li> <li><p>å¤šä¸ªæ–‡ä»¶è¢«å†™å…¥ç›®å½•æ ‘ï¼Œæ–‡ä»¶åä½œä¸º keyï¼Œå†…å®¹ä½œä¸º valueã€‚</p></li></ol> <p>å¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é…ç½®å±æ€§ spring.config.import çš„æ–¹æ³•ç›´æ¥å¯¼å…¥ YAML æˆ–å±æ€§æ–‡ä»¶ã€‚å¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨é…ç½®æ ‘ï¼šSpring Boot çŸ¥é“å®ƒéœ€è¦å°†å“ªäº›æ–‡ä»¶å…¬å¼€ä¸ºå±æ€§çš„å‰ç¼€ã€‚</p> <p>ä¾‹å¦‚ï¼Œå‡è®¾ Kubernetes æŒ‚è½½äº†ä»¥ä¸‹å·ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>etc/
  config/
    myapp/
      username
      password
</code></pre></div><p>username æ–‡ä»¶çš„å†…å®¹å°†æ˜¯ä¸€ä¸ªé…ç½®å€¼ï¼Œpassword æ–‡ä»¶çš„å†…å®¹å°†ä¼šåŠ å¯†ã€‚</p> <p>è¦å¯¼å…¥è¿™äº›å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ application.properties æˆ– application.yaml æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>spring.config.import=optional:configtree:/etc/config/
</code></pre></div><p>ç„¶åï¼Œæˆ‘ä»¬èƒ½å¤Ÿä»¥ä¸€ç§å¸¸ç”¨çš„æ–¹å¼ä» Environment ä¸­è®¿é—®æˆ–è€…æ³¨å…¥ myapp.username å’Œ myapp.password å±æ€§ã€‚</p> <p>é…ç½®æ ‘çš„å€¼å¯ä»¥ç»‘å®šåˆ° String å’Œ byte[] ç±»å‹ã€‚</p> <h4 id="å±æ€§å ä½ç¬¦"><a href="#å±æ€§å ä½ç¬¦" class="header-anchor">#</a> å±æ€§å ä½ç¬¦</h4> <p>application.properties å’Œ application.yml ä¸­çš„å€¼åœ¨ä½¿ç”¨æ—¶ä¼šé€šè¿‡å·²æœ‰ç¯å¢ƒè¿‡æ»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å‚è€ƒä¹‹å‰å·²ç»å®šä¹‰çš„å€¼ï¼ˆä¾‹å¦‚ï¼Œæ¥è‡ªç³»ç»Ÿå±æ€§æˆ–ç¯å¢ƒå˜é‡ï¼‰ã€‚æ ‡å‡†çš„ ${name} å±æ€§å ä½ç¬¦è¯­æ³•å¯ä»¥åœ¨å€¼å†…çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œå±æ€§å ä½ç¬¦è¿˜å¯ä»¥ä½¿ç”¨<code>:</code>æ¥æŒ‡å®šé»˜è®¤å€¼ï¼Œä¾‹å¦‚${name:default}ã€‚</p> <p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä½¿ç”¨å’Œä¸ä½¿ç”¨é»˜è®¤å€¼çš„å ä½ç¬¦ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>app.name=MyApp
app.description=${app.name} is a Spring Boot application written by ${username:Unknown}
</code></pre></div><p>å¦‚æœ username å±æ€§è¿˜æ²¡æœ‰åœ¨å…¶å®ƒåœ°æ–¹è®¾ç½®ï¼Œapp.description çš„å€¼ä¸º MyApp is a Spring Boot application written by Unknownã€‚</p> <h4 id="å¤šæ–‡æ¡£æ–‡ä»¶"><a href="#å¤šæ–‡æ¡£æ–‡ä»¶" class="header-anchor">#</a> å¤šæ–‡æ¡£æ–‡ä»¶</h4> <p>Spring Boot å…è®¸æˆ‘ä»¬å°†å•ä¸ªç‰©ç†æ–‡ä»¶æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹æ·»åŠ çš„é€»è¾‘æ–‡æ¡£ï¼Œæ–‡æ¡£ä»ä¸Šåˆ°ä¸‹æŒ‰é¡ºåºå¤„ç†ã€‚åé¢çš„æ–‡æ¡£å¯ä»¥è¦†ç›–å‰é¢æ–‡æ¡£ä¸­å®šä¹‰çš„å±æ€§ã€‚</p> <p>å¯¹äº application.yml æ–‡ä»¶ï¼Œä½¿ç”¨æ ‡å‡†çš„ YAML å¤šæ–‡æ¡£è¯­æ³•ã€‚ä¸‰ä¸ªè¿ç»­çš„è¿å­—ç¬¦<code>---</code>ä»£è¡¨ä¸Šä¸€ä¸ªæ–‡æ¡£çš„ç»“æŸä»¥åŠä¸‹ä¸€ä¸ªæ–‡æ¡£çš„å¼€å§‹ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>spring:
  application:
    name: &quot;MyApp&quot;
---
spring:
  application:
    name: &quot;MyCloudApp&quot;
  config:
    activate:
      on-cloud-platform: &quot;kubernetes&quot;
</code></pre></div><p>å¯¹äº application.properties æ–‡ä»¶ï¼Œ <code>#---</code> ä½œä¸ºæ–‡æ¡£çš„åˆ†å‰²ç¬¦ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>spring.application.name=MyApp
#---
spring.application.name=MyCloudApp
spring.config.activate.on-cloud-platform=kubernetes
</code></pre></div><p><strong>æ³¨ï¼šå±æ€§æ–‡ä»¶åˆ†éš”ç¬¦ä¸èƒ½æœ‰ä»»ä½•å‰å¯¼ç©ºæ ¼ï¼Œå¹¶ä¸”å¿…é¡»æ­£å¥½æœ‰ä¸‰ä¸ªè¿å­—ç¬¦ï¼Œåˆ†éš”ç¬¦å‰åçš„è¡Œä¸èƒ½æ˜¯æ³¨é‡Šã€‚å¹¶ä¸”ä¸èƒ½ä½¿ç”¨ @PropertySource æˆ– @TestPropertySource æ³¨è§£åŠ è½½å¤šæ–‡æ¡£å±æ€§æ–‡ä»¶ã€‚</strong></p> <p>å¤šæ–‡æ¡£å±æ€§æ–‡ä»¶é€šå¸¸ä¸æ¿€æ´»å±æ€§ç»“åˆä½¿ç”¨ï¼Œä¾‹å¦‚ spring.config.activate.on-profileã€‚</p> <h4 id="æ¿€æ´»å±æ€§"><a href="#æ¿€æ´»å±æ€§" class="header-anchor">#</a> æ¿€æ´»å±æ€§</h4> <p>æœ‰æ—¶å€™ä»…ä»…åœ¨æ»¡è¶³æŸäº›æ¡ä»¶æ‰æ¿€æ´»ä¸€ç»„å±æ€§çš„æ–¹å¼æ˜¯éå¸¸æœ‰ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ spring.config.activate.* å±æ€§æœ‰æ¡ä»¶åœ°æ¿€æ´»å±æ€§æ–‡æ¡£ã€‚</p> <p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„æ¿€æ´»å±æ€§ï¼š</p> <div class="language- extra-class"><pre><code>1. on-profileï¼šè¡¨è¾¾å¼ä¸å½“å‰ profiles åŒ¹é…æ‰èƒ½è¢«æ¿€æ´»
2. on-cloud-platformï¼šæ£€æµ‹åˆ° CloudPlatform æ‰èƒ½è¢«æ¿€æ´».
</code></pre></div><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹å†…å®¹æŒ‡å®šå½“ç¨‹åºè¿è¡Œåœ¨ Kubernetes ä¸Šå¹¶ä¸” prod æˆ– staging é…ç½®å¤„äºæ¿€æ´»çŠ¶æ€æ—¶ï¼Œç¬¬äºŒä¸ªæ–‡æ¡£æ‰ä¼šè¢«æ¿€æ´»ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>myprop=always-set
#---
spring.config.activate.on-cloud-platform=kubernetes
spring.config.activate.on-profile=prod | staging
myotherprop=sometimes-set
</code></pre></div><h4 id="yaml-ä½¿ç”¨"><a href="#yaml-ä½¿ç”¨" class="header-anchor">#</a> YAML ä½¿ç”¨</h4> <p>YAML æ˜¯ JSON çš„è¶…é›†ï¼Œä¸€ç§ç”¨äºæŒ‡å®šåˆ†å±‚é…ç½®æ•°æ®çš„ä¾¿æ·æ ¼å¼ã€‚åªè¦ç±»è·¯å¾„ä¸­æœ‰ SnakeYAML åº“ï¼ŒSpringApplication ç±»å°±ä¼šè‡ªåŠ¨æ”¯æŒ YAML ä½œä¸º properties çš„æ›¿ä»£æ–¹æ¡ˆã€‚åªè¦æˆ‘ä»¬ä½¿ç”¨äº† Starters ï¼Œspring-boot-starter è‡ªåŠ¨æä¾›äº† SnakeYAMLã€‚</p> <p>YAML æ–‡æ¡£éœ€è¦ä»åˆ†å±‚æ ¼å¼è½¬æ¢ä¸º Spring Environment å¯ä»¥ä½¿ç”¨çš„å¹³é¢ç»“æ„ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>environments:
  dev:
    url: &quot;https://dev.example.com&quot;
    name: &quot;Developer Setup&quot;
  prod:
    url: &quot;https://another.example.com&quot;
    name: &quot;My Cool App&quot;
</code></pre></div><p>Spring Environment ä¸ºäº†è®¿é—®ä»¥ä¸Šè¿™äº›å±æ€§, ä¼šè½¬æ¢æˆå¦‚ä¸‹çš„æ ¼å¼:</p> <div class="language- extra-class"><pre class="language-text"><code>environments.dev.url=https://dev.example.com
environments.dev.name=Developer Setup
environments.prod.url=https://another.example.com
environments.prod.name=My Cool App
</code></pre></div><p>åŒæ ·çš„ï¼ŒYAML åˆ—è¡¨ä¹Ÿéœ€è¦å±•å¹³ã€‚å®ƒä»¬ä¼šè¢«è½¬æ¢æˆå¸¦æœ‰[index]ç¬¦å·çš„å±æ€§ keyã€‚å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>my:
 servers:
 - &quot;dev.example.com&quot;
 - &quot;another.example.com&quot;
</code></pre></div><p>è½¬æ¢åçš„ç»“æœï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>my.servers[0]=dev.example.com
my.servers[1]=another.example.com
</code></pre></div><p>ä½¿ç”¨è¯¥[index]ç¬¦å·çš„å±æ€§å¯ä»¥ä½¿ç”¨ Spring Boot çš„ Binder ç±»ç»‘å®šåˆ° Java List æˆ– Set å¯¹è±¡ã€‚</p> <p><strong>æ³¨ï¼šYAML æ–‡ä»¶ä¸èƒ½ä½¿ç”¨ @PropertySource æˆ– @TestPropertySource æ³¨è§£åŠ è½½ã€‚å¦‚æœæˆ‘ä»¬æƒ³ä»¥è¿™ç§æ–¹å¼åŠ è½½å±æ€§å€¼ï¼Œéœ€è¦ä½¿ç”¨ properties æ–‡ä»¶ã€‚</strong></p> <p>Spring Framework æä¾›äº†ä¸¤ä¸ªæ–¹ä¾¿çš„ç±»ç”¨äºåŠ è½½ YAML æ–‡æ¡£ï¼š</p> <ol><li>YamlPropertiesFactoryBeanï¼š å°† YAML åŠ è½½ä¸º Properties å¯¹è±¡</li> <li>YamlMapFactoryBeanï¼šå°† YAML åŠ è½½ä¸º Map å¯¹è±¡.</li></ol> <p>å¦‚æœæˆ‘ä»¬æƒ³å°† YAML åŠ è½½ä¸ºä¸€ä¸ª Spring PropertySourceï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ YamlPropertySourceLoader ç±»ã€‚</p> <h3 id="é…ç½®éšæœºå€¼"><a href="#é…ç½®éšæœºå€¼" class="header-anchor">#</a> é…ç½®éšæœºå€¼</h3> <p>RandomValuePropertySource å¯¹äºæ³¨å…¥éšæœºå€¼å¾ˆæœ‰ç”¨ï¼ˆä¾‹å¦‚ï¼Œæ³¨å…¥å¯†é’¥æˆ–æµ‹è¯•ç”¨ä¾‹ï¼‰ã€‚å®ƒå¯ä»¥ç”Ÿæˆæ•´æ•°ã€é•¿æ•´æ•°ã€uuid æˆ–å­—ç¬¦ä¸²ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>my.secret=${random.value}
my.number=${random.int}
my.bignumber=${random.long}
my.uuid=${random.uuid}
my.number-less-than-ten=${random.int(10)}
my.number-in-range=${random.int[1024,65536]}

</code></pre></div><h3 id="é…ç½®ç³»ç»Ÿç¯å¢ƒå±æ€§"><a href="#é…ç½®ç³»ç»Ÿç¯å¢ƒå±æ€§" class="header-anchor">#</a> é…ç½®ç³»ç»Ÿç¯å¢ƒå±æ€§</h3> <p>Spring Boot æ”¯æŒä¸ºç¯å¢ƒå±æ€§è®¾ç½®å‰ç¼€ã€‚è¿™å¯¹äºå¤šä¸ªä¸åŒé…ç½®è¦æ±‚çš„ Spring Boot åº”ç”¨ç¨‹åºå…±äº«ç³»ç»Ÿç¯å¢ƒæ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œç³»ç»Ÿç¯å¢ƒå±æ€§çš„å‰ç¼€å¯ä»¥ç›´æ¥é€šè¿‡ SpringApplication è®¾ç½®ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>public static void main(String[] args) {
    SpringApplication springApplication = new SpringApplication(NovelApplication.class);
    springApplication.setEnvironmentPrefix(&quot;prod&quot;);
    springApplication.run(args);
}
</code></pre></div><h3 id="ç±»å‹å®‰å…¨çš„é…ç½®å±æ€§"><a href="#ç±»å‹å®‰å…¨çš„é…ç½®å±æ€§" class="header-anchor">#</a> ç±»å‹å®‰å…¨çš„é…ç½®å±æ€§</h3> <p>ä½¿ç”¨ @Value(&quot;${property}&quot;) æ³¨è§£æ¥æ³¨å…¥é…ç½®å±æ€§æœ‰æ—¶ä¼šå¾ˆéº»çƒ¦ï¼Œç‰¹åˆ«æ˜¯åœ¨åœ¨ä½¿ç”¨å¤šä¸ªå±æ€§æˆ–è€…æ•°æ®æœ¬è´¨ä¸Šæ˜¯åˆ†å±‚çš„æ—¶å€™ã€‚Spring Boot æä¾›äº†ä¸€ç§ä½¿ç”¨å±æ€§çš„æ›¿ä»£æ–¹æ³•ï¼Œå¯ä»¥è®©å¼ºç±»å‹çš„ bean æ¥ç®¡ç†å’ŒéªŒè¯åº”ç”¨ç¨‹åºçš„é…ç½®ã€‚</p> <h4 id="javabean-å±æ€§ç»‘å®š"><a href="#javabean-å±æ€§ç»‘å®š" class="header-anchor">#</a> JavaBean å±æ€§ç»‘å®š</h4> <p>æˆ‘ä»¬å¯ä»¥ç»‘å®šä¸€ä¸ªæ ‡å‡† Java Bean å±æ€§å£°æ˜çš„ beanï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>@ConfigurationProperties(&quot;my.service&quot;)
public class MyProperties {

    private boolean enabled;

    private InetAddress remoteAddress;

    private final Security security = new Security();

    public boolean isEnabled() {
        return this.enabled;
    }

    public void setEnabled(boolean enabled) {
        this.enabled = enabled;
    }

    public InetAddress getRemoteAddress() {
        return this.remoteAddress;
    }

    public void setRemoteAddress(InetAddress remoteAddress) {
        this.remoteAddress = remoteAddress;
    }

    public Security getSecurity() {
        return this.security;
    }

    public static class Security {

        private String username;

        private String password;

        private List&lt;String&gt; roles = new ArrayList&lt;&gt;(Collections.singleton(&quot;USER&quot;));

        public String getUsername() {
            return this.username;
        }

        public void setUsername(String username) {
            this.username = username;
        }

        public String getPassword() {
            return this.password;
        }

        public void setPassword(String password) {
            this.password = password;
        }

        public List&lt;String&gt; getRoles() {
            return this.roles;
        }

        public void setRoles(List&lt;String&gt; roles) {
            this.roles = roles;
        }

    }

}
</code></pre></div><p>ä¸Šé¢çš„ POJO å®šä¹‰äº†ä»¥ä¸‹å±æ€§:</p> <ul><li><p>my.service.enabled</p></li> <li><p>my.service.remote-address</p></li> <li><p>my.service.security.username</p></li> <li><p>my.service.security.password</p></li> <li><p>my.service.security.roles</p></li></ul> <p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥çš„æ–¹å¼æ¥ç»‘å®šæˆ‘ä»¬çš„é…ç½®å±æ€§ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>@ConfigurationProperties(&quot;my.service&quot;)
public class MyProperties {

    private final boolean enabled;

    private final InetAddress remoteAddress;

    private final Security security;

    public MyProperties(boolean enabled, InetAddress remoteAddress, Security security) {
        this.enabled = enabled;
        this.remoteAddress = remoteAddress;
        this.security = security;
    }

    public boolean isEnabled() {
        return this.enabled;
    }

    public InetAddress getRemoteAddress() {
        return this.remoteAddress;
    }

    public Security getSecurity() {
        return this.security;
    }

    public static class Security {

        private final String username;

        private final String password;

        private final List&lt;String&gt; roles;

        public Security(String username, String password, @DefaultValue(&quot;USER&quot;) List&lt;String&gt; roles) {
            this.username = username;
            this.password = password;
            this.roles = roles;
        }

        public String getUsername() {
            return this.username;
        }

        public String getPassword() {
            return this.password;
        }

        public List&lt;String&gt; getRoles() {
            return this.roles;
        }

    }

}
</code></pre></div><h4 id="å¯ç”¨-configurationproperties-bean"><a href="#å¯ç”¨-configurationproperties-bean" class="header-anchor">#</a> å¯ç”¨ @ConfigurationProperties bean</h4> <p>Spring Boot æä¾›äº† @ConfigurationProperties é…ç½®å±æ€§ç»‘å®šå¹¶å°†å®ƒä»¬æ³¨å†Œä¸º bean çš„åŸºç¡€è®¾æ–½ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰ç±»å¯ç”¨é…ç½®å±æ€§ï¼Œä¹Ÿå¯ä»¥å¯ç”¨ä¸ç»„ä»¶æ‰«æç±»ä¼¼çš„é…ç½®å±æ€§æ‰«æã€‚</p> <p>æœ‰æ—¶å€™ï¼Œå¸¦æœ‰ @ConfigurationProperties æ³¨è§£çš„ç±»å¯èƒ½ä¸é€‚åˆæ‰«æã€‚ä¾‹å¦‚ï¼Œå¼€å‘è‡ªå·±çš„è‡ªåŠ¨é…ç½®ç±»æˆ–è€…å¸Œæœ›æœ‰æ¡ä»¶åœ°å¯ç”¨æŸäº›é…ç½®ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @EnableConfigurationProperties æ³¨è§£æŒ‡å®šè¦å¤„ç†çš„ @ConfigurationProperties ç±»åˆ—è¡¨ï¼Œå¯ä»¥åœ¨ä»»ä½• @Configuration ç±»ä¸Šå®Œæˆã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>@Configuration(proxyBeanMethods = false)
@EnableConfigurationProperties(SomeProperties.class)
public class MyConfiguration {

}
</code></pre></div><p>è¦å¯ç”¨é…ç½®å±æ€§æ‰«æï¼Œéœ€è¦å°† @ConfigurationPropertiesScan æ³¨è§£æ·»åŠ åˆ°åº”ç”¨ç¨‹åºã€‚é€šå¸¸ï¼Œå®ƒè¢«æ·»åŠ åˆ°å¸¦æœ‰ @SpringBootApplication æ³¨è§£çš„åº”ç”¨ç¨‹åºä¸»ç±»ä¸Šï¼Œä¹Ÿå¯ä»¥æ·»åŠ åˆ°ä»»ä½• @Configuration ç±»ä¸Šã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰«æå°†ä»å£°æ˜æ³¨è§£ç±»çš„åŒ…ä¸‹è¿›è¡Œï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰è¦æ‰«æçš„åŒ…ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>@SpringBootApplication
@ConfigurationPropertiesScan({ &quot;com.example.app&quot;, &quot;com.example.another&quot; })
public class MyApplication {

}
</code></pre></div><h4 id="ä½¿ç”¨-configurationproperties-bean"><a href="#ä½¿ç”¨-configurationproperties-bean" class="header-anchor">#</a> ä½¿ç”¨ @ConfigurationProperties bean</h4> <p>å¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨ @ConfigurationProperties beansï¼Œå¯ä»¥åƒæ³¨å…¥ä»»ä½•å…¶ä»– Spring bean ä¸€æ ·æ³¨å…¥å®ƒä»¬ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>@Service
public class MyService {

    private final SomeProperties properties;

    public MyService(SomeProperties properties) {
        this.properties = properties;
    }

    public void openConnection() {
        Server server = new Server(this.properties.getRemoteAddress());
        server.start();
        // ...
    }

    // ...

}
</code></pre></div><h4 id="ç¬¬ä¸‰æ–¹é…ç½®"><a href="#ç¬¬ä¸‰æ–¹é…ç½®" class="header-anchor">#</a> ç¬¬ä¸‰æ–¹é…ç½®</h4> <p>@ConfigurationProperties æ³¨è§£é™¤äº†ç”¨äºç±»ä¸Šï¼Œè¿˜å¯ä»¥åœ¨å…¬å…±çš„ @Bean æ–¹æ³•ä¸Šä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼å°†å±æ€§ç»‘å®šåˆ°æ— æ³•æ§åˆ¶çš„ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼ˆä¾‹å¦‚ MySQL å¤šæ•°æ®æºé…ç½®ï¼‰ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>@Bean
@Primary 
@ConfigurationProperties(prefix = &quot;book.datasource&quot;) 
public DataSource bookDataDataSource() {
    return DataSourceBuilder.create().build();
}

@Bean
@ConfigurationProperties(prefix = &quot;user.datasource&quot;) 
public DataSource userDataSource() {
    return DataSourceBuilder.create().build();
}
</code></pre></div><h4 id="å®½æ¾ç»‘å®š"><a href="#å®½æ¾ç»‘å®š" class="header-anchor">#</a> å®½æ¾ç»‘å®š</h4> <p>Spring Boot ä½¿ç”¨ä¸€äº›å®½æ¾çš„è§„åˆ™å°† Environment å±æ€§ç»‘å®šåˆ° bean ï¼Œå› æ­¤ Environment å±æ€§åç§°å’Œ @ConfigurationProperties bean å±æ€§åç§°ä¹‹é—´ä¸éœ€è¦å®Œå…¨åŒ¹é…ã€‚å¸¸è§ç¤ºä¾‹åŒ…æ‹¬ç ´æŠ˜å·åˆ†éš”çš„ Environment å±æ€§ï¼ˆä¾‹å¦‚ï¼Œcontext-path ç»‘å®šåˆ° contextPathï¼‰å’Œå¤§å†™ Environment å±æ€§ï¼ˆä¾‹å¦‚ï¼ŒPORT ç»‘å®šåˆ° portï¼‰ã€‚</p> <h4 id="å±æ€§è½¬æ¢"><a href="#å±æ€§è½¬æ¢" class="header-anchor">#</a> å±æ€§è½¬æ¢</h4> <p>Spring Boot åœ¨ç»‘å®šå¤–éƒ¨åº”ç”¨ç¨‹åºå±æ€§åˆ° @ConfigurationProperties bean æ—¶ä¼šå°è¯•å°†å±æ€§å¼ºåˆ¶è½¬æ¢ä¸ºæ­£ç¡®çš„ç±»å‹ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ç±»å‹è½¬æ¢ï¼Œå¯ä»¥æä¾›ä¸€ä¸ª ConversionService beanï¼ˆå¸¦æœ‰åä¸º    conversionService çš„ beanï¼‰æˆ–è‡ªå®šä¹‰å±æ€§ç¼–è¾‘å™¨ï¼ˆé€šè¿‡ä¸€ä¸ª CustomEditorConfigurer beanï¼‰ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰ Convertersï¼ˆå¸¦æœ‰ @ConfigurationPropertiesBinding æ³¨è§£çš„ bean å®šä¹‰ï¼‰ã€‚</p> <h4 id="configurationproperties-æ ¡éªŒ"><a href="#configurationproperties-æ ¡éªŒ" class="header-anchor">#</a> @ConfigurationProperties æ ¡éªŒ</h4> <p>å½“æˆ‘ä»¬åœ¨ @ConfigurationProperties ç±»ä¸Šä½¿ç”¨ Spring çš„ @Validated æ³¨è§£æ—¶ï¼ŒSpring Boot ä¼šå°è¯•æ ¡éªŒè¯¥ç±»ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨ JSR-303 javax.validation çš„çº¦æŸæ³¨è§£ï¼Œä½¿ç”¨ä¹‹å‰åº”è¯¥ç¡®ä¿ç±»è·¯å¾„ä¸­å­˜åœ¨å…¼å®¹çš„ JSR-303 å®ç°ï¼Œç„¶åå°†çº¦æŸæ³¨è§£æ·»åŠ åˆ°å­—æ®µä¸Šã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>@ConfigurationProperties(&quot;my.service&quot;)
@Validated
public class MyProperties {

   @NotNull
   private InetAddress remoteAddress;

   @Valid
   private final Security security = new Security();

   public InetAddress getRemoteAddress() {
       return this.remoteAddress;
   }

   public void setRemoteAddress(InetAddress remoteAddress) {
       this.remoteAddress = remoteAddress;
   }

   public Security getSecurity() {
       return this.security;
   }

   public static class Security {

       @NotEmpty
       private String username;

       public String getUsername() {
           return this.username;
       }

       public void setUsername(String username) {
           this.username = username;
       }

   }

}
</code></pre></div><p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªåä¸º configurationPropertiesValidator çš„ bean å®šä¹‰æ¥æ·»åŠ è‡ªå®šä¹‰çš„ Spring æ ¡éªŒå™¨ã€‚</p> <p>spring-boot-actuator æ¨¡å—åŒ…å«äº†ä¸€ä¸ªå…¬å¼€æ‰€æœ‰ @ConfigurationProperties bean çš„ç«¯ç‚¹ã€‚</p> <h3 id="profiles"><a href="#profiles" class="header-anchor">#</a> Profiles</h3> <p>Spring Profiles æä¾›äº†ä¸€ç§åˆ†ç¦»åº”ç”¨ç¨‹åºé…ç½®éƒ¨åˆ†å¹¶ä½¿å…¶ä»…åœ¨æŸäº›ç¯å¢ƒä¸­å¯ç”¨çš„æ–¹æ³•ã€‚ä»»æ„çš„ @Componentï¼Œ@Configuration æˆ– @ConfigurationProperties éƒ½å¯ä»¥è¢« @Profile æ ‡è®°æ¥é™åˆ¶å®ƒä»¬çš„åŠ è½½ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>@Configuration
@Profile(&quot;production&quot;)
public class ProductionConfiguration {

    // ...

}
</code></pre></div><p>@ConfigurationProperties bean å¦‚æœæ˜¯é€šè¿‡ @EnableConfigurationProperties æ³¨å†Œçš„ï¼Œ@Profile éœ€è¦åœ¨å¸¦æœ‰ @EnableConfigurationProperties æ³¨è§£çš„ @Configuration ç±»ä¸ŠæŒ‡å®šã€‚å¦‚æœæ˜¯è‡ªåŠ¨æ‰«ææ³¨å†Œçš„ï¼Œ@Profile ç›´æ¥åœ¨ @ConfigurationProperties ç±»ä¸ŠæŒ‡å®šã€‚</p> <p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Environment å±æ€§ spring.profiles.active æ¥æŒ‡å®šå“ªäº› profiles å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œä¾‹å¦‚ï¼Œåœ¨ application.properties é…ç½®æ–‡ä»¶ä¸­æ¿€æ´» dev å’Œ hsqldbï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>spring.profiles.active=dev,hsqldb
</code></pre></div><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•°çš„æ–¹å¼æ¿€æ´»å®ƒä»¬ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>--spring.profiles.active=dev,hsqldb
</code></pre></div><p>å¦‚æœæ²¡æœ‰ profile å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œä¼šå¯ç”¨ä¸€ä¸ªé»˜è®¤çš„ profileã€‚é»˜è®¤ profile çš„åç§°æ˜¯ defaultï¼Œå¯ä»¥é€šè¿‡ Environment å±æ€§ spring.profiles.defaultè¿›è¡Œè°ƒæ•´ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>spring.profiles.default=none
</code></pre></div><p>spring.profiles.active å’Œ spring.profiles.default åªèƒ½ç”¨åœ¨éç‰¹å®šé…ç½®çš„æ–‡æ¡£ä¸­ï¼Œå®ƒä»¬ä¸èƒ½åŒ…å«åœ¨ç‰¹å®šé…ç½®æ–‡ä»¶ï¼ˆapplication-{profile}ï¼‰æˆ–ç”± spring.config.activate.on-profile æ¿€æ´»çš„æ–‡æ¡£ä¸­ã€‚</p> <p>å¦‚ä¸‹æ‰€ç¤ºï¼Œç¬¬äºŒä¸ªæ–‡æ¡£æ˜¯æ— æ•ˆçš„ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code># this document is valid
spring.profiles.active=prod
#---
# this document is invalid
spring.config.activate.on-profile=prod
spring.profiles.active=metrics
</code></pre></div><h2 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="header-anchor">#</a> æ—¥å¿—</h2> <p>Spring Boot ä½¿ç”¨ <a href="https://commons.apache.org/proper/commons-logging/" target="_blank" rel="noopener noreferrer">Commons Logging<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> è¿›è¡Œæ‰€æœ‰å†…éƒ¨æ—¥å¿—è®°å½•ï¼Œä½†å¼€æ”¾åº•å±‚æ—¥å¿—å®ç°ï¼Œä¸º Java Util Loggingã€Log4J2 å’Œ Logback æä¾›äº†é»˜è®¤é…ç½®ã€‚åœ¨æ¯ç§æƒ…å†µä¸‹ï¼Œéƒ½é¢„å…ˆé…ç½®ä¸ºä½¿ç”¨æ§åˆ¶å°è¾“å‡ºï¼Œè¿˜æä¾›å¯é€‰çš„æ–‡ä»¶è¾“å‡ºã€‚Spring Boot é»˜è®¤ä½¿ç”¨çš„æ˜¯ Logback æ—¥å¿—å®ç°ã€‚</p> <h3 id="æ—¥å¿—æ ¼å¼"><a href="#æ—¥å¿—æ ¼å¼" class="header-anchor">#</a> æ—¥å¿—æ ¼å¼</h3> <p>Spring Boot é»˜è®¤çš„æ—¥å¿—è¾“å‡ºæ ¼å¼å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>2022-05-07T10:16:13.116+08:00  INFO 33212 --- [  restartedMain] i.github.xxyopen.novel.NovelApplication  : Starting NovelApplication using Java 17.0.3 on xiongxiaoyangdeMacBook-Air.local with PID 33212 (/Users/xiongxiaoyang/java/springboot3/target/classes started by xiongxiaoyang in /Users/xiongxiaoyang/java/springboot3)
2022-05-07T10:16:13.120+08:00  INFO 33212 --- [  restartedMain] i.github.xxyopen.novel.NovelApplication  : No active profile set, falling back to 1 default profile: &quot;default&quot;
2022-05-07T10:16:13.247+08:00  INFO 33212 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2022-05-07T10:16:13.248+08:00  INFO 33212 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2022-05-07T10:16:15.136+08:00  INFO 33212 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
2022-05-07T10:16:15.164+08:00  INFO 33212 --- [  restartedMain] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2022-05-07T10:16:15.164+08:00  INFO 33212 --- [  restartedMain] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/10.0.18]
2022-05-07T10:16:15.291+08:00  INFO 33212 --- [  restartedMain] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2022-05-07T10:16:15.294+08:00  INFO 33212 --- [  restartedMain] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 2042 ms
2022-05-07T10:16:15.896+08:00  INFO 33212 --- [  restartedMain] o.s.b.d.a.OptionalLiveReloadServer       : LiveReload server is running on port 35729
2022-05-07T10:16:15.948+08:00  INFO 33212 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
2022-05-07T10:16:15.960+08:00  INFO 33212 --- [  restartedMain] i.github.xxyopen.novel.NovelApplication  : Started NovelApplication in 8.561 seconds (JVM running for 9.373)
</code></pre></div><ul><li><p>æ—¥æœŸå’Œæ—¶é—´ï¼šæ¯«ç§’ç²¾åº¦ï¼Œæ˜“äºæ’åºã€‚</p></li> <li><p>æ—¥å¿—çº§åˆ«ï¼šERRORã€WARNã€INFOã€DEBUG æˆ– TRACEã€‚</p></li> <li><p>è¿›ç¨‹ IDã€‚</p></li> <li><p>ç”¨äºåŒºåˆ†æ—¥å¿—å®é™…ä¿¡æ¯å¼€å§‹çš„<code>---</code>åˆ†éš”ç¬¦ã€‚</p></li> <li><p>çº¿ç¨‹åç§°ï¼šæ–¹æ‹¬å·[]ä¸­ï¼ˆå¯èƒ½ä¼šè¢«æˆªæ–­ï¼‰ã€‚</p></li> <li><p>è®°å½•å™¨åç§°ï¼šé€šå¸¸æ˜¯æºç±»åç§°ï¼ˆç»å¸¸ç¼©å†™ï¼‰ã€‚</p></li> <li><p>æ—¥å¿—ä¿¡æ¯ã€‚</p></li></ul> <p><strong>æ³¨ï¼šLogback æ²¡æœ‰ FATAL çº§åˆ«ï¼Œç›´æ¥æ˜ å°„åˆ° ERROR</strong></p> <h3 id="æ§åˆ¶å°è¾“å‡º"><a href="#æ§åˆ¶å°è¾“å‡º" class="header-anchor">#</a> æ§åˆ¶å°è¾“å‡º</h3> <p>é»˜è®¤çš„æ—¥å¿—é…ç½®åœ¨å†™å…¥æ—¶ä¼šå°†ä¿¡æ¯å›æ˜¾åˆ°æ§åˆ¶å°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šè®°å½• ERRORã€WARN å’ŒINFO çº§åˆ«çš„æ—¥å¿—ï¼Œè¿˜å¯ä»¥é€šè¿‡åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºçš„æ—¶å€™ä½¿ç”¨ --debug æ ‡å¿—æ¥å¼€å¯â€œè°ƒè¯•â€æ¨¡å¼ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -jar myapp.jar --debug
</code></pre></div><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ application.properties é…ç½®æ–‡ä»¶ä¸­è®¾ç½® debug=trueã€‚</p> <p>å¯ç”¨è°ƒè¯•æ¨¡å¼åï¼Œä¼šé…ç½®ä¸€ç³»åˆ—æ ¸å¿ƒè®°å½•å™¨ï¼ˆåµŒå…¥å¼å®¹å™¨ã€Hibernate å’Œ Spring Bootï¼‰è¾“å‡ºæ›´å¤šä¿¡æ¯ã€‚å¯ç”¨è°ƒè¯•æ¨¡å¼ä¸ä¼šå°†åº”ç”¨ç¨‹åºé…ç½®æˆè®°å½•æ‰€æœ‰ DEBUG çº§åˆ«çš„æ—¥å¿—ã€‚</p> <p>æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ --trace æ ‡å¿—ï¼ˆæˆ–åœ¨ application.properties ä¸­è®¾ç½® trace=trueï¼‰å¼€å¯ trace æ¨¡å¼æ¥ä¸ºä¸€ç³»åˆ—æ ¸å¿ƒè®°å½•å™¨å¯ç”¨ trace æ—¥å¿—è®°å½•ã€‚</p> <p>å¦‚æœæˆ‘ä»¬çš„ç»ˆç«¯æ”¯æŒ ANSIï¼Œå¯ä»¥ä½¿ç”¨é¢œè‰²è¾“å‡ºæ¥æé«˜å¯è¯»æ€§ã€‚é€šè¿‡è®¾ç½® spring.output.ansi.enabled ä¸ºæ”¯æŒçš„å€¼ä»¥è¦†ç›–è‡ªåŠ¨æ£€æµ‹ã€‚</p> <h3 id="æ–‡ä»¶è¾“å‡º"><a href="#æ–‡ä»¶è¾“å‡º" class="header-anchor">#</a> æ–‡ä»¶è¾“å‡º</h3> <p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot ä»…è®°å½•æ—¥å¿—åˆ°æ§åˆ¶å°ï¼Œä¸ä¼šå†™å…¥æ—¥å¿—æ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨æ§åˆ¶å°è¾“å‡ºä¹‹å¤–å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½® logging.file.name æˆ–è€… logging.file.path å±æ€§ã€‚</p> <p>æ—¥å¿—æ–‡ä»¶åœ¨è¾¾åˆ° 10 MB æ—¶ä¼šè½®æ¢ï¼Œå¹¶ä¸”ä¸æ§åˆ¶å°è¾“å‡ºä¸€æ ·ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šè®°å½• ERRORã€WARN å’ŒINFO çº§åˆ«çš„æ—¥å¿—ã€‚</p> <h3 id="æ–‡ä»¶è½®æ¢"><a href="#æ–‡ä»¶è½®æ¢" class="header-anchor">#</a> æ–‡ä»¶è½®æ¢</h3> <p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Logbackï¼Œå¯ä»¥ä½¿ç”¨ application.properties æˆ– application.yaml é…ç½®æ–‡ä»¶æ¥å¾®è°ƒæ—¥å¿—è½®æ¢è®¾ç½®ã€‚å¯¹äºå…¶ä»–æ‰€æœ‰çš„æ—¥å¿—è®°å½•ç³»ç»Ÿï¼Œéœ€è¦è‡ªå·±é…ç½®æ—¥å¿—è½®æ¢è®¾ç½®ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨äº† Log4J2ï¼Œé‚£ä¹ˆå¯ä»¥æ·»åŠ ä¸€ä¸ª log4j2.xml æˆ– log4j2-spring.xml æ–‡ä»¶ï¼‰ã€‚</p> <table><thead><tr><th style="text-align:left;"><strong>Name</strong></th> <th style="text-align:left;"><strong>Description</strong></th></tr></thead> <tbody><tr><td style="text-align:left;"><code>logging.logback.rollingpolicy.file-name-pattern</code></td> <td style="text-align:left;">ç”¨äºåˆ›å»ºæ—¥å¿—å­˜æ¡£çš„æ–‡ä»¶åæ¨¡å¼</td></tr> <tr><td style="text-align:left;"><code>logging.logback.rollingpolicy.clean-history-on-start</code></td> <td style="text-align:left;">æ˜¯å¦åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶è¿›è¡Œæ—¥å¿—å­˜æ¡£æ¸…ç†</td></tr> <tr><td style="text-align:left;"><code>logging.logback.rollingpolicy.max-file-size</code></td> <td style="text-align:left;">å½’æ¡£å‰æ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å°</td></tr> <tr><td style="text-align:left;"><code>logging.logback.rollingpolicy.total-size-cap</code></td> <td style="text-align:left;">è¢«åˆ ä¹‹å‰æ—¥å¿—å­˜æ¡£å¯ä»¥å ç”¨çš„æœ€å¤§å¤§å°</td></tr> <tr><td style="text-align:left;"><code>logging.logback.rollingpolicy.max-history</code></td> <td style="text-align:left;">è¦ä¿ç•™çš„æ—¥å¿—å­˜æ¡£æ–‡ä»¶çš„æœ€å¤§æ•°é‡ï¼ˆé»˜è®¤ä¸º 7ï¼‰</td></tr></tbody></table> <h3 id="æ—¥å¿—çº§åˆ«"><a href="#æ—¥å¿—çº§åˆ«" class="header-anchor">#</a> æ—¥å¿—çº§åˆ«</h3> <p>Spring Environment ä¸­æ‰€æœ‰å—æ”¯æŒçš„æ—¥å¿—ç³»ç»Ÿéƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>logging.level.&lt;logger-name&gt;=&lt;level&gt;</code> æ¥è®¾ç½® TRACEã€DEBUGã€INFOã€WARNã€ERRORã€FATAL æˆ– OFF çš„æ—¥å¿—çº§åˆ« ï¼Œroot æ—¥å¿—å¯ä»¥é€šè¿‡ä½¿ç”¨ logging.level.root æ¥é…ç½®ã€‚åœ¨ application.properties æ–‡ä»¶ä¸­è®¾ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>logging.level.root=warn
logging.level.org.springframework.web=debug
logging.level.org.hibernate=error
</code></pre></div><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥è®¾ç½®æ—¥å¿—çº§åˆ«ã€‚ä¾‹å¦‚ï¼ŒLOGGING_LEVEL_ORG_SPRINGFRAMEWORK_WEB=DEBUG å°†è®¾ç½® org.springframework.web åŒ…ä¸‹çš„æ—¥å¿—çº§åˆ«ä¸º DEBUGã€‚</p> <p>ä¸Šè¿°ä½¿ç”¨ç¯å¢ƒå˜é‡çš„æ–¹å¼ä»…é€‚ç”¨äºåŒ…çº§åˆ«çš„æ—¥å¿—è®°å½•ã€‚ç”±äºå®½æ¾ç»‘å®šæ€»æ˜¯å°†ç¯å¢ƒå˜é‡è½¬æ¢ä¸ºå°å†™ï¼Œå› æ­¤æ— æ³•ä»¥è¿™ç§æ–¹å¼ä¸ºå•ä¸ªç±»é…ç½®æ—¥å¿—ã€‚å¦‚æœæˆ‘ä»¬è¦ä¸ºç±»é…ç½®æ—¥å¿—ï¼Œå¯ä»¥ä½¿ç”¨ SPRING_APPLICATION_JSON å˜é‡ã€‚</p> <h3 id="æ—¥å¿—åˆ†ç»„"><a href="#æ—¥å¿—åˆ†ç»„" class="header-anchor">#</a> æ—¥å¿—åˆ†ç»„</h3> <p>å¦‚æœèƒ½å¤Ÿå°†ç›¸å…³çš„æ—¥å¿—è®°å½•å™¨ç»„åˆåœ¨ä¸€èµ·ä»¥ä¾¿å¯ä»¥åŒæ—¶é…ç½®å®ƒä»¬æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç»å¸¸æ›´æ”¹æ‰€æœ‰ Tomcat ç›¸å…³è®°å½•å™¨çš„æ—¥å¿—çº§åˆ«ï¼Œä½†ä¸èƒ½è½»æ˜“è®°ä½é¡¶çº§åŒ…ã€‚</p> <p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒSpring Boot å…è®¸æˆ‘ä»¬åœ¨ Spring Environment ä¸­å®šä¹‰æ—¥å¿—åˆ†ç»„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ application.properties ä¸­å®šä¹‰ä¸€ä¸ª tomcat ç»„ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>logging.group.tomcat=org.apache.catalina,org.apache.coyote,org.apache.tomcat
</code></pre></div><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥è½»æ˜“åœ°æ›´æ”¹åˆ†ç»„ä¸­æ‰€æœ‰è®°å½•å™¨çš„æ—¥å¿—çº§åˆ«ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>logging.level.tomcat=trace
</code></pre></div><p>Spring Boot é¢„å®šä¹‰äº†ä»¥ä¸‹å¼€ç®±å³ç”¨çš„æ—¥å¿—è®°å½•ç»„ï¼š</p> <table><thead><tr><th style="text-align:left;">Name</th> <th style="text-align:left;">Loggers</th></tr></thead> <tbody><tr><td style="text-align:left;">web</td> <td style="text-align:left;"><code>org.springframework.core.codec</code>, <code>org.springframework.http</code>, <code>org.springframework.web</code>, <code>org.springframework.boot.actuate.endpoint.web</code>, <code>org.springframework.boot.web.servlet.ServletContextInitializerBeans</code></td></tr> <tr><td style="text-align:left;">sql</td> <td style="text-align:left;"><code>org.springframework.jdbc.core</code>, <code>org.hibernate.SQL</code>, <code>org.jooq.tools.LoggerListener</code></td></tr></tbody></table> <h3 id="è‡ªå®šä¹‰æ—¥å¿—é…ç½®"><a href="#è‡ªå®šä¹‰æ—¥å¿—é…ç½®" class="header-anchor">#</a> è‡ªå®šä¹‰æ—¥å¿—é…ç½®</h3> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ classpath ç±»è·¯å¾„ä¸­åŠ å…¥é€‚å½“çš„åº“æ¥æ¿€æ´»å„ç§æ—¥å¿—è®°å½•ç³»ç»Ÿï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡åœ¨ç±»è·¯å¾„æ ¹ç›®å½•ä¸­æˆ– Spring Environment å±æ€§ logging.config æŒ‡å®šçš„ä½ç½®ä¸­æä¾›åˆé€‚çš„é…ç½®æ–‡ä»¶æ¥è¿›ä¸€æ­¥å®šåˆ¶ã€‚</p> <p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ç³»ç»Ÿå±æ€§ org.springframework.boot.logging.LoggingSystem æ¥å¼ºåˆ¶ Spring Boot ä½¿ç”¨ç‰¹å®šçš„æ—¥å¿—ç³»ç»Ÿã€‚è¯¥å±æ€§å€¼æ˜¯ LoggingSystem å®ç°çš„å®Œå…¨é™å®šç±»åï¼Œå¦‚æœä½¿ç”¨ none å€¼å°†å®Œå…¨ç¦ç”¨ Spring Boot çš„æ—¥å¿—é…ç½®ã€‚</p> <p><strong>æ³¨ï¼šæ—¥å¿—åˆå§‹åŒ–æ˜¯åœ¨ ApplicationContext åˆ›å»ºä¹‹å‰ï¼Œæ— æ³•ä» Spring @Configuration çš„ @PropertySources ä¸­æ§åˆ¶æ—¥å¿—ã€‚æ›´æ”¹æ—¥å¿—ç³»ç»Ÿæˆ–å®Œå…¨ç¦ç”¨å®ƒçš„å”¯ä¸€æ–¹æ³•æ˜¯é€šè¿‡ç³»ç»Ÿå±æ€§ã€‚</strong></p> <p>æ ¹æ®æ—¥å¿—ç³»ç»Ÿç±»å‹ï¼Œå°†åŠ è½½å¦‚ä¸‹æ–‡ä»¶ï¼š</p> <table><thead><tr><th style="text-align:left;">æ—¥å¿—ç³»ç»Ÿ</th> <th style="text-align:left;">åŠ è½½æ–‡ä»¶</th></tr></thead> <tbody><tr><td style="text-align:left;">Logback</td> <td style="text-align:left;"><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code> æˆ– <code>logback.groovy</code></td></tr> <tr><td style="text-align:left;">Log4j2</td> <td style="text-align:left;"><code>log4j2-spring.xml</code> æˆ– <code>log4j2.xml</code></td></tr> <tr><td style="text-align:left;">JDK (Java Util Logging)</td> <td style="text-align:left;"><code>logging.properties</code></td></tr></tbody></table> <h3 id="logback-æ‰©å±•"><a href="#logback-æ‰©å±•" class="header-anchor">#</a> Logback æ‰©å±•</h3> <p>Spring Boot åŒ…å«è®¸å¤šå¯¹ Logback çš„æ‰©å±•æ¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œé«˜çº§é…ç½®ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ logback-spring.xml é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨è¿™äº›æ‰©å±•ã€‚</p> <p><strong>æ³¨ï¼šæ ‡å‡†çš„ logback.xml é…ç½®æ–‡ä»¶åŠ è½½å¾—å¤ªæ—©ï¼Œä¸èƒ½åœ¨å…¶ä¸­ä½¿ç”¨æ‰©å±•ï¼Œéœ€è¦ä½¿ç”¨ logback-spring.xml æˆ–å®šä¹‰ logging.config å±æ€§ã€‚</strong></p> <h4 id="ç‰¹å®šé…ç½®"><a href="#ç‰¹å®šé…ç½®" class="header-anchor">#</a> ç‰¹å®šé…ç½®</h4> <p><code>&lt;springProfile&gt;</code> æ ‡ç­¾å…è®¸æˆ‘ä»¬æ ¹æ®æ¿€æ´»çš„ Spring profiles é€‰æ‹©æ€§åœ°åŒ…å«æˆ–æ’é™¤éƒ¨åˆ†é…ç½®ï¼Œ<code>&lt;configuration&gt;</code> å…ƒç´ ä¸­çš„ä»»ä½•ä½ç½®éƒ½æ”¯æŒè¯¥æ ‡ç­¾ã€‚ä½¿ç”¨ name å±æ€§æ¥æŒ‡å®šå“ªä¸ª profile æ¥å—è¿™éƒ¨åˆ†é…ç½®ã€‚ <code>&lt;springProfile&gt;</code> æ ‡ç­¾å¯ä»¥åŒ…å« profile åç§°ï¼ˆä¾‹å¦‚ prodï¼‰æˆ– profile è¡¨è¾¾å¼ï¼ˆä¾‹å¦‚ test | prodï¼‰ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;springProfile name=&quot;staging&quot;&gt;
    &lt;!-- configuration to be enabled when the &quot;staging&quot; profile is active --&gt;
&lt;/springProfile&gt;

&lt;springProfile name=&quot;dev | staging&quot;&gt;
    &lt;!-- configuration to be enabled when the &quot;dev&quot; or &quot;staging&quot; profiles are active --&gt;
&lt;/springProfile&gt;

&lt;springProfile name=&quot;!production&quot;&gt;
    &lt;!-- configuration to be enabled when the &quot;production&quot; profile is not active --&gt;
&lt;/springProfile&gt;
</code></pre></div><h4 id="environment-å±æ€§"><a href="#environment-å±æ€§" class="header-anchor">#</a> Environment å±æ€§</h4> <p><code>&lt;springProperty&gt;</code> æ ‡ç­¾å…è®¸æˆ‘ä»¬åœ¨ Logback ä¸­ä½¿ç”¨ Spring Environment å…¬å¼€çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³åœ¨ Logback é…ç½®æ–‡ä»¶ä¸­è®¿é—® application.properties æ–‡ä»¶ä¸­çš„å€¼ã€‚è¯¥æ ‡ç­¾ä¸ Logback æ ‡å‡†æ ‡ç­¾ <code>&lt;property&gt;</code> çš„å·¥ä½œæ–¹å¼ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬ä¸æ˜¯ç›´æ¥æŒ‡å®šå€¼ï¼Œè€Œæ˜¯æŒ‡å®šå±æ€§çš„æ¥æºï¼ˆæ¥è‡ª Environmentï¼‰ã€‚å¦‚æœè¦å°†å±æ€§å­˜å‚¨åœ¨ local èŒƒå›´ä»¥å¤–çš„æŸä¸ªåœ°æ–¹ï¼Œå¯ä»¥ä½¿ç”¨ scope å±æ€§ã€‚å¦‚æœéœ€è¦ä¸€ä¸ªå¤‡ç”¨å€¼ï¼ˆEnvironment æ²¡æœ‰è®¾ç½®è¯¥å±æ€§ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ defaultValue å±æ€§ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;springProperty scope=&quot;context&quot; name=&quot;fluentHost&quot; source=&quot;myapp.fluentd.host&quot;
        defaultValue=&quot;localhost&quot;/&gt;
&lt;appender name=&quot;FLUENT&quot; class=&quot;ch.qos.logback.more.appenders.DataFluentAppender&quot;&gt;
    &lt;remoteHost&gt;${fluentHost}&lt;/remoteHost&gt;
    ...
&lt;/appender&gt;
</code></pre></div><h2 id="json"><a href="#json" class="header-anchor">#</a> JSON</h2> <p>Spring Boot æä¾›äº†ä¸ä»¥ä¸‹ä¸‰ç§ JSON æ˜ å°„åº“çš„é›†æˆï¼š</p> <ul><li><p>Gson</p></li> <li><p>Jackson</p></li> <li><p>JSON-B</p></li></ul> <p>Jackson æ˜¯ Spring Boot é¦–é€‰çš„é»˜è®¤åº“ã€‚</p> <h3 id="jackson"><a href="#jackson" class="header-anchor">#</a> Jackson</h3> <p>Spring Boot æä¾›äº† Jackson çš„è‡ªåŠ¨é…ç½®ï¼Œå½“ Jackson åœ¨ classpath ç±»è·¯å¾„ä¸Šæ—¶ï¼ŒObjectMapper bean ä¼šè‡ªåŠ¨é…ç½®ã€‚Jackson æ˜¯ spring-boot-starter-json å¯åŠ¨å™¨çš„ä¸€éƒ¨åˆ†ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>@AutoConfiguration
@ConditionalOnClass({ObjectMapper.class})
public class JacksonAutoConfiguration {
    // ... çœç•¥
}
</code></pre></div><h4 id="è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–å™¨"><a href="#è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–å™¨" class="header-anchor">#</a> è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–å™¨</h4> <p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ Jackson æ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ– JSON æ•°æ®ï¼Œæœ‰æ—¶éœ€è¦è‡ªå®šä¹‰ JsonSerializerï¼ˆåºåˆ—åŒ–ï¼‰ å’Œ JsonDeserializerï¼ˆååºåˆ—åŒ–ï¼‰ ç±»æ¥å¤„ç†ä¸€äº›å¤æ‚çš„æ•°æ®ç±»å‹è½¬æ¢ã€æ•°å­—/æ—¥æœŸæ ¼å¼åŒ–ç­‰æƒ…å†µï¼ˆä¾‹å¦‚ï¼ŒLong ç±»å‹åºåˆ—åŒ–æˆ String ç±»å‹åè¿”å›ç»™æµè§ˆå™¨ä»¥é¿å…ç²¾åº¦æŸå¤±ã€String ç±»å‹ååºåˆ—åŒ–æ—¶è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ä»¥é¿å… XSS æ”»å‡»ç­‰  ï¼‰ã€‚è‡ªå®šä¹‰åºåˆ—åŒ–ç¨‹åºä¸€èˆ¬éœ€è¦é€šè¿‡ä¸€ä¸ªæ¨¡å—å‘ Jackson æ³¨å†Œï¼ŒSpring Boot æä¾›äº†ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆ @JsonComponent æ³¨è§£ï¼Œèƒ½å¤Ÿæ›´è½»æ¾åœ°ç›´æ¥æ³¨å†Œ Spring Beansã€‚</p> <p>æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ JsonSerializerï¼ŒJsonDeserializer æˆ– KeyDeserializer çš„å®ç°ç±»ä¸Šä½¿ç”¨ @JsonComponent æ³¨è§£ï¼Œè¿˜å¯ä»¥åœ¨åŒ…å« serializers/deserializers ä½œä¸ºå†…éƒ¨ç±»çš„ç±»ä¸Šä½¿ç”¨å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>@JsonComponent
public class MyJsonComponent {

    public static class Serializer extends JsonSerializer&lt;MyObject&gt; {

        @Override
        public void serialize(MyObject value, JsonGenerator jgen, SerializerProvider serializers) throws IOException {
            jgen.writeStartObject();
            jgen.writeStringField(&quot;name&quot;, value.getName());
            jgen.writeNumberField(&quot;age&quot;, value.getAge());
            jgen.writeEndObject();
        }

    }

    public static class Deserializer extends JsonDeserializer&lt;MyObject&gt; {

        @Override
        public MyObject deserialize(JsonParser jsonParser, DeserializationContext ctxt) throws IOException {
            ObjectCodec codec = jsonParser.getCodec();
            JsonNode tree = codec.readTree(jsonParser);
            String name = tree.get(&quot;name&quot;).textValue();
            int age = tree.get(&quot;age&quot;).intValue();
            return new MyObject(name, age);
        }

    }

}
</code></pre></div><p>ApplicationContext ä¸­çš„æ‰€æœ‰ @JsonComponent bean éƒ½ä¼šè‡ªåŠ¨å‘ Jackson æ³¨å†Œã€‚å› ä¸º @JsonComponent æ˜¯å¸¦æœ‰ @Component å…ƒæ³¨è§£çš„æ³¨è§£ï¼Œä¸€èˆ¬çš„ç»„ä»¶æ‰«æè§„åˆ™éƒ½èƒ½åº”ç”¨ã€‚</p> <p>æˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨ Spring Boot æä¾›çš„ JsonObjectSerializer å’Œ JsonObjectDeserializer åŸºç±»æ¥è‡ªå®šä¹‰æˆ‘ä»¬çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–å™¨ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>@JsonComponent
public class MyJsonComponent {

    public static class Serializer extends JsonObjectSerializer&lt;MyObject&gt; {

        @Override
        protected void serializeObject(MyObject value, JsonGenerator jgen, SerializerProvider provider)
                throws IOException {
            jgen.writeStringField(&quot;name&quot;, value.getName());
            jgen.writeNumberField(&quot;age&quot;, value.getAge());
        }

    }

    public static class Deserializer extends JsonObjectDeserializer&lt;MyObject&gt; {

        @Override
        protected MyObject deserializeObject(JsonParser jsonParser, DeserializationContext context, ObjectCodec codec,
                JsonNode tree) throws IOException {
            String name = nullSafeValue(tree.get(&quot;name&quot;), String.class);
            int age = nullSafeValue(tree.get(&quot;age&quot;), Integer.class);
            return new MyObject(name, age);
        }

    }

}
</code></pre></div><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªé€šè¿‡è‡ªå®šä¹‰ JSON ååºåˆ—åŒ–å™¨æ¥è§£å†³ XSS æ”»å‡»çš„ä¾‹å­ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>/**
 * JSON å…¨å±€ååºåˆ—åŒ–å™¨
 *
 * @author xiongxiaoyang
 * @date 2022/5/21
 */
@JsonComponent
public class GlobalJsonDeserializer {

    /**
     * å­—ç¬¦ä¸²ååºåˆ—åŒ–å™¨
     * è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œè§£å†³ XSS æ”»å‡»
     */
    public static class StringDeserializer extends JsonDeserializer&lt;String&gt; {

        @Override
        public String deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException, JacksonException {
            return jsonParser.getValueAsString()
                    .replace(&quot;&lt;&quot;, &quot;&amp;lt;&quot;)
                    .replace(&quot;&gt;&quot;, &quot;&amp;gt;&quot;);
        }
    }
}
</code></pre></div><h3 id="gson"><a href="#gson" class="header-anchor">#</a> Gson</h3> <p>Spring Boot æä¾›äº† Gson çš„è‡ªåŠ¨é…ç½®ï¼Œå½“ Gson åœ¨ classpath ç±»è·¯å¾„ä¸‹æ—¶ï¼ŒGson bean ä¼šè‡ªåŠ¨é…ç½®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ spring.gson.* é…ç½®å±æ€§æ¥è‡ªå®šä¹‰ Gson çš„é…ç½®ï¼Œå¦‚æœæƒ³è¦æ›´å¤šçš„æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª GsonBuilderCustomizer beanã€‚</p> <h3 id="json-b"><a href="#json-b" class="header-anchor">#</a> JSON-B</h3> <p>Spring Boot æä¾›äº† JSON-B çš„è‡ªåŠ¨é…ç½®ã€‚å½“ JSON-B API å’Œå®ç°åœ¨ classpath ç±»è·¯å¾„ä¸Šæ—¶ï¼ŒJsonb bean å°†è‡ªåŠ¨é…ç½®ã€‚é¦–é€‰çš„ JSON-B å®ç°æ˜¯ Eclipse Yassonï¼Œå®ƒæä¾›äº†ä¾èµ–ç®¡ç†ã€‚</p> <h2 id="ä»»åŠ¡æ‰§è¡Œä¸è°ƒåº¦"><a href="#ä»»åŠ¡æ‰§è¡Œä¸è°ƒåº¦" class="header-anchor">#</a> ä»»åŠ¡æ‰§è¡Œä¸è°ƒåº¦</h2> <p>å¦‚æœ Spring Boot æ²¡æœ‰åœ¨ä¸Šä¸‹æ–‡ä¸­æ£€æµ‹åˆ° Executor beanï¼Œä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ªå¸¦æœ‰åˆç†é»˜è®¤å€¼çš„ ThreadPoolTaskExecutorï¼Œå¹¶ä¸”ä¼šå…³è”åˆ°å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œï¼ˆ@EnableAsyncï¼‰å’Œ Spring MVC å¼‚æ­¥è¯·æ±‚å¤„ç†ã€‚å¦‚æœæˆ‘ä»¬åœ¨ä¸Šä¸‹æ–‡ä¸­è‡ªå®šä¹‰äº† Executorï¼Œåˆ™å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œï¼ˆ@EnableAsyncï¼‰ä¼šä½¿ç”¨å®ƒï¼Œä½† Spring MVC ä¸ä¼šï¼Œå› ä¸ºå®ƒéœ€è¦ä¸€ä¸ª AsyncTaskExecutor çš„å®ç°ï¼ˆåä¸º applicationTaskExecutorï¼‰ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>@ConditionalOnClass({ThreadPoolTaskExecutor.class})
@AutoConfiguration
@EnableConfigurationProperties({TaskExecutionProperties.class})
public class TaskExecutionAutoConfiguration {
    public static final String APPLICATION_TASK_EXECUTOR_BEAN_NAME = &quot;applicationTaskExecutor&quot;;

    public TaskExecutionAutoConfiguration() {
    }

    @Bean
    @ConditionalOnMissingBean
    public TaskExecutorBuilder taskExecutorBuilder(TaskExecutionProperties properties, ObjectProvider&lt;TaskExecutorCustomizer&gt; taskExecutorCustomizers, ObjectProvider&lt;TaskDecorator&gt; taskDecorator) {
        Pool pool = properties.getPool();
        TaskExecutorBuilder builder = new TaskExecutorBuilder();
        builder = builder.queueCapacity(pool.getQueueCapacity());
        builder = builder.corePoolSize(pool.getCoreSize());
        builder = builder.maxPoolSize(pool.getMaxSize());
        builder = builder.allowCoreThreadTimeOut(pool.isAllowCoreThreadTimeout());
        builder = builder.keepAlive(pool.getKeepAlive());
        Shutdown shutdown = properties.getShutdown();
        builder = builder.awaitTermination(shutdown.isAwaitTermination());
        builder = builder.awaitTerminationPeriod(shutdown.getAwaitTerminationPeriod());
        builder = builder.threadNamePrefix(properties.getThreadNamePrefix());
        Stream var10001 = taskExecutorCustomizers.orderedStream();
        Objects.requireNonNull(var10001);
        builder = builder.customizers(var10001::iterator);
        builder = builder.taskDecorator((TaskDecorator)taskDecorator.getIfUnique());
        return builder;
    }

    @Lazy
    @Bean(
        name = {&quot;applicationTaskExecutor&quot;, &quot;taskExecutor&quot;}
    )
    @ConditionalOnMissingBean({Executor.class})
    public ThreadPoolTaskExecutor applicationTaskExecutor(TaskExecutorBuilder builder) {
        return builder.build();
    }
}
</code></pre></div><p>é»˜è®¤çš„ Executor çº¿ç¨‹æ± ä½¿ç”¨ 8 ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œå¯ä»¥æ ¹æ®è´Ÿè½½å¢é•¿å’Œæ”¶ç¼©ã€‚è¿™äº›é»˜è®¤è®¾ç½®å¯ä»¥é€šè¿‡è®¾ç½® spring.task.execution.* ç›¸å…³å±æ€§æ¥è¿›è¡Œå¾®è°ƒï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>spring.task.execution.pool.max-size=16
spring.task.execution.pool.queue-capacity=100
spring.task.execution.pool.keep-alive=10s
</code></pre></div><p>ä½¿ç”¨ @EnableScheduling æ³¨è§£ï¼ˆ@Import({SchedulingConfiguration.class})ï¼‰å¼€å¯ä»»åŠ¡è°ƒåº¦æ—¶ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ª ThreadPoolTaskSchedulerã€‚çº¿ç¨‹æ± é»˜è®¤ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® spring.task.scheduling.* ç›¸å…³å±æ€§æ¥è¿›è¡Œå¾®è°ƒã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>@ConditionalOnClass({ThreadPoolTaskScheduler.class})
@AutoConfiguration(
    after = {TaskExecutionAutoConfiguration.class}
)
@EnableConfigurationProperties({TaskSchedulingProperties.class})
public class TaskSchedulingAutoConfiguration {
    public TaskSchedulingAutoConfiguration() {
    }

    @Bean
    @ConditionalOnBean(
        name = {&quot;org.springframework.context.annotation.internalScheduledAnnotationProcessor&quot;}
    )
    @ConditionalOnMissingBean({SchedulingConfigurer.class, TaskScheduler.class, ScheduledExecutorService.class})
    public ThreadPoolTaskScheduler taskScheduler(TaskSchedulerBuilder builder) {
        return builder.build();
    }

    @Bean
    public static LazyInitializationExcludeFilter scheduledBeanLazyInitializationExcludeFilter() {
        return new ScheduledBeanLazyInitializationExcludeFilter();
    }

    @Bean
    @ConditionalOnMissingBean
    public TaskSchedulerBuilder taskSchedulerBuilder(TaskSchedulingProperties properties, ObjectProvider&lt;TaskSchedulerCustomizer&gt; taskSchedulerCustomizers) {
        TaskSchedulerBuilder builder = new TaskSchedulerBuilder();
        builder = builder.poolSize(properties.getPool().getSize());
        Shutdown shutdown = properties.getShutdown();
        builder = builder.awaitTermination(shutdown.isAwaitTermination());
        builder = builder.awaitTerminationPeriod(shutdown.getAwaitTerminationPeriod());
        builder = builder.threadNamePrefix(properties.getThreadNamePrefix());
        builder = builder.customizers(taskSchedulerCustomizers);
        return builder;
    }
}
</code></pre></div><p>å¦‚æœéœ€è¦è‡ªå®šä¹‰æ‰§è¡Œå™¨æˆ–è°ƒåº¦å™¨ï¼Œå¯ä»¥ä½¿ç”¨ TaskExecutorBuilder bean å’Œ TaskSchedulerBuilder beanã€‚</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2 months ago</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/study/behind/springboot3/1.html" class="prev">
        Spring Boot ä½¿ç”¨
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div><div></div></div></div>
    <script src="/assets/js/app.09e306c7.js" defer></script><script src="/assets/js/2.99247de7.js" defer></script><script src="/assets/js/26.4fbe7fce.js" defer></script>
  </body>
</html>
